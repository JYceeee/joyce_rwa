# RWA项目数据库集成使用说明

## 概述

已成功将ProjectsView.vue从静态数据源改为从MySQL数据库的`product_details`表获取数据，并实现了数据库更新时的自动同步机制。

## 主要修改内容

### 1. 前端API服务 (`Website/src/service/api.ts`)
- ✅ 移除了对静态数据文件`ProductDetailsInfo.js`的依赖
- ✅ 修改为从后端API `http://localhost:3000/api/product_details` 获取数据
- ✅ 添加了所有产品相关API接口的数据库调用
- ✅ 添加了产品订阅信息更新接口

### 2. 项目视图组件 (`Website/src/views/core/ProjectsView.vue`)
- ✅ 保持原有的筛选和显示功能
- ✅ 添加了自动刷新机制（每30秒）
- ✅ 添加了手动刷新按钮
- ✅ 添加了最后更新时间显示
- ✅ 改进了错误处理和加载状态

### 3. 数据库初始化 (`Mysql/init_database.sql`)
- ✅ 创建了完整的`product_details`表结构
- ✅ 插入了5个示例产品数据
- ✅ 包含了所有必要的字段和索引

### 4. 后端API接口 (`Mysql/src/routers/`)
- ✅ 已有完整的产品API接口实现
- ✅ 支持获取所有产品、单个产品、更新订阅信息

## 启动步骤

### 1. 数据库准备
```bash
# 进入MySQL目录
cd Mysql

# 创建.env配置文件（复制以下内容）
echo "db_host=localhost
db_user=root
db_password=123456
db_name=rwa
db_port=3306" > .env

# 初始化数据库
mysql -u root -p123456 < init_database.sql
```

### 2. 启动后端服务器
```bash
# 在Mysql目录下
npm install  # 如果还没安装依赖
node index.js
```

### 3. 启动前端应用
```bash
# 在Website目录下
npm install  # 如果还没安装依赖
npm run dev
```

## 功能特性

### 自动同步机制
- 🔄 **自动刷新**: 每30秒自动从数据库获取最新数据
- 🔄 **手动刷新**: 点击"刷新数据"按钮立即更新
- ⏰ **时间显示**: 显示最后更新时间（刚刚、X分钟前、X小时前等）
- 🔍 **实时筛选**: 所有筛选功能基于最新数据库数据

### 数据完整性
- 📊 **完整字段**: 支持所有产品字段的显示和筛选
- 🔗 **关联数据**: 保持与原有静态数据相同的字段结构
- 🖼️ **图片映射**: 自动根据产品代码映射对应图片

### 错误处理
- ⚠️ **网络错误**: 显示友好的错误信息和重试按钮
- 🔄 **加载状态**: 显示加载动画和状态提示
- 📝 **日志记录**: 控制台输出详细的操作日志

## 测试验证

### 1. 运行API测试
```bash
# 在Mysql目录下
node test_api.js
```

### 2. 前端功能测试
1. 打开浏览器访问 `http://localhost:5173`
2. 进入Projects页面
3. 验证产品数据从数据库加载
4. 测试筛选功能
5. 测试刷新功能
6. 观察自动刷新（30秒间隔）

### 3. 数据库更新测试
1. 直接修改数据库中的产品数据
2. 等待30秒或手动点击刷新
3. 验证前端显示的数据已更新

## 技术架构

```
前端 (Vue.js)
    ↓ HTTP请求
后端API (Express.js)
    ↓ SQL查询
MySQL数据库 (product_details表)
    ↑ 数据更新
自动同步机制 (30秒轮询)
```

## 注意事项

1. **数据库连接**: 确保MySQL服务运行且配置正确
2. **端口配置**: 后端默认3000端口，前端默认5173端口
3. **CORS设置**: 后端已配置CORS允许前端跨域请求
4. **数据格式**: 数据库字段名与前端显示字段已做好映射
5. **性能考虑**: 30秒刷新间隔可根据需要调整

## 故障排除

### 常见问题
1. **数据不显示**: 检查后端服务器是否启动，数据库是否连接
2. **刷新不工作**: 检查浏览器控制台是否有错误信息
3. **数据不更新**: 检查数据库连接和API接口是否正常

### 调试方法
1. 查看浏览器控制台日志
2. 查看后端服务器控制台日志
3. 使用API测试脚本验证接口
4. 检查数据库表数据是否正确

## 总结

✅ **完成目标**: ProjectsView的所有项目信息现在都从MySQL的`product_details`表调用
✅ **同步机制**: 数据库更新时，前端会自动同步更新（30秒间隔 + 手动刷新）
✅ **功能完整**: 保持了原有的所有筛选、显示、交互功能
✅ **错误处理**: 添加了完善的错误处理和用户提示
✅ **易于维护**: 提供了完整的文档和测试工具

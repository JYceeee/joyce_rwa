<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeProjectView 字段映射更新测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover { background-color: #0056b3; }
        .btn-success { background-color: #28a745; }
        .btn-success:hover { background-color: #1e7e34; }
        .mapping-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .mapping-panel {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
        .field-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .field-item:last-child {
            border-bottom: none;
        }
        .field-label {
            font-weight: bold;
            color: #333;
        }
        .field-value {
            color: #666;
            font-family: monospace;
            font-size: 12px;
        }
        .match { background-color: #d4edda; }
        .updated { background-color: #fff3cd; }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .field-mapping-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .mapping-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
        }
        .mapping-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .mapping-fields {
            font-size: 12px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 TradeProjectView 字段映射更新测试</h1>
        
        <div class="test-section info">
            <h3>📋 更新概述</h3>
            <p><strong>目标:</strong> 按照现有loadProducts映射字段更新TradeProjectView内的项目信息卡片</p>
            <p><strong>主要改进:</strong></p>
            <ul>
                <li>✅ 恢复并更新loadProjectData方法</li>
                <li>✅ 使用与loadProducts完全相同的字段映射逻辑</li>
                <li>✅ 保持数据结构和命名的一致性</li>
                <li>✅ 添加兼容字段用于模板显示</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>🔄 字段映射对比</h3>
            <div class="mapping-comparison">
                <div class="mapping-panel">
                    <h4>loadProducts 映射方式</h4>
                    <div class="field-item match">
                        <span class="field-label">物业信息</span>
                        <span class="field-value">property_location, property_type</span>
                    </div>
                    <div class="field-item match">
                        <span class="field-label">贷款信息</span>
                        <span class="field-value">loan_product, loan_amount</span>
                    </div>
                    <div class="field-item match">
                        <span class="field-label">收益率</span>
                        <span class="field-value">interest_rate</span>
                    </div>
                    <div class="field-item match">
                        <span class="field-label">显示字段</span>
                        <span class="field-value">loanAmount, loanTerm</span>
                    </div>
                </div>
                
                <div class="mapping-panel">
                    <h4>loadProjectData 映射方式（更新后）</h4>
                    <div class="field-item match">
                        <span class="field-label">物业信息</span>
                        <span class="field-value">property_location, property_type</span>
                    </div>
                    <div class="field-item match">
                        <span class="field-label">贷款信息</span>
                        <span class="field-value">loan_product, loan_amount</span>
                    </div>
                    <div class="field-item match">
                        <span class="field-label">收益率</span>
                        <span class="field-value">interest_rate</span>
                    </div>
                    <div class="field-item updated">
                        <span class="field-label">兼容字段</span>
                        <span class="field-value">propertyType, propertyLocation</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>📊 字段映射详情</h3>
            <div class="field-mapping-grid">
                <div class="mapping-card">
                    <div class="mapping-title">基础信息</div>
                    <div class="mapping-fields">
                        id: project.id<br>
                        code: project.code<br>
                        name: project.name<br>
                        status: project.status
                    </div>
                </div>
                
                <div class="mapping-card">
                    <div class="mapping-title">认购信息</div>
                    <div class="mapping-fields">
                        totalOffering: AUD$format(project.total_offering_token)<br>
                        subscribed: AUD$format(project.subscribe_token)<br>
                        totalOfferingRaw: project.total_offering_token<br>
                        subscribedRaw: project.subscribe_token
                    </div>
                </div>
                
                <div class="mapping-card">
                    <div class="mapping-title">物业信息</div>
                    <div class="mapping-fields">
                        property_location: project.propertyLocation<br>
                        property_state: project.propertyState<br>
                        property_type: project.propertyType<br>
                        property_value: project.propertyValue
                    </div>
                </div>
                
                <div class="mapping-card">
                    <div class="mapping-title">贷款信息</div>
                    <div class="mapping-fields">
                        loan_type: project.loanType<br>
                        loan_product: project.loanProduct<br>
                        loan_amount: project.loanAmount<br>
                        loan_term_months: project.loanTermMonths
                    </div>
                </div>
                
                <div class="mapping-card">
                    <div class="mapping-title">贷款比率</div>
                    <div class="mapping-fields">
                        lvr: project.lvr<br>
                        interest_rate: project.interestRate<br>
                        default_rate: project.defaultRate
                    </div>
                </div>
                
                <div class="mapping-card">
                    <div class="mapping-title">前端显示字段</div>
                    <div class="mapping-fields">
                        subtitle: loanProduct - propertyType<br>
                        loanAmount: AUD$format(loanAmount)<br>
                        loanTerm: loanTermMonths months<br>
                        targetYield: interestRate
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>💻 关键代码更新</h3>
            <div class="code-block">
async loadProjectData() {
  // 按照现有loadProducts的映射方式进行数据映射
  const project = response.data
  const mappedProduct = {
    // 基础信息
    id: project.id,
    code: project.code,
    name: project.name,
    status: project.status,
    
    // 认购信息
    totalOffering: project.total_offering_token ? `AUD$${project.total_offering_token.toLocaleString()}` : 'AUD$0',
    subscribed: project.subscribe_token ? `AUD$${project.subscribe_token.toLocaleString()}` : 'AUD$0',
    
    // 物业信息（按照loadProducts映射）
    property_location: project.propertyLocation,
    property_type: project.propertyType,
    property_value: project.propertyValue,
    
    // 贷款信息（按照loadProducts映射）
    loan_product: project.loanProduct,
    loan_amount: project.loanAmount,
    loan_term_months: project.loanTermMonths,
    
    // 前端显示字段（按照loadProducts映射）
    subtitle: `${project.loanProduct} - ${project.propertyType}`,
    loanAmount: project.loanAmount ? `AUD$${project.loanAmount.toLocaleString()}` : 'AUD$0',
    loanTerm: `${project.loanTermMonths} months`,
    targetYield: project.interestRate,
    
    // 兼容字段（用于模板显示）
    propertyType: project.propertyType,
    propertyLocation: project.propertyLocation,
    loanProduct: project.loanProduct
  }
  
  // 添加计算指标（按照loadProducts映射）
  mappedProduct.metrics = {
    currentElaraPrice: this.calculateTokenPrice(mappedProduct),
    collateralPropertyValue: project.propertyValue ? `AUD$${project.propertyValue.toLocaleString()}` : 'TBA',
    rentalIncome: this.calculateRentalIncome(mappedProduct),
    targetLoanYield: `${project.interestRate}% p.a.`
  }
  
  this.projectData = mappedProduct
}
            </div>
        </div>

        <div class="test-section success">
            <h3>✅ 更新完成的功能</h3>
            <ul>
                <li><strong>数据映射一致性:</strong> loadProjectData现在使用与loadProducts完全相同的字段映射逻辑</li>
                <li><strong>字段命名统一:</strong> 使用相同的下划线命名规范（property_location, loan_product等）</li>
                <li><strong>兼容性支持:</strong> 添加camelCase兼容字段用于模板显示</li>
                <li><strong>计算指标一致:</strong> metrics对象使用相同的计算逻辑</li>
                <li><strong>错误处理:</strong> 保持相同的错误处理和日志输出</li>
                <li><strong>调试支持:</strong> 添加详细的调试日志</li>
            </ul>
        </div>

        <div class="test-section warning">
            <h3>🚀 测试步骤</h3>
            <ol>
                <li>访问TradeProjectView页面（如：<code>/trade/RWA001</code>）</li>
                <li>检查项目信息卡片是否正确显示</li>
                <li>验证字段映射是否正确（物业类型、位置、贷款产品等）</li>
                <li>确认项目指标数据是否正确计算</li>
                <li>检查浏览器控制台的调试日志</li>
                <li>对比loadProducts和loadProjectData的数据结构</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>🔗 测试链接</h3>
            <p>点击以下链接测试更新后的TradeProjectView：</p>
            <a href="/trade/RWA001" class="btn btn-success" target="_blank">测试 RWA001</a>
            <a href="/trade/RWA007" class="btn btn-success" target="_blank">测试 RWA007</a>
            <a href="/trade/TEST" class="btn btn-success" target="_blank">测试 TEST</a>
        </div>

        <div class="test-section info">
            <h3>📝 预期效果</h3>
            <p>更新后的TradeProjectView应该：</p>
            <ul>
                <li>✅ 正确显示项目基础信息（代码、名称、状态）</li>
                <li>✅ 正确映射物业信息（类型、位置、价值）</li>
                <li>✅ 正确显示贷款信息（产品、金额、期限）</li>
                <li>✅ 正确计算并显示项目指标（收益率、价格、租金等）</li>
                <li>✅ 在控制台输出详细的调试信息</li>
                <li>✅ 与loadProducts方法使用相同的数据结构</li>
            </ul>
        </div>
    </div>
</body>
</html>

<template>
  <section class="profile-page">
    <!-- 顶部：面包屑 & 操作按钮 -->
    <header class="topbar container">
      <nav class="breadcrumb" aria-label="Breadcrumb">
        <button class="crumb-back" @click="$emit('navigate','home')" aria-label="Back to Home">
          <svg viewBox="0 0 24 24" class="i"><path d="M10 19a1 1 0 0 1-.7-.3l-7-7a1 1 0 0 1 0-1.4l7-7a1 1 0 1 1 1.4 1.4L4.41 11H21a1 1 0 1 1 0 2H4.41l6.3 6.3A1 1 0 0 1 10 19z"/></svg>
        </button>
        <span class="sep">/</span>
        <span class="crumb-current">Profile</span>
      </nav>
    </header>


      
    <!-- 标题块 -->
    <div class="container head">
      <div class="avatar"><span class="avatar-initial">{{ userInitial }}</span></div>
      <div>
        <h1 class="title">{{ userName }}</h1>
        <!-- <p class="subtitle">@{{ userEmail }}</p> -->
      </div>
    </div>
    <form class="container form" @submit.prevent="onSave">

    <div >
       <!-- KYC -->
      <div class="field">
        <label class="label">KYC verification <span class="req">*</span></label>
        <div class="kyc-banner" :class="isVerified ? 'green' : 'orange'" role="status">
          <span class="icon">
            <svg viewBox="0 0 24 24" class="i">
              <path d="M12 2 2 7l10 5 10-5-10-5Zm0 7L2 4v13l10 5 10-5V4L12 9Zm0 9.5-7-3.5V9l7 3.5V20.5Z"/>
            </svg>
          </span>
          <!-- 文案：未验证=Verify now；已验证=Verified(+对勾) -->
          <span v-if="!isVerified">Verify now</span>
          <span v-else class="verified">
            <svg viewBox="0 0 24 24" class="i"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
            Verified
          </span>
          <!-- 右侧按钮：未验证=Start；已验证=Cancel -->
          <button v-if="!isVerified" class="link" type="button" @click="verifyKYC">Start</button>
          <button v-else class="link danger" type="button" @click="cancelKYC">Cancel verification</button>
        </div>
      </div>



      <!-- Whitelist Application Component -->
      <WhitelistApplication 
        v-if="isVerified"
        :is-kyc-verified="isVerified"
        :user-info="userInfo"
        @success="handleWhitelistSuccess"
        @error="handleWhitelistError"
        @info="handleWhitelistInfo"
      />

    </div>
      <!-- Email with verification -->
      <!-- <div class="field">
        <label class="label">Email Address</label>
        <div style="display: flex; gap: 8px; align-items: center;">
          <input class="input" type="email" placeholder="name@example.com" v-model.trim="form.email" style="flex:1;" />
          <button class="btn light" type="button" @click="sendEmailCode" :disabled="emailCodeSent || !form.email || !isValidEmail(form.email)">Send Code</button>
        </div>
        <div v-if="emailCodeSent" style="margin-top: 10px; display: flex; gap: 8px; align-items: center;">
          <input class="input" type="text" placeholder="Enter verification code" v-model.trim="form.emailCode" style="flex:1;" />
          <button class="btn orange" type="button" @click="verifyEmailCode" :disabled="!form.emailCode">Verify</button>
        </div>
        <div v-if="emailVerified" style="margin-top: 8px; color: #17683a; font-weight: 600;">Email verified and bound to account.</div>
      <!-- 邮箱验证弹窗 -->
      <!-- <div v-if="showEmailModal" class="modal-mask">
        <div class="modal-wrapper">
          <div class="modal-container">
            <h2 style="margin-bottom:8px;">Check Your Email</h2>
            <p>Verify your email address to use your account.<br>
            We sent an email with a button to verify your email address.<br>
            Did you receive the email? If not, check your spam folder or request a new verification email for up to 3 days.<br>
            If you do not verify your email address within 3 days, you will need to create a new account.<br>
            If you are having trouble, see Account Help.</p>
            <div style="margin-top:12px; display:flex; flex-wrap:wrap; gap:10px;">
              <a href="#" style="color:#ea7a2e; text-decoration:underline;">Account Help</a>
              <a href="#" style="color:#ea7a2e; text-decoration:underline;">Subscriptions</a>
              <a href="#" style="color:#ea7a2e; text-decoration:underline;">Unsubscribe</a>
              <a href="#" style="color:#ea7a2e; text-decoration:underline;">Privacy / Do Not Sell My Info</a>
              <a href="#" style="color:#ea7a2e; text-decoration:underline;">Cookie Preferences</a>
            </div>
            <div style="margin-top:18px; text-align:right;">
              <button class="btn orange" @click="showEmailModal=false">OK</button>
            </div>
          </div>
        </div>
      </div> -->
      <!-- </div> -->

          <!-- KYC & Whitelist Status Section -->
          <div class="status-section">
        <h3 class="status-title">Account Status</h3>
        
        <!-- KYC Level Display -->
        <div class="status-item">
          <div class="status-label">
            <span class="status-icon kyc-icon">
              <svg viewBox="0 0 24 24" class="i">
                <path d="M12 2 2 7l10 5 10-5-10-5Zm0 7L2 4v13l10 5 10-5V4L12 9Zm0 9.5-7-3.5V9l7 3.5V20.5Z"/>
              </svg>
            </span>
            KYC Level
          </div>
          <div class="status-value kyc-level">
            <span class="level-badge" :class="kycLevelClass">{{ kycLevelText }}</span>
          </div>
        </div>

        <!-- Whitelist Status Display -->
        <div class="status-item">
          <div class="status-label">
            <span class="status-icon whitelist-icon">
              <svg viewBox="0 0 24 24" class="i">
                <path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/>
              </svg>
            </span>
            Whitelist Status
          </div>
          <div class="status-value whitelist-status">
            <span class="status-badge" :class="whitelistStatusClass">{{ whitelistStatusText }}</span>
          </div>
        </div>

        <!-- Trading Permission Display -->
        <div class="status-item">
          <div class="status-label">
            <span class="status-icon trading-icon">
              <svg viewBox="0 0 24 24" class="i">
                <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z"/>
              </svg>
            </span>
            Trading Permission
          </div>
          <div class="status-value trading-permission">
            <span class="permission-badge" :class="tradingPermissionClass">{{ tradingPermissionText }}</span>
          </div>
        </div>
      </div>

      <!-- 底部按钮 -->
      <div class="actions bottom">
        <button class="btn light" type="button" @click="onCancel">Cancel</button>
        <button class="btn orange" type="submit">Save</button>
        <!-- 新增：安全退出 -->
        <button class="btn light" type="button" @click="logout" style="margin-left:auto;">Log out</button>
      </div>
    </form>

  </section>
</template>

<script>
import {
  getKycStatus,
  setKycStatus,
  setKycLevel,
  getKycLevel,
  KYC_STATUS,
  KYC_LEVELS
} from '/src/service/kycService'
import WhitelistApplication from '@/views/FunctionalModule/whitelist/WhitelistApplication.vue'
import {
  getUserInfo,
  getUserName,
  getUserInitial,
  getUserEmail,
  setUserInfo,
  USER_INFO_EVENT
} from '@/service/userService'
import { contractService } from '@/service/contractService'

export default {
  name: 'ProfileView',
  components: {
    WhitelistApplication
  },
  emits: ['navigate','notify'],
  data(){
    return {
      kycStatus: getKycStatus(),
      form: {
        twoFA: 'off',
        email: '',
        walletAction: ''
      },
      emailCode: '',
      emailCodeSent: false,
      emailVerified: false,
      generatedCode: '',
  _offVis: null,
  _offStorage: null,
  _offAfterEach: null,
  showEmailModal: false,
  // 用户信息，传递给白名单组件
  userInfo: getUserInfo(),
  // 状态信息
  whitelistStatus: 'none',
  kycLevel: getKycLevel()
    }
  },
  computed:{
    isVerified(){ return this.kycStatus === KYC_STATUS.VERIFIED },
    isPending(){ return this.kycStatus === KYC_STATUS.PENDING },
    // 用户信息计算属性
    userName(){ return getUserName() },
    userInitial(){ return getUserInitial() },
    userEmail(){ return getUserEmail() },
    
    // KYC等级显示
    kycLevelText() {
      switch(this.kycLevel) {
        case KYC_LEVELS.LEVEL_0: return 'Level 0 (Unverified)'
        case KYC_LEVELS.LEVEL_1: return 'Level 1 (Basic)'
        case KYC_LEVELS.LEVEL_2: return 'Level 2 (Advanced)'
        case KYC_LEVELS.LEVEL_3: return 'Level 3 (Premium)'
        default: return 'Unknown'
      }
    },
    
    kycLevelClass() {
      switch(this.kycLevel) {
        case KYC_LEVELS.LEVEL_0: return 'level-0'
        case KYC_LEVELS.LEVEL_1: return 'level-1'
        case KYC_LEVELS.LEVEL_2: return 'level-2'
        case KYC_LEVELS.LEVEL_3: return 'level-3'
        default: return 'level-unknown'
      }
    },
    
    // 白名单状态显示
    whitelistStatusText() {
      switch(this.whitelistStatus) {
        case 'approved': return 'Approved'
        case 'pending': return 'Pending Review'
        case 'rejected': return 'Not Qualified for Transaction'
        case 'none': return 'Not Applied'
        default: return 'Unknown'
      }
    },
    
    whitelistStatusClass() {
      switch(this.whitelistStatus) {
        case 'approved': return 'status-approved'
        case 'pending': return 'status-pending'
        case 'rejected': return 'status-rejected'
        case 'none': return 'status-none'
        default: return 'status-unknown'
      }
    },
    
    // 交易权限显示
    tradingPermissionText() {
      if (this.kycLevel >= KYC_LEVELS.LEVEL_2 && this.whitelistStatus === 'approved') {
        return 'Full Access'
      } else if (this.kycLevel >= KYC_LEVELS.LEVEL_2) {
        return 'Limited Access'
      } else {
        return 'No Access'
      }
    },
    
    tradingPermissionClass() {
      if (this.kycLevel >= KYC_LEVELS.LEVEL_2 && this.whitelistStatus === 'approved') {
        return 'permission-full'
      } else if (this.kycLevel >= KYC_LEVELS.LEVEL_2) {
        return 'permission-limited'
      } else {
        return 'permission-none'
      }
    }
  },
  watch: {
    // 监听KYC状态变化
    kycStatus: {
      handler(newStatus, oldStatus) {
        console.log('🔄 KYC状态变化:', oldStatus, '->', newStatus)
        if (newStatus === KYC_STATUS.VERIFIED && oldStatus !== KYC_STATUS.VERIFIED) {
          console.log('✅ KYC验证成功，自动更新Account Status')
          // KYC验证成功时，自动设置等级为2并更新白名单状态
          this.kycLevel = getKycLevel()
          if (this.kycLevel < KYC_LEVELS.LEVEL_2) {
            setKycLevel(KYC_LEVELS.LEVEL_2)
            this.kycLevel = KYC_LEVELS.LEVEL_2
            console.log('🔧 自动设置KYC等级为Level 2')
          }
          // 更新白名单状态
          this.loadStatusInfo()
        }
      },
      immediate: false
    },
    
    // 监听KYC等级变化
    kycLevel: {
      handler(newLevel, oldLevel) {
        console.log('🔄 KYC等级变化:', oldLevel, '->', newLevel)
        if (newLevel >= KYC_LEVELS.LEVEL_2 && this.isVerified) {
          console.log('✅ KYC等级达到Level 2，自动更新白名单状态')
          // 更新白名单状态
          this.loadStatusInfo()
        }
      },
      immediate: false
    }
  },
  mounted(){
    // 刷新函数：从 localStorage 读取最新状态
    const refresh = () => { 
      this.kycStatus = getKycStatus()
      this.kycLevel = getKycLevel()
      // KYC状态变化时，立即更新Account Status
      this.loadStatusInfo()
    }
    const refreshUserInfo = () => { this.userInfo = getUserInfo() }
    const refreshStatus = () => { this.loadStatusInfo() }

    // 1) 初次进入
    refresh()
    refreshUserInfo()
    refreshStatus()
    
    // 2) 标签激活（从 /kycService 返回就会触发）
    const onVis = () => document.visibilityState === 'visible' && (refresh(), refreshUserInfo(), refreshStatus())
    document.addEventListener('visibilitychange', onVis)
    this._offVis = () => document.removeEventListener('visibilitychange', onVis)

    // 3) 跨标签同步（若多标签页同时登录）
    const onStore = (e) => { 
      if (e.key === 'kycStatus') refresh()
      if (e.key === 'kycLevel') refresh()
      if (e.key === 'userInfo') refreshUserInfo()
      if (e.key === 'whitelistStatus') refreshStatus()
    }
    window.addEventListener('storage', onStore)
    this._offStorage = () => window.removeEventListener('storage', onStore)

    // 4) 路由返回时（从 KYC 页面 push 回来）
    this._offAfterEach = this.$router.afterEach((to) => {
      if (to.path === '/profile') {
        refresh()
        refreshUserInfo()
        refreshStatus()
      }
    })

    // 5) 监听用户信息更新事件
    const onUserInfoChange = () => {
      refreshUserInfo()
      this.$forceUpdate() // 强制更新组件
    }
    window.addEventListener(USER_INFO_EVENT, onUserInfoChange)
    this._offUserInfo = () => window.removeEventListener(USER_INFO_EVENT, onUserInfoChange)

    // 6) 监听KYC验证成功事件
    const onKycSuccess = () => {
      console.log('🎉 收到KYC验证成功事件，更新Account Status')
      refresh()
    }
    window.addEventListener('kyc-verification-success', onKycSuccess)
    this._offKycSuccess = () => window.removeEventListener('kyc-verification-success', onKycSuccess)
  },
  activated(){
    // keep-alive 场景下也会被调用
    this.kycStatus = getKycStatus()
  },
  beforeUnmount(){
    this._offVis && this._offVis()
    this._offStorage && this._offStorage()
    this._offAfterEach && this._offAfterEach()
    this._offUserInfo && this._offUserInfo()
    this._offKycSuccess && this._offKycSuccess()
  },
  methods:{
    // 加载状态信息
    async loadStatusInfo() {
      try {
        console.log('🔄 开始加载状态信息...')
        // 更新KYC等级
        this.kycLevel = getKycLevel()
        console.log('📊 当前KYC等级:', this.kycLevel)
        console.log('📊 当前KYC状态:', this.kycStatus)
        
        // 加载白名单状态（无论KYC状态如何都显示）
        if (this.isVerified) {
          console.log('✅ 用户已通过KYC验证')
          // 简化：KYC Level 2用户直接设置为approved
          if (this.kycLevel >= KYC_LEVELS.LEVEL_2) {
            this.whitelistStatus = 'approved'
            localStorage.setItem('whitelistStatus', 'approved')
            console.log('✅ KYC Level 2用户，白名单状态自动设置为approved')
            console.log('📊 更新后的状态 - KYC Level:', this.kycLevel, 'Whitelist:', this.whitelistStatus)
            return
          }
          
          // 从本地存储获取白名单状态
          const savedStatus = localStorage.getItem('whitelistStatus')
          if (savedStatus) {
            this.whitelistStatus = savedStatus
            console.log('📊 从本地存储加载白名单状态:', savedStatus)
          }
        } else {
          // 如果KYC未验证，设置默认状态
          this.whitelistStatus = 'none'
          console.log('❌ 用户未通过KYC验证，设置默认状态')
        }
        console.log('📊 最终状态 - KYC Level:', this.kycLevel, 'Whitelist:', this.whitelistStatus)
      } catch (error) {
        console.error('Failed to load status info:', error)
      }
    },

    // 校验邮箱格式
    isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    },

    // 发送验证码
    async sendEmailCode() {
      if (!this.isValidEmail(this.form.email)) {
        this.$emit('notify','Please enter a valid email.');
        return;
      }
      try {
        // 调用后端API发送验证码邮件
        const res = await fetch(import.meta.env.VITE_API_EmailVerify, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user_email: this.form.email })
        });
        const data = await res.json();
        if (data.status === 0) {
          this.emailCodeSent = true;
          this.generatedCode = data.code; // 开发环境返回验证码，便于测试
          this.showEmailModal = true;
          this.$emit('notify', data.message || '验证码已发送到您的邮箱');
        } else {
          this.$emit('notify', data.message || 'Failed to send email.');
        }
      } catch (e) {
        this.$emit('notify','Network error, please try again.');
      }
    },

    // 验证验证码
    async verifyEmailCode() {
      try {
        // 调用后端API校验验证码
        const res = await fetch(import.meta.env.VITE_API_EmailVerify, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            user_email: this.form.email, 
            verification_code: this.form.emailCode 
          })
        });
        const data = await res.json();
        if (data.status === 0) {
          this.emailVerified = true;
          this.emailCodeSent = false; // 隐藏验证码输入框
          this.form.emailCode = ''; // 清空验证码
          this.$emit('notify', data.message || 'Email verified and bound to account.');
        } else {
          this.$emit('notify', data.message || 'Incorrect verification code.');
        }
      } catch (e) {
        this.$emit('notify','Network error, please try again.');
      }
    },
    verifyKYC(){ this.$router.push('/kycService') },

    // 撤销 KYC：立即变回黄色并显示 Start
    cancelKYC(){
      if (!confirm('Are you sure you want to cancel KYC verification?')) return
      setKycStatus(KYC_STATUS.UNVERIFIED)     // 写入存储
      this.kycStatus = KYC_STATUS.UNVERIFIED  // 立刻刷新 UI
      
      // 清除KYC级别
      setKycLevel(KYC_LEVELS.LEVEL_0)
      
      this.$emit('notify','KYC verification has been cancelled.')
    },

    onCancel(){ this.$emit('navigate','home') },

    onSave(){
      if (!this.isVerified) return this.$emit('notify','Please complete KYC first.')
      if (this.form.email && !this.isValidEmail(this.form.email))
        return this.$emit('notify','Please enter a valid email.')
      if (this.form.email && !this.emailVerified)
        return this.$emit('notify','Please verify your email before saving.')
      this.$emit('notify','Profile saved (demo)')
    },

    logout() {
    // 1) 清理本地状态
    localStorage.removeItem('token');
    localStorage.removeItem('isLoggedIn');
    localStorage.removeItem('remember_email');
    
    // 2) 触发全局登录状态更新事件
    window.dispatchEvent(new CustomEvent('auth-changed'));

    // 3) 友好提示
    this.$emit('notify','You have logged out.');

    // 4) 跳转到登录页
    this.$router.push('/login');
  },

  // 白名单组件事件处理
  handleWhitelistSuccess(message) {
    this.$emit('notify', message);
    // 刷新状态信息
    this.loadStatusInfo();
  },

  handleWhitelistError(message) {
    this.$emit('notify', message);
  },

  handleWhitelistInfo(message) {
    this.$emit('notify', message);
    // 刷新状态信息
    this.loadStatusInfo();
  }
}
}
</script>

<style scoped>
/* 状态显示区域样式 */
.status-section {
  max-width: 500px;
  margin-left: 200px;
  padding: 20px;
  background: #29333d;
  border-radius: 12px;
  border: 1px solid #2f3235;
}

.status-title {
  margin: 0 0 16px 0;
  font-size: 18px;
  font-weight: 600;
  color: #f4f7f9;
}

.status-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid #e9ecef;
}

.status-item:last-child {
  border-bottom: none;
}

.status-label {
  display: flex;
  align-items: center;
  font-weight: 500;
  color: #d7dadd;
}

.status-icon {
  width: 20px;
  height: 20px;
  margin-right: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.status-icon svg {
  width: 100%;
  height: 100%;
  fill: currentColor;
}

.kyc-icon {
  color: #007bff;
}

.whitelist-icon {
  color: #28a745;
}

.trading-icon {
  color: #ffc107;
}

.status-value {
  display: flex;
  align-items: center;
}

/* KYC等级徽章样式 */
.level-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.level-0 {
  background: #f8d7da;
  color: #721c24;
}

.level-1 {
  background: #fff3cd;
  color: #856404;
}

.level-2 {
  background: #d4edda;
  color: #155724;
}

.level-3 {
  background: #cce5ff;
  color: #004085;
}

.level-unknown {
  background: #e2e3e5;
  color: #6c757d;
}

/* 白名单状态徽章样式 */
.status-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-approved {
  background: #d4edda;
  color: #155724;
}

.status-pending {
  background: #fff3cd;
  color: #856404;
}

.status-rejected {
  background: #f8d7da;
  color: #721c24;
}

.status-none {
  background: #e2e3e5;
  color: #6c757d;
}

.status-unknown {
  background: #f8d7da;
  color: #721c24;
}

/* 交易权限徽章样式 */
.permission-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.permission-full {
  background: #d4edda;
  color: #155724;
}

.permission-limited {
  background: #fff3cd;
  color: #856404;
}

.permission-none {
  background: #f8d7da;
  color: #721c24;
}

/* 简易弹窗样式 */
.modal-mask {
  position: fixed;
  z-index: 9999;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.3);
  display: flex;
  align-items: center;
  justify-content: center;
}
.modal-wrapper {
  width: 100%;
  max-width: 420px;
}
.modal-container {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.12);
  padding: 28px 24px 18px;
  font-size: 15px;
}
.container { max-width: 920px; margin: 0 auto; }
/* 页面容器深色主题 */
.profile-page { 
  padding-bottom: 64px; 
  background: #0a0a1a;
  min-height: 100vh;
}

.container {
  background: transparent;
}

/* 顶部 */
.topbar { display:flex; align-items:center; justify-content:space-between; gap:16px; padding:24px 16px; }
.breadcrumb { display:flex; align-items:center; gap:10px; color:#9ca3af; }
.crumb-back { border:0; background:transparent; cursor:pointer; color:#9ca3af; }
.sep{ opacity:.6; }
.crumb-current{ color:#ffffff; font-weight:600; }

/* 标题块 */
.head { display:flex; align-items:center; gap:16px; padding:0 16px 8px; }
.avatar{ width:44px; height:44px; border-radius:999px; background:#374151; display:grid; place-items:center;}
.avatar-initial{ font-weight:700; color:#ffffff; }
.title{ font-size:24px; line-height:1.2; margin:0; color:#ffffff; }
.subtitle{ margin:2px 0 0; color:#9ca3af; }

/* 表单与控件 */
.form{ margin-top:24px; padding:0 16px; }
.field{ margin:18px 0; }
.label{ display:block; font-size:12px; color:#9ca3af; margin-bottom:8px; }
.req{ color:#f97316; }
.input{ width:100%; height:40px; border:1px solid #374151; border-radius:8px; padding:0 12px; background:#1f2937; color:#ffffff; }
.input:focus{ border-color:#4b5563; box-shadow:0 0 0 3px rgba(59, 130, 246, 0.1); }
.input::placeholder{ color:#9ca3af; }
.input.with-icon{ display:flex; align-items:center; gap:8px; padding:0 8px; }
.input.with-icon select{ border:0; outline:none; width:100%; height:38px; background:transparent; color:#ffffff; }
.input.with-icon .icon{ width:28px; height:28px; border-radius:10px; background:#374151; display:grid; place-items:center;
  box-shadow:0 2px 6px rgba(0, 0, 0, 0.2), inset 0 0 0 1px #4b5563; }
.i{ width:18px; height:18px; fill:currentColor; color:#ffffff; }

/* KYC 横幅 */
.kyc-banner{ display:flex; align-items:center; gap:10px; height:40px; border-radius:8px; padding:0 12px; border:1px solid; }
.kyc-banner.orange{ background:#1f2937; color:#f97316; border-color:#374151; }
.kyc-banner.green{ background:#1f2937; color:#16a34a; border-color:#374151; }
.kyc-banner .icon{
  width:28px; height:28px; border-radius:10px; background:#374151; display:grid; place-items:center;
  box-shadow:0 2px 6px rgba(0, 0, 0, 0.2), inset 0 0 0 1px #4b5563; opacity:.9;
}


.link{ margin-left:auto; color:inherit; background:transparent; border:0; cursor:pointer; text-decoration:underline; }
.link.danger{ color:#dc2626; }
.verified{ margin-left:4px; display:inline-flex; align-items:center; gap:6px; font-weight:600; }


/* 底部按钮 */
.actions { display:flex; gap:12px; }
.actions.bottom { margin-top: 16px; }
.btn{ border:1px solid transparent; border-radius:10px; padding:8px 14px; cursor:pointer; font-weight:600; line-height:1; }
.btn.orange{ background:#ea7a2e; color:#fff; }
.btn.orange:hover{ filter:brightness(.96); }
.btn.light{ background:#374151; color:#ffffff; border-color:#4b5563; }
.btn.light:hover{ background:#4b5563; }
</style>

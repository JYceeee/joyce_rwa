<template>
  <div class="trade-page">
    <!-- ‰ΩôÈ¢ù‰∏çË∂≥ÂºπÁ™ó -->
    <!-- <div v-if="showInsufficientBalanceModal" class="modal-overlay" @click="closeInsufficientBalanceModal">
      <div class="modal-content error-modal" @click.stop>
        <div class="modal-header">
          <div class="error-icon">‚ö†Ô∏è</div>
          <h2 class="modal-title">‰ΩôÈ¢ù‰∏çË∂≥</h2>
        </div>
        <div class="modal-body">
          <div class="error-message">
            <p>ÊÇ®ÁöÑ‰ª£Â∏Å‰ΩôÈ¢ù‰∏çË∂≥‰ª•ÂÆåÊàê {{ projectCode }} ÁöÑ‰∫§Êòì„ÄÇ</p>
            <p><strong>ÂΩìÂâç‰ΩôÈ¢ù:</strong> {{ userTokenBalance }} {{ projectCode }} tokens</p>
            <p><strong>ÊâÄÈúÄÈáëÈ¢ù:</strong> {{ tradeAmount }} {{ projectCode }} tokens</p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn primary" @click="closeInsufficientBalanceModal">Á°ÆÂÆö</button>
        </div>
      </div>
    </div> -->

    <!-- Âä†ËΩΩ‰∏≠ÂºπÁ™ó -->
    <div v-if="showLoadingModal" class="modal-overlay"> 
      <div class="modal-content loading-modal" @click.stop>
        <div class="loading-container">
          <div class="loading-icon">
            <div class="spinner"></div>
          </div>
          <div class="loading-content">
            <h2 class="loading-title">Processing...</h2>
            <p class="loading-description">We are processing your transaction request, please wait...</p>
            <div class="loading-status">
              <div class="status-indicator"></div>
              <span>{{ loadingStatus }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‰∫§ÊòìÊàêÂäüÂºπÁ™ó -->
    <div v-if="showSuccessModal" class="modal-overlay" @click="closeSuccessModal"> 
      <div class="modal-content success-modal" @click.stop>
        <div class="success-container">
          <div class="success-icon">
            <div class="checkmark">
              <div class="checkmark-stem"></div>
              <div class="checkmark-kick"></div>
            </div>
          </div>
          <div class="success-content">
            <h2 class="success-title">Transaction Successful!</h2>
            <p class="success-description">Your transaction has been completed successfully</p>
            
            <div class="success-details">
              <div class="detail-card">
                <div class="detail-header">
                  <!-- <span class="detail-icon">üìä</span> -->
                  <span class="detail-label">Transaction Details</span>
                </div>
                <div class="detail-grid">
                  <div class="detail-item">
                    <span class="detail-key">Type:</span>
                    <span class="detail-value">{{ successData.tradeType === 'buy' ? 'Buy' : 'Sell' }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-key">Amount:</span>
                    <span class="detail-value">{{ successData.amount }} Tokens</span>
                  </div>
                </div>
              </div>
              
              <div class="detail-card">
                <div class="detail-header">
                  <!-- <span class="detail-icon">üîó</span> -->
                  <span class="detail-label">Blockchain Info</span>
                </div>
                <div class="detail-grid">
                  <div class="detail-item">
                    <span class="detail-key">Hash:</span>
                    <span class="detail-value hash-value" @click="copyHash">{{ formatHash(successData.transactionHash) }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-key">Block:</span>
                    <span class="detail-value">{{ successData.blockNumber }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="success-actions">
            <button class="btn secondary" @click="closeSuccessModal">Close</button>
            <button class="btn primary" @click="viewPortfolio">View Portfolio</button>
          </div>
        </div>
      </div>
    </div>

    <!-- È°∂ÈÉ®Èù¢ÂåÖÂ±ëÂØºËà™ -->
    <header class="topbar container">
      <nav class="breadcrumb" aria-label="Breadcrumb">
        <button class="crumb-back" @click="$router.back()" aria-label="Back">
          <svg viewBox="0 0 24 24" class="i">
            <path d="M10 19a1 1 0 0 1-.7-.3l-7-7a1 1 0 0 1 0-1.4l7-7a1 1 0 1 1 1.4 1.4L4.41 11H21a1 1 0 1 1 0 2H4.41l6.3 6.3A1 1 0 0 1 10 19z"/>
          </svg>
        </button>
        <span class="sep">/</span>
        <span class="crumb">Projects</span>
        <span class="sep">/</span>
        <span class="crumb-current">Trade {{ projectCode }}</span>
      </nav>
    </header>

    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
    <div class="container main-content">
      <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
      <div v-if="projectLoading" class="loading-container">
        <div class="loading-spinner"></div>
        <h2>Loading Project Data...</h2>
        <p>Please wait while we load the project information.</p>
      </div>
      
      <!-- ÈîôËØØÁä∂ÊÄÅ -->
      <div v-else-if="projectError" class="error-container"> 
        <div class="error-icon">‚ö†Ô∏è</div>
        <h2>Failed to Load Project</h2>
         <p>{{ projectError }}</p> 
        <button class="btn primary" @click="loadProjectData">Retry</button>
      </div>
      
      <!-- È°πÁõÆ‰ø°ÊÅØÂç°Áâá -->
      <div v-else-if="projectData" class="project-info-card">
        <div class="project-header">
          <img :src="projectData.image" :alt="projectCode" class="project-image" />
          <div class="project-details">
            <h1 class="project-title">{{ projectData.code }} ‚Ä¢ {{ projectData.name }}</h1>
            <p class="project-subtitle">{{ projectData.subtitle }}</p>
            <div class="project-meta">
              <span class="meta-item">{{ projectData.propertyType || projectData.type }}</span>
              <span class="meta-item">{{ projectData.propertyLocation || projectData.region }}</span>
              <span class="meta-item">{{ projectData.loanProduct || 'Loan Product' }}</span>
            </div>
          </div>
        </div>
        
          <!-- È°πÁõÆÊåáÊ†á -->
          <div class="project-metrics">
            <div class="metric-item">
              <span class="metric-label">LOAN SIZE</span>
              <span class="metric-value">{{ projectData.loanAmount || 'AUD$0' }}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">EST. YIELD (IRR)</span>
              <span class="metric-value" style="color: #16a34a;">{{ projectData.metrics.targetLoanYield }}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">TERM</span>
              <span class="metric-value">{{ projectData.loanTerm || '12 months' }}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">PROPERTY VALUE</span>
              <span class="metric-value">{{ projectData.metrics.collateralPropertyValue }}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">LTV</span>
              <span class="metric-value">{{ projectData.metrics.loanToValue }}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">SUBSCRIPTION PROGRESS</span>
              <span class="metric-value" style="color: #3b82f6;">{{ projectData.subscriptionProgress }}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">TOTAL OFFERING</span>
              <span class="metric-value">{{ projectData.totalOffering }}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">SUBSCRIBED</span>
              <span class="metric-value">{{ projectData.subscribed }}</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">DEFAULT RATE</span>
              <span class="metric-value">{{ projectData.metrics.defaultRate }}</span>
            </div>
          </div>
      </div>

      <!-- ËÆ§Ë¥≠Ë°®Âçï -->
      <div class="trade-form-card">
        <div class="form-header">
          <h2 class="form-title">ËÆ§Ë¥≠ {{ projectCode }}</h2>
          <!-- Èí±ÂåÖÁä∂ÊÄÅ - Êï¥ÂêàÊàê‰∏ÄË°åÊòæÁ§∫ -->
          <div class="wallet-status-inline">
            <div class="wallet-status-item">
              <span class="status-label">Èí±ÂåÖ:</span>
              <span :class="['status-value', connected ? 'connected' : 'disconnected']">
                {{ connected ? 'Connected' : 'Disconnected' }}
              </span>
            </div>
            <div class="wallet-status-item" v-if="connected">
              <span class="status-label">Âú∞ÂùÄ:</span>
              <span class="status-value">{{ shortAddress }}</span>
            </div>
            <div class="wallet-status-item" v-if="connected">
              <span class="status-label">ÁΩëÁªú:</span>
              <span class="status-value">{{ networkLabel }}</span>
            </div>
            <div class="wallet-status-item" v-if="connected">
              <span class="status-label">ÈìæID:</span>
              <span class="status-value">{{ getCurrentChainId() }}</span>
            </div>
            <div class="wallet-status-item" v-if="connected">
              <span class="status-label">‰ª£Â∏Å‰ΩôÈ¢ù:</span>
              <span class="status-value">{{ nativeBalanceDisplay }} LPT</span>
            </div>
            <!-- <button 
              v-if="!connected" 
              @click="connectWallet" 
              class="btn primary tiny"
              :disabled="loading"
            >
              Connect Wallet
            </button> -->
            <!-- <button 
              v-if="connected" 
              @click="disconnectWallet" 
              class="btn secondary tiny"
              :disabled="loading"
            >
              Disconnect Wallet
            </button> -->
          </div>
        </div>
        
        <!-- ËÆ§Ë¥≠ÈáëÈ¢ùËæìÂÖ• -->
        <div class="form-section">
          <h3 class="section-title">Purchase Amount</h3>
          <div class="amount-input-group">
            <input 
              type="number" 
              v-model="subscriptionAmount" 
              class="amount-input"
              :class="{ 'error': amountError }"
              placeholder="Please enter the purchase amount"
              min="100"
              max="10000"
              step="0.01"
              @input="onAmountInput"
              @blur="validateAmount"
            />
            <span class="amount-unit">LPT</span>
          </div>
          <!-- <div class="amount-info">
            <p class="input-hint" v-if="!amountError">
              Minimum purchase amount: {{ contractTerms.minSubscription || 100 }} LPT, Maximum purchase amount: {{ contractTerms.maxSubscription || 10000 }} LPT
            </p>
            <p class="input-error" v-if="amountError">
              {{ amountError }}
            </p>
          </div> -->
        </div>

        <!-- ËÆ§Ë¥≠ÊëòË¶Å -->
        <div class="subscription-summary" v-if="subscriptionAmount && subscriptionAmount > 0 && amountValid">
          <h3>Purchase Summary</h3>
          <div class="summary-item">
            <span class="summary-label">Project Code:</span>
            <span class="summary-value">{{ projectCode }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Purchase Amount:</span>
            <span class="summary-value">{{ formatNumber(subscriptionAmount) }} LPT</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Annual Rate:</span>
            <span class="summary-value">9.5% p.a. (Ê†áÂáÜÂà©Áéá)</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Loan Term:</span>
            <span class="summary-value">12 months (Ê†áÂáÜÊúüÈôê)</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Estimated Interest:</span>
            <span class="summary-value">{{ calculateInterest() }} LIT</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Current Price:</span>
            <span class="summary-value">$1.00</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Total Token Needed:</span>
            <span class="summary-value">{{ formatNumber(subscriptionAmount) }} LPT</span>
          </div>
          <div class="button-hint" v-if="!connected">
              Please connect your wallet
          </div>
          <div class="button-hint" v-else-if="!isFormValid">
            Please fill in the complete subscription information
          </div>
        </div>

        <!-- ËÆ§Ë¥≠ÊåâÈíÆ -->
        <div class="form-section">
          <div class="trade-type-buttons">
            <button 
              class="trade-type-btn buy-btn" 
              @click="deployContractsWithSubscription"
              :disabled="!connected || !isFormValid || loading"
            >
              <span class="btn-text">{{ loading ? 'Processing...' : 'BUY' }}</span>
            </button>
          </div>
        </div>
      </div>

      <!-- ÈÉ®ÁΩ≤Áä∂ÊÄÅÂå∫Âüü -->
      <!-- <div v-if="deploymentStatus" class="deployment-status-card"> -->
      <div class="deployment-status-card">
        <h3>ÈÉ®ÁΩ≤Áä∂ÊÄÅ</h3>
        <div class="status-log">
          <div 
            v-for="(log, index) in deploymentLogs" 
            :key="index"
            :class="['log-item', log.type]"
          >
            <span class="log-time">{{ log.time }}</span>
            <span class="log-message">{{ log.message }}</span>
          </div>
        </div> 

      <!-- Â∑≤ÈÉ®ÁΩ≤ÂêàÁ∫¶‰ø°ÊÅØÂå∫Âüü -->
      <!-- <div v-if="deployedContracts.length > 0" class="deployed-contracts-card"> -->
      <div class="deployed-contracts-card">
        <h3>Â∑≤ÈÉ®ÁΩ≤ÂêàÁ∫¶</h3>
        <div class="contract-list">
          <div 
            v-for="contract in deployedContracts" 
            :key="contract.name"
            class="contract-item"
          >
            <div class="contract-name">{{ contract.name }}</div>
            <div class="contract-address">{{ contract.address }}</div>
            <button 
              @click="copyAddress(contract.address)"
              class="btn small"
            >
              Â§çÂà∂Âú∞ÂùÄ
            </button>
          </div>
          <!-- <button @click="goToWallet" class="btn primary">go to wallet add your address</button>  -->
        </div>
      </div>

      <!-- ÂêàÁ∫¶‰∫§‰∫íÁä∂ÊÄÅÂå∫Âüü -->
      <!-- <div v-if="interactionStatus" class="interaction-status-card"> -->
      <div class="interaction-status-card">
        <h3>ÂêàÁ∫¶‰∫§‰∫íÁä∂ÊÄÅ</h3>
        <div class="status-log">
          <div 
            v-for="(log, index) in interactionLogs" 
            :key="index"
            :class="['log-item', log.type]"
          >
            <span class="log-time">{{ log.time }}</span>
            <span class="log-message">{{ log.message }}</span>
          </div>
        </div>
      </div>

      <!-- ‰ΩôÈ¢ù‰ø°ÊÅØÂå∫Âüü -->
      <!-- <div v-if="balanceInfo" class="balance-info-card"> -->
      <div class="balance-info-card">
        <h3>‰ΩôÈ¢ù‰ø°ÊÅØ</h3>
        <div class="balance-list">
          <div class="balance-item">
            <span class="balance-label">LPT ‰ΩôÈ¢ù:</span>
            <span class="balance-value">{{ balanceInfo.lpt }} LPT</span>
          </div>
          <div class="balance-item">
            <span class="balance-label">LIT ‰ΩôÈ¢ù:</span>
            <span class="balance-value">{{ balanceInfo.lit }} LIT</span>
          </div>
          <div class="balance-item">
            <span class="balance-label">ETH ‰ΩôÈ¢ù:</span>
            <span class="balance-value">{{ balanceInfo.eth }} ETH</span>
          </div>
        </div>
      </div>
    </div>
      <div>
        <!-- View Contract DetailsÊåâÈíÆ -->
        <!-- <div class="contract-details-section">
          <button class="contract-details-btn" @click="viewContractDetails"> -->
            <!-- <span class="btn-icon">üìã</span> -->
            <!-- <span class="btn-text">View Contract Details</span> -->
            <!-- <span class="btn-arrow">‚Üí</span> -->
          <!-- </button>
        </div> -->
      </div>
          
        <!-- ÈîôËØØ‰ø°ÊÅØÊòæÁ§∫ -->
        <div v-if="formattedError" class="error-message">
          <div class="error-icon">‚ö†Ô∏è</div>
          <div class="error-text">{{ formattedError }}</div>
        </div>
        </div>

      <!-- ‰∫§ÊòìÂéÜÂè≤ -->
      <div class="trade-history-card">
        <div class="card-header">
          <h2 class="card-title">Recent Trades</h2>
        </div>
        <div v-if="loading" class="loading-message">Loading trades...</div>
        <div v-else-if="projectTrades.length === 0" class="no-trades">No trades found for this project</div>
        <div v-else class="trade-list">
          <div v-for="trade in projectTrades" :key="trade.id" class="trade-item">
            <div class="trade-header">
              <span class="trade-type" :class="trade.type">{{ getTradeTypeDisplay(trade.type) }}</span>
              <span class="trade-time">{{ formatTime(trade.timestamp) }}</span>
          </div>
            <div class="trade-info">
              <div class="trade-project-section">
                <span class="label">Project:</span>
                <span class="value">{{ trade.project_code }} - {{ trade.project_name }}</span>
          </div>
              <div class="trade-amount-section">
                <span class="label">Token Amount:</span>
                <span class="value"> {{ trade.amount }} tokens</span>
              </div>
              <!-- EtherscanËØ¶ÊÉÖ -->
              <div v-if="trade.etherscan" class="trade-etherscan-section">
                <div class="etherscan-info">
                  <span class="label">Transaction Hash:</span>
                  <span class="value hash-value" @click="copyHash(trade.etherscan.hash)">{{ formatHash(trade.etherscan.hash) }}</span>
                </div>
                <div class="etherscan-info">
                  <span class="label">Status:</span>
                  <span class="value" :class="{ 'status-success': trade.etherscan.status === '0x1', 'status-failed': trade.etherscan.status === '0x0' }">
                    {{ trade.etherscan.status === '0x1' ? 'Success' : trade.etherscan.status === '0x0' ? 'Failed' : 'Pending' }}
                  </span>
                </div>
                <div class="etherscan-info">
                  <span class="label">Block:</span>
                  <span class="value">{{ trade.etherscan.blockNumber ? parseInt(trade.etherscan.blockNumber, 16).toLocaleString() : 'N/A' }}</span>
                </div>
                <div class="etherscan-info">
                  <span class="label">Timestamp:</span>
                  <span class="value">{{ formatEtherscanTime(trade.etherscan.timestamp) }}</span>
                </div>
                <div class="etherscan-info">
                  <span class="label">From:</span>
                  <span class="value">{{ formatAddress(trade.etherscan.from) }}</span>
                </div>
                <div class="etherscan-info">
                  <span class="label">To:</span>
                  <span class="value">{{ formatAddress(trade.etherscan.to) }}</span>
                </div>
                <div class="etherscan-info">
                  <span class="label">Value:</span>
                  <span class="value">{{ formatEtherValue(trade.etherscan.value) }} ETH</span>
                </div>
                <div class="etherscan-info">
                  <span class="label">Transaction Fee:</span>
                  <span class="value">{{ trade.etherscan.transactionFee ? trade.etherscan.transactionFee.toFixed(6) : 'N/A' }} ETH</span>
                </div>
                <div class="etherscan-info">
                  <span class="label">Gas Price:</span>
                  <span class="value">{{ trade.etherscan.gasPrice ? parseInt(trade.etherscan.gasPrice, 16).toLocaleString() : 'N/A' }} Gwei</span>
                </div>
              </div>
            </div>
            <!-- EtherscanÈìæÊé• -->
            <div class="trade-footer" v-if="trade.etherscan && trade.etherscan.hash">
              <a :href="`https://sepolia.etherscan.io/tx/${trade.etherscan.hash}`" 
                 target="_blank" 
                 class="tx-link">
                üîó View on Sepolia Etherscan
              </a>
            </div>
          </div>
          </div>
      </div>
    </div>
</template>

<script>
import { productAPI } from '@/service/api'
import { unifiedContractService as contractService } from '@/service/unifiedContractService.js'
import { getKycStatus, isKycVerified, getKycLevel, setKycLevel, KYC_STATUS, KYC_LEVELS } from '@/service/kycService.js'
import { useAuth } from '@/composables/useAuth.js'
import { useWallet } from '@/composables/useWallet.js'
import { isLoggedIn } from '@/utils/auth.js'
import contractTestService from '@/services/contractTestService'
import { ethers } from 'ethers'

const { nativeBalanceDisplay,nativeSymbol,nativeToAudDisplay,bigAudDisplay } = useWallet()

export default {
  name: 'TradeProjectView',
  props: {
    code: {
      type: String,
      required: false,
      default: null
    }
  },
  data() {
    return {
      tradeType: 'buy',
      tradeAmount: '',
      walletActivity: [],
      loading: false,
      error: null,
      errorType: null, // ÈîôËØØÁ±ªÂûã
      isInterestTrade: false, // ÊòØÂê¶‰∏∫Âà©ÊÅØ‰∫§Êòì
      showSuccessModal: false,
      showInsufficientBalanceModal: false,
      showLoadingModal: false,
      loadingStatus: '',
      userTokenBalance: 0,
      products: [],
      successData: {
        tradeType: '',
        amount: 0,
        transactionHash: '',
        blockNumber: 0
      },
      // ÂêàÁ∫¶ÊµãËØïÁõ∏ÂÖ≥
      contractInitialized: false,
      contractLoading: false,
      contractStatus: null,
      testResults: [],
      userAddress: '',
      tokenPrice: '',
      userTokenBalance: '',
      tradeHistory: [],
      testAmount: '',
      // È°πÁõÆÊï∞ÊçÆ
      projectData: null,
      projectLoading: true,
      projectError: null,
      // ÈîôËØØÊ∂àÊÅØÊò†Â∞Ñ
      errorMessages: {
        'insufficient_balance': 'You have insufficient funds',
        'insufficient_interest': 'Insufficient interest received amount',
        'input_required': 'Please enter the amount',
        'login_required': 'Please login to your account',
        'wallet_connection_required': 'Please connect your wallet',
        'address_retrieval_failed': 'Unable to retrieve wallet address',
        'kyc_verification_required': 'Please complete KYC verification',
        'whitelist_required': 'Your wallet is not whitelisted',
        'transaction_failed': 'Transaction failed',
        'network_error': 'Network error occurred',
        'unknown_error': 'An unknown error occurred'
      },
      // ËÆ§Ë¥≠Áõ∏ÂÖ≥Êï∞ÊçÆ
      subscriptionAmount: 0,
      contractTerms: {
        annualRate: 5.5,
        loanTerm: 365,
        minSubscription: 100,
        maxSubscription: 10000
      },
      // ËæìÂÖ•È™åËØÅÁä∂ÊÄÅ
      amountError: null,
      amountValid: false,
      // ÈÉ®ÁΩ≤Áä∂ÊÄÅÁõ∏ÂÖ≥
      deploymentStatus: false,
      deploymentLogs: [],
      deployedContracts: [],
      // ‰∫§‰∫íÁä∂ÊÄÅÁõ∏ÂÖ≥
      interactionStatus: false,
      interactionLogs: [],
      // ‰ΩôÈ¢ù‰ø°ÊÅØ
      balanceInfo: null
    }
  },
  computed: {
    projectCode() {
      // ‰ºòÂÖà‰ΩøÁî®propsÔºåÁÑ∂ÂêéÊòØË∑ØÁî±ÂèÇÊï∞ÔºåÊúÄÂêéÊòØÈªòËÆ§ÂÄº
      const code = this.code || this.$route.params.code || this.$route.query.code
      console.log('üîç TradeProjectView: Ëé∑ÂèñÈ°πÁõÆ‰ª£Á†Å:', {
        props: this.code,
        routeParams: this.$route.params.code,
        routeQuery: this.$route.query.code,
        final: code
      })
      return code || 'RWA001'
    },
    
    // ÊéßÂà∂ÊåâÈíÆÊòæÁ§∫
    showBuyButton() {
      return this.tradeType === 'buy' || !this.isInterestTrade
    },
    
    showSellButton() {
      return this.tradeType === 'sell' && this.isInterestTrade
    },
    project() {
      // ‰ΩøÁî®‰ªéÊï∞ÊçÆÂ∫ìÂä†ËΩΩÁöÑÈ°πÁõÆÊï∞ÊçÆ
      if (this.projectData) {
        console.log('TradeProjectView: ‰ΩøÁî®Êï∞ÊçÆÂ∫ìÈ°πÁõÆÊï∞ÊçÆ:', this.projectData)
        return this.projectData
      }
      return null
    },
    // Ë°®ÂçïÈ™åËØÅ
    isFormValid() {
      return this.amountValid && this.subscriptionAmount && this.subscriptionAmount > 0
    },
    // Èí±ÂåÖÁä∂ÊÄÅ
    connected() {
      const { connected } = useWallet()
      return connected.value
    },
    address() {
      const { address } = useWallet()
      return address.value
    },
    shortAddress() {
      const { shortAddress } = useWallet()
      return shortAddress.value
    },
    networkLabel() {
      const { networkLabel } = useWallet()
      return networkLabel.value
    },
    chainId() {
      const { chainId } = useWallet()
      return chainId.value
    },
    
    // Ëé∑ÂèñÈ°πÁõÆÁõÆÊ†áÊî∂ÁõäÁéá
    getProjectTargetYield() {
      if (!this.projectData) {
        console.warn('projectData ‰∏çÂ≠òÂú®')
        return null
      }
      
      console.log('Ëé∑ÂèñÁõÆÊ†áÊî∂ÁõäÁéáÔºåprojectData:', this.projectData)
      
      // ‰ºòÂÖà‰ªéÊï∞ÊçÆÂ∫ìÂ≠óÊÆµ interest_rate Ëé∑ÂèñÊï∞ÂÄº
      if (this.projectData.interest_rate) {
        const targetYieldValue = parseFloat(this.projectData.interest_rate)
        console.log('‰ªéÊï∞ÊçÆÂ∫ì interest_rate Ëé∑Âèñ:', targetYieldValue)
        return targetYieldValue
      }
      
      // ÂÖºÂÆπÊóßÂ≠óÊÆµ targetYield
      if (this.projectData.targetYield) {
        const targetYieldValue = parseFloat(this.projectData.targetYield)
        console.log('‰ªé targetYield Ëé∑Âèñ:', targetYieldValue)
        return targetYieldValue
      }
      
      // ÂÖºÂÆπÊóßÂ≠óÊÆµ interestRate
      if (this.projectData.interestRate) {
        const targetYieldValue = parseFloat(this.projectData.interestRate)
        console.log('‰ªé interestRate Ëé∑Âèñ:', targetYieldValue)
        return targetYieldValue
      }
      
      // ‰ªé metrics.targetLoanYield Ëß£Êûê (Ê†ºÂºè: "6.5% p.a.")
      if (this.projectData.metrics?.targetLoanYield) {
        const yieldStr = this.projectData.metrics.targetLoanYield
        console.log('‰ªé metrics.targetLoanYield Ëß£Êûê:', yieldStr)
        const match = yieldStr.match(/(\d+\.?\d*)/)
        const targetYieldValue = match ? parseFloat(match[1]) : null
        console.log('Ëß£ÊûêÁªìÊûú:', targetYieldValue)
        return targetYieldValue
      }
      
      console.warn('Êú™ÊâæÂà∞ÁõÆÊ†áÊî∂ÁõäÁéáÊï∞ÊçÆ')
      return null
    },
    
    // Ëé∑ÂèñÈ°πÁõÆË¥∑Ê¨æÊúüÈôê
    getProjectLoanTerm() {
      if (!this.projectData) {
        console.warn('projectData ‰∏çÂ≠òÂú®')
        return null
      }
      
      console.log('Ëé∑ÂèñË¥∑Ê¨æÊúüÈôêÔºåprojectData:', this.projectData)
      
      // ‰ºòÂÖà‰ªéÊï∞ÊçÆÂ∫ìÂ≠óÊÆµ loan_term_months Ëé∑ÂèñÊï∞ÂÄºÔºàÊúàÊï∞Ôºâ
      if (this.projectData.loan_term_months) {
        const termInDays = this.projectData.loan_term_months * 30.44 // ËΩ¨Êç¢‰∏∫Â§©Êï∞
        console.log('‰ªéÊï∞ÊçÆÂ∫ì loan_term_months Ëé∑Âèñ:', this.projectData.loan_term_months, '‰∏™ÊúàÔºåËΩ¨Êç¢‰∏∫Â§©Êï∞:', termInDays)
        return termInDays
      }
      
      // ÂÖºÂÆπÊóßÂ≠óÊÆµ loanTermMonths
      if (this.projectData.loanTermMonths) {
        const termInDays = this.projectData.loanTermMonths * 30.44 // ËΩ¨Êç¢‰∏∫Â§©Êï∞
        console.log('‰ªé loanTermMonths Ëé∑Âèñ:', this.projectData.loanTermMonths, '‰∏™ÊúàÔºåËΩ¨Êç¢‰∏∫Â§©Êï∞:', termInDays)
        return termInDays
      }
      
      // ÂÖºÂÆπÊóßÂ≠óÊÆµ loanTerm
      if (this.projectData.loanTerm) {
        const term = parseFloat(this.projectData.loanTerm)
        console.log('‰ªé loanTerm Ëé∑Âèñ:', term)
        return term
      }
      
      console.warn('Êú™ÊâæÂà∞Ë¥∑Ê¨æÊúüÈôêÊï∞ÊçÆ')
      return null
    }
  },
  methods: {
    // Âä†ËΩΩÂçï‰∏™‰∫ßÂìÅËØ¶ÊÉÖ
    async loadSingleProduct() {
      try {
        this.loading = true
        this.error = null
        console.log('üîÑ ProjectsView: ‰ªéÊï∞ÊçÆÂ∫ìÂä†ËΩΩÂçï‰∏™‰∫ßÂìÅÊï∞ÊçÆ...', this.code)
        
        const response = await productAPI.getProductByCode(this.code)
        
        if (response.status === 0) {
          // Êò†Â∞ÑÊï∞ÊçÆÂ∫ìÂ≠óÊÆµÂà∞ÂâçÁ´ØÊúüÊúõÁöÑÂ≠óÊÆµÂêç
          const rawData = response.data
          const product = {
            ...rawData,
            totalOffering: rawData.total_token,
            subscribed: rawData.current_subscribed_token,
            targetYield: rawData.target_yield,
            ltv: rawData.LTV,
            annualInterestRate: rawData.annual_interest_rate,
            loanAmount: rawData.loan_amount,
            valuation: rawData.valuation,
            image: rawData.image || this.getProductImage(rawData.code),
            
            // ÂéüÂßãÊï∞ÂÄºÁî®‰∫éËÆ°ÁÆó
            totalOfferingRaw: rawData.total_token || 0,
            subscribedRaw: rawData.current_subscribed_token || 0
          }
          
          // ÊûÑÂª∫‰∏éTradeProjectView‰∏ÄËá¥ÁöÑÊï∞ÊçÆÁªìÊûÑ
          this.currentProduct = {
            // Âü∫Êú¨‰ø°ÊÅØ
            code: product.code,
            name: product.name,
            image: product.image,
            subtitle: product.subtitle,
            type: product.type,
            risk: product.risk,
            targetYield: product.targetYield,
            status: product.status,
            summary: product.summary,
            
            // ÊäïËµÑ‰ø°ÊÅØ
            totalOffering: product.totalOffering,
            subscribed: product.subscribed,
            totalSubscriptionTokens: product.totalSubscriptionTokens,
            subscribedTokens: product.subscribedTokens,
            
            // ËÆ°ÁÆóÊåáÊ†á
            metrics: {
              currentElaraPrice: this.calculateTokenPrice(product),
              collateralPropertyValue: product.valuation || 'TBA',
              rentalIncome: this.calculateRentalIncome(product),
              targetLoanYield: `${product.targetYield}% p.a.`
            },
            
            // Key Facts ÂÖ≥ÈîÆ‰ø°ÊÅØ
            loanAmount: product.loanAmount,
            annualInterestRate: product.annualInterestRate,
            loanTerm: product.loanTerm,
            ltv: product.ltv,
            drawdownDate: product.drawdownDate,
            earlyRepayment: product.earlyRepayment,
            repaymentArrangement: product.repaymentArrangement,
            
            // Parties Áõ∏ÂÖ≥‰∏ª‰Ωì
            issuer: product.issuer,
            pwShareholders: product.pwShareholders,
            lender: product.lender,
            borrower: product.borrower,
            guarantor: product.guarantor,
            
            // Disbursement & Interest ÊîæÊ¨æÂíåÂà©ÊÅØ
            disbursementMethod: product.disbursementMethod,
            interest: product.interest,
            earlyRepaymentDetails: product.earlyRepaymentDetails,
            maturityDate: product.maturityDate,
            
            // Collateral ÊäµÊäºÂìÅ
            propertyAddress: product.propertyAddress,
            valuation: product.valuation,
            securityRank: product.securityRank,
            
            // Default & Remedies ËøùÁ∫¶ÂíåË°•ÊïëÊé™ÊñΩ
            defaultInterestRate: product.defaultInterestRate,
            defaultTriggers: product.defaultTriggers,
            defaultProcess: product.defaultProcess,
            
            // On-Chain & Documents Èìæ‰∏äÂíåÊñáÊ°£
            issuerToken: product.issuerToken,
            loanToken: product.loanToken,
            valuationReport: product.valuationReport,
            mortgageDeed: product.mortgageDeed
          }
          
          this.lastRefreshTime = new Date()
          console.log('‚úÖ ProjectsView: Âçï‰∏™‰∫ßÂìÅÊï∞ÊçÆÂä†ËΩΩÊàêÂäü:', this.currentProduct)
        } else {
          this.error = response.message || 'Ëé∑Âèñ‰∫ßÂìÅÊï∞ÊçÆÂ§±Ë¥•'
          console.error('‚ùå ProjectsView: APIËøîÂõûÈîôËØØ:', response)
        }
      } catch (error) {
        this.error = 'ÁΩëÁªúÈîôËØØÔºåÊó†Ê≥ïËé∑Âèñ‰∫ßÂìÅÊï∞ÊçÆ'
        console.error('‚ùå ProjectsView: Ëé∑ÂèñÂçï‰∏™‰∫ßÂìÅÊï∞ÊçÆÂ§±Ë¥•:', error)
      } finally {
        this.loading = false
      }
    },
    
    async loadProducts() {
      try {
        this.loading = true
        this.error = null
        console.log('üîÑ ‰ªéÊï∞ÊçÆÂ∫ìÂä†ËΩΩ‰∫ßÂìÅÊï∞ÊçÆ...')
        
        const response = await productAPI.getAllProducts()
        
        if (response.status === 0) {
          // Êò†Â∞ÑÊñ∞ÁöÑÊï∞ÊçÆÂ∫ìÂ≠óÊÆµÂà∞ÂâçÁ´ØÊúüÊúõÁöÑÂ≠óÊÆµÂêç
          this.products = (response.data || []).map(project => {
            const mappedProduct = {
              // Âü∫Á°Ä‰ø°ÊÅØ
              id: project.id,
              code: project.code,
              name: project.name,
              status: project.status,
              
              // ËÆ§Ë¥≠‰ø°ÊÅØ
              totalOffering: project.total_offering_token ? `AUD$${project.total_offering_token.toLocaleString()}` : 'AUD$0',
              subscribed: project.subscribe_token ? `AUD$${project.subscribe_token.toLocaleString()}` : 'AUD$0',
              
              // ÂéüÂßãÊï∞ÂÄºÁî®‰∫éËÆ°ÁÆó
              totalOfferingRaw: project.total_offering_token || 0,
              subscribedRaw: project.subscribe_token || 0,
              
              // Áâ©‰∏ö‰ø°ÊÅØ
              property_location: project.propertyLocation,
              property_state: project.propertyState,
              property_type: project.propertyType,
              property_value: project.propertyValue,
              property_summary: project.propertySummary,
              
              // Ë¥∑Ê¨æ‰ø°ÊÅØ
              loan_type: project.loanType,
              loan_product: project.loanProduct,
              loan_amount: project.loanAmount,
              loan_purpose: project.loanPurpose,
              loan_term_months: project.loanTermMonths,
              
              // Ë¥∑Ê¨æÊØîÁéá
              lvr: project.lvr,
              interest_rate: project.interestRate,
              default_rate: project.defaultRate,
              
              // Ë¥∑Ê¨æÂë®Êúü
              commencement_date: project.commencementDate,
              expiry_date: project.expiryDate,
              expected_recovery_date: project.expectedRecoveryDate,
              
              // ÂâçÁ´ØÊòæÁ§∫Â≠óÊÆµ
              subtitle: `${project.loanProduct} - ${project.propertyType}`,
              loanAmount: project.loanAmount ? `AUD$${project.loanAmount.toLocaleString()}` : 'AUD$0',
              loanTerm: `${project.loanTermMonths} months`,
              targetYield: project.interestRate,
              image: project.image || this.getProductImage(project.code)
            }
            
            // Ê∑ªÂä†ËÆ°ÁÆóÊåáÊ†á
            mappedProduct.metrics = {
              currentElaraPrice: this.calculateTokenPrice(mappedProduct),
              collateralPropertyValue: project.propertyValue ? `AUD$${project.propertyValue.toLocaleString()}` : 'TBA',
              rentalIncome: this.calculateRentalIncome(mappedProduct),
              targetLoanYield: `${project.interestRate}% p.a.`
            }
            
            return mappedProduct
          })
          this.lastRefreshTime = new Date()
          console.log('‚úÖ ‰∫ßÂìÅÊï∞ÊçÆÂä†ËΩΩÊàêÂäüÔºåÂÖ±', this.products.length, '‰∏™È°πÁõÆ')
        } else {
          this.error = response.message || 'Ëé∑Âèñ‰∫ßÂìÅÊï∞ÊçÆÂ§±Ë¥•'
          console.error('‚ùå APIËøîÂõûÈîôËØØ:', response)
        }
      } catch (error) {
        this.error = 'ÁΩëÁªúÈîôËØØÔºåÊó†Ê≥ïËé∑Âèñ‰∫ßÂìÅÊï∞ÊçÆ'
        console.error('‚ùå Âä†ËΩΩ‰∫ßÂìÅÊï∞ÊçÆÂ§±Ë¥•:', error)
      } finally {
        this.loading = false
      }
    },
        // Âà∑Êñ∞Êï∞ÊçÆ
    async refreshProducts() {
      console.log('üîÑ ÊâãÂä®Âà∑Êñ∞‰∫ßÂìÅÊï∞ÊçÆ...')
      if (this.isDetailView) {
        await this.loadSingleProduct()
      } else {
        await this.loadProducts()
      }
    },
    
    // ËÆæÁΩÆÊï∞ÊçÆÂ∫ìÂêåÊ≠•
    setupDatabaseSync() {
      const { subscribeProducts, subscribeNewProjects, getLastRefreshTime } = useDatabaseSync()
      
      // ËÆ¢ÈòÖ‰∫ßÂìÅÂàóË°®Êõ¥Êñ∞
      this.unsubscribeProducts = subscribeProducts((products) => {
        console.log('üì° ProjectsView: Êî∂Âà∞‰∫ßÂìÅÊï∞ÊçÆÊõ¥Êñ∞ÔºåÂÖ±', products.length, '‰∏™È°πÁõÆ')
        // Êò†Â∞ÑÊï∞ÊçÆÂ∫ìÂ≠óÊÆµÂà∞ÂâçÁ´ØÊúüÊúõÁöÑÂ≠óÊÆµÂêç
        this.products = products.map(product => ({
          ...product,
          totalOffering: product.total_token,
          subscribed: product.current_subscribed_token,
          targetYield: product.target_yield,
          ltv: product.LTV,
          annualInterestRate: product.annual_interest_rate,
          
          // ÂéüÂßãÊï∞ÂÄºÁî®‰∫éËÆ°ÁÆó
          totalOfferingRaw: product.total_token || 0,
          subscribedRaw: product.current_subscribed_token || 0,
          loanAmount: product.loan_amount,
          valuation: product.valuation,
          image: product.image || this.getProductImage(product.code)
        }))
        this.lastRefreshTime = new Date()
      })
      
      // ËÆ¢ÈòÖÊñ∞È°πÁõÆÈÄöÁü•
      this.unsubscribeNewProjects = subscribeNewProjects((newProjects) => {
        console.log('üÜï ProjectsView: ÂèëÁé∞', newProjects.length, '‰∏™Êñ∞È°πÁõÆ')
        // ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†Êñ∞È°πÁõÆÈÄöÁü•ÈÄªËæë
        this.showNewProjectsNotification(newProjects)
      })
      
      // ËÆæÁΩÆÊúÄÂêéÂà∑Êñ∞Êó∂Èó¥
      const lastRefresh = getLastRefreshTime()
      if (lastRefresh) {
        this.lastRefreshTime = lastRefresh
      }
    },
    
    // Ê∏ÖÁêÜÊï∞ÊçÆÂ∫ìÂêåÊ≠•
    cleanupDatabaseSync() {
      if (this.unsubscribeProducts) {
        this.unsubscribeProducts()
      }
      if (this.unsubscribeNewProjects) {
        this.unsubscribeNewProjects()
      }
    },
    
    // ÊòæÁ§∫Êñ∞È°πÁõÆÈÄöÁü•
    showNewProjectsNotification(newProjects) {
      if (newProjects.length > 0) {
        const projectNames = newProjects.map(p => p.name).join(', ')
        console.log('üÜï ÂèëÁé∞Êñ∞È°πÁõÆ:', projectNames)
        // ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†Áî®Êà∑ÈÄöÁü•
      }
    },
    
    // ÂºÄÂßãËá™Âä®Âà∑Êñ∞Ôºà‰øùÁïô‰Ωú‰∏∫Â§áÁî®Ôºâ
    startAutoRefresh() {
      // ÊØè30ÁßíËá™Âä®Âà∑Êñ∞‰∏ÄÊ¨°Êï∞ÊçÆ
      this.refreshInterval = setInterval(() => {
        console.log('üîÑ Ëá™Âä®Âà∑Êñ∞‰∫ßÂìÅÊï∞ÊçÆ...')
        this.loadProducts()
      }, 30) // 30Áßí
    },
    
    // ÂÅúÊ≠¢Ëá™Âä®Âà∑Êñ∞Ôºà‰øùÁïô‰Ωú‰∏∫Â§áÁî®Ôºâ
    stopAutoRefresh() {
      if (this.refreshInterval) {
        clearInterval(this.refreshInterval)
        this.refreshInterval = null
        console.log('‚èπÔ∏è ÂÅúÊ≠¢Ëá™Âä®Âà∑Êñ∞')
      }
    },
    projectData() {
      // ‰ªéProductDetailsInfoËé∑ÂèñÈ°πÁõÆÊï∞ÊçÆÔºà‰øùÁïô‰Ωú‰∏∫Â§áÁî®Ôºâ
      const product = this.project
      
      if (product) {
        console.log('üìä TradeProjectView: ‰ªéÊï∞ÊçÆÂ∫ìËé∑ÂèñÈ°πÁõÆÊï∞ÊçÆ:', product)
        
        // ÊûÑÂª∫Á¨¶ÂêàÊ®°ÊùøÈúÄÊ±ÇÁöÑÊï∞ÊçÆÁªìÊûÑÔºåÂÆåÊï¥Êò†Â∞ÑProductDetailsInfo.js‰∏≠ÁöÑÊâÄÊúâÂ≠óÊÆµ
        return {
          // Âü∫Êú¨‰ø°ÊÅØ
          code: product.code,
          name: product.name,
          image: product.image || this.getProductImage(product.code),
          subtitle: product.subtitle,
          type: product.type,
          region: product.region,
          risk: product.risk,
          targetYield: product.targetYield,
          status: product.status,
          summary: product.summary,
          
          // ÊäïËµÑ‰ø°ÊÅØ
          totalOffering: product.totalOffering,
          subscribed: product.subscribed,
          totalSubscriptionTokens: product.totalSubscriptionTokens,
          subscribedTokens: product.subscribedTokens,
          
          // ËÆ°ÁÆóÊåáÊ†á
          metrics: {
            currentElaraPrice: this.calculateTokenPrice(product),
            collateralPropertyValue: product.valuation || 'TBA',
            rentalIncome: this.calculateRentalIncome(product),
            targetLoanYield: `${product.targetYield}% p.a.`
          },
          
          // Key Facts ÂÖ≥ÈîÆ‰ø°ÊÅØ
          loanAmount: product.loanAmount,
          annualInterestRate: product.annualInterestRate,
          loanTerm: product.loanTerm,
          ltv: product.ltv,
          drawdownDate: product.drawdownDate,
          earlyRepayment: product.earlyRepayment,
          repaymentArrangement: product.repaymentArrangement,
          
          // Parties Áõ∏ÂÖ≥‰∏ª‰Ωì
          issuer: product.issuer,
          pwShareholders: product.pwShareholders,
          lender: product.lender,
          borrower: product.borrower,
          guarantor: product.guarantor,
          
          // Disbursement & Interest ÊîæÊ¨æÂíåÂà©ÊÅØ
          disbursementMethod: product.disbursementMethod,
          interest: product.interest,
          earlyRepaymentDetails: product.earlyRepaymentDetails,
          maturityDate: product.maturityDate,
          
          // Collateral ÊäµÊäºÂìÅ
          propertyAddress: product.propertyAddress,
          valuation: product.valuation,
          securityRank: product.securityRank,
          
          // Default & Remedies ËøùÁ∫¶ÂíåË°•ÊïëÊé™ÊñΩ
          defaultInterestRate: product.defaultInterestRate,
          defaultTriggers: product.defaultTriggers,
          defaultProcess: product.defaultProcess,
          
          // On-Chain & Documents Èìæ‰∏äÂíåÊñáÊ°£
          issuerToken: product.issuerToken,
          loanToken: product.loanToken,
          valuationReport: product.valuationReport,
          mortgageDeed: product.mortgageDeed
        }
      }
    },

    canSubmit() {
      return this.tradeAmount && this.tradeAmount > 0 && !this.loading
    },
    
    // Ê†ºÂºèÂåñÁöÑÈîôËØØÊ∂àÊÅØ
    formattedError() {
      if (!this.error) return null
      
      // Â¶ÇÊûúÊúâÈîôËØØÁ±ªÂûãÔºå‰ΩøÁî®Êò†Â∞ÑÁöÑÊ∂àÊÅØ
      if (this.errorType && this.errorMessages[this.errorType]) {
        return this.errorMessages[this.errorType]
      }
      
      // Âê¶ÂàôËøîÂõûÂéüÂßãÈîôËØØÊ∂àÊÅØ
      return this.error
    },
    
    // ‰ªéWallet Activity LogËé∑ÂèñÂΩìÂâçÈ°πÁõÆÁöÑ‰∫§ÊòìËÆ∞ÂΩï
    projectTrades() {
      if (!this.walletActivity || !Array.isArray(this.walletActivity)) {
        return []
      }
      
      // ËøáÊª§Âá∫ÂΩìÂâçÈ°πÁõÆÁöÑbuy/sell‰∫§ÊòìËÆ∞ÂΩï
      return this.walletActivity.filter(activity => 
        (activity.type === 'buy' || activity.type === 'sell') && 
        activity.project_code === this.projectCode
      ).sort((a, b) => b.timestamp - a.timestamp) // ÊåâÊó∂Èó¥ÂÄíÂ∫èÊéíÂàó
    },
    
    // Êü•ÁúãÂêàÁ∫¶ËØ¶ÊÉÖ
    viewContractDetails() {
      console.log('üìÑ Êü•ÁúãÂêàÁ∫¶ËØ¶ÊÉÖ:', this.projectCode)
      this.$router.push({
        path: '/contract',
        query: {
          projectCode: this.projectCode,
          projectName: this.projectData.name,
          projectImage: this.projectData.image,
          from: 'trade'
        }
      })
    },

    // Ê†ºÂºèÂåñÊï∞Â≠ó
    formatNumber(num) {
      if (!num) return '0.00'
      return parseFloat(num).toFixed(2)
    },

    // ËÆ°ÁÆóÈ¢ÑËÆ°Âà©ÊÅØ
    calculateInterest() {
      if (!this.subscriptionAmount) return '0.00'
      
      // ‰ΩøÁî®Âõ∫ÂÆöÁöÑÊ†áÂáÜÂà©ÁéáÂíåÊúüÈôêÔºå‰∏ç‰æùËµñÈ°πÁõÆÊï∞ÊçÆ
      const standardRate = 9.5 // Ê†áÂáÜÂπ¥ÂåñÂà©Áéá 9.5%
      const standardTermMonths = 12 // Ê†áÂáÜÊúüÈôê 12‰∏™Êúà
      
      console.log('ËÆ°ÁÆóÂà©ÊÅØÂèÇÊï∞ (‰ΩøÁî®Ê†áÂáÜÂÄº):', {
        subscriptionAmount: this.subscriptionAmount,
        standardRate,
        standardTermMonths
      })
      
      // ËÆ°ÁÆóÂà©ÊÅØ: ËÆ§Ë¥≠ÈáëÈ¢ù * Âπ¥ÂåñÊî∂ÁõäÁéá * Ë¥∑Ê¨æÊúüÈôê(Êúà) / 12
      const interest = (this.subscriptionAmount * standardRate / 100 * standardTermMonths / 12)
      console.log('Âà©ÊÅØËÆ°ÁÆóÁªìÊûú:', interest)
      return this.formatNumber(interest)
    },

    // ËÆ°ÁÆóÊÄª‰ª£Â∏ÅÈúÄÊ±Ç
    calculateTotalTokenNeeded() {
      if (!this.subscriptionAmount) return '0.00'
      
      const currentPrice = 1.00 // ÂΩìÂâç‰ª∑Ê†º $1.00
      const totalTokenNeeded = this.subscriptionAmount * currentPrice
      
      console.log('ËÆ°ÁÆóÊÄª‰ª£Â∏ÅÈúÄÊ±Ç:', {
        subscriptionAmount: this.subscriptionAmount,
        currentPrice,
        totalTokenNeeded
      })
      
      return this.formatNumber(totalTokenNeeded)
    },

    // Ëé∑ÂèñÈ°πÁõÆÁõÆÊ†áÊî∂ÁõäÁéá
    getProjectTargetYield() {
      if (!this.projectData) {
        console.warn('projectData ‰∏çÂ≠òÂú®')
        return null
      }
      
      console.log('Ëé∑ÂèñÁõÆÊ†áÊî∂ÁõäÁéáÔºåprojectData:', this.projectData)
      
      // ‰ºòÂÖà‰ªéÊï∞ÊçÆÂ∫ìÂ≠óÊÆµ interest_rate Ëé∑ÂèñÊï∞ÂÄº
      if (this.projectData.interest_rate) {
        const targetYieldValue = parseFloat(this.projectData.interest_rate)
        console.log('‰ªéÊï∞ÊçÆÂ∫ì interest_rate Ëé∑Âèñ:', targetYieldValue)
        return targetYieldValue
      }
      
      // ÂÖºÂÆπÊóßÂ≠óÊÆµ targetYield
      if (this.projectData.targetYield) {
        const targetYieldValue = parseFloat(this.projectData.targetYield)
        console.log('‰ªé targetYield Ëé∑Âèñ:', targetYieldValue)
        return targetYieldValue
      }
      
      // ÂÖºÂÆπÊóßÂ≠óÊÆµ interestRate
      if (this.projectData.interestRate) {
        const targetYieldValue = parseFloat(this.projectData.interestRate)
        console.log('‰ªé interestRate Ëé∑Âèñ:', targetYieldValue)
        return targetYieldValue
      }
      
      // ‰ªé metrics.targetLoanYield Ëß£Êûê (Ê†ºÂºè: "6.5% p.a.")
      if (this.projectData.metrics?.targetLoanYield) {
        const yieldStr = this.projectData.metrics.targetLoanYield
        console.log('‰ªé metrics.targetLoanYield Ëß£Êûê:', yieldStr)
        const match = yieldStr.match(/(\d+\.?\d*)/)
        const targetYieldValue = match ? parseFloat(match[1]) : null
        console.log('Ëß£ÊûêÁªìÊûú:', targetYieldValue)
        return targetYieldValue
      }
      
      console.warn('Êú™ÊâæÂà∞ÁõÆÊ†áÊî∂ÁõäÁéáÊï∞ÊçÆ')
      return null
    },

    // Ëé∑ÂèñÈ°πÁõÆË¥∑Ê¨æÊúüÈôê
    getProjectLoanTerm() {
      if (!this.projectData) {
        console.warn('projectData ‰∏çÂ≠òÂú®')
        return null
      }
      
      console.log('Ëé∑ÂèñË¥∑Ê¨æÊúüÈôêÔºåprojectData:', this.projectData)
      
      // ‰ºòÂÖà‰ªéÊï∞ÊçÆÂ∫ìÂ≠óÊÆµ loan_term_months Ëé∑ÂèñÊï∞ÂÄºÔºàÊúàÊï∞Ôºâ
      if (this.projectData.loan_term_months) {
        const termInDays = this.projectData.loan_term_months * 30.44 // ËΩ¨Êç¢‰∏∫Â§©Êï∞
        console.log('‰ªéÊï∞ÊçÆÂ∫ì loan_term_months Ëé∑Âèñ:', this.projectData.loan_term_months, '‰∏™ÊúàÔºåËΩ¨Êç¢‰∏∫Â§©Êï∞:', termInDays)
        return termInDays
      }
      
      // ÂÖºÂÆπÊóßÂ≠óÊÆµ loanTermMonths
      if (this.projectData.loanTermMonths) {
        const termInDays = this.projectData.loanTermMonths * 30.44 // ËΩ¨Êç¢‰∏∫Â§©Êï∞
        console.log('‰ªé loanTermMonths Ëé∑Âèñ:', this.projectData.loanTermMonths, '‰∏™ÊúàÔºåËΩ¨Êç¢‰∏∫Â§©Êï∞:', termInDays)
        return termInDays
      }
      
      // ÂÖºÂÆπÊóßÂ≠óÊÆµ loanTerm
      if (this.projectData.loanTerm) {
        const term = parseFloat(this.projectData.loanTerm)
        console.log('‰ªé loanTerm Ëé∑Âèñ:', term)
        return term
      }
      
      console.warn('Êú™ÊâæÂà∞Ë¥∑Ê¨æÊúüÈôêÊï∞ÊçÆ')
      return null
    },

    // Ê∑ªÂä†Êó•Âøó
    addLog(logs, message, type = 'info') {
      const now = new Date()
      const time = now.toLocaleTimeString('en-US', { 
        hour12: true, 
        hour: '2-digit', 
        minute: '2-digit', 
        second: '2-digit' 
      })
      logs.push({ time, message, type })
    },

    // Ëé∑ÂèñÂΩìÂâçÈìæID
    getCurrentChainId() {
      if (this.chainId) {
        return this.chainId
      }
      return 11155111 // ÈªòËÆ§‰ΩøÁî® Sepolia ÊµãËØïÁΩë
    },

    // ÈÉ®ÁΩ≤ÂêàÁ∫¶‰∏éËÆ§Ë¥≠
    async deployContractsWithSubscription() {
      try {
        this.loading = true
        this.error = null
        this.deploymentStatus = true
        this.deploymentLogs = []
        
        this.addLog(this.deploymentLogs, 'ÂºÄÂßãËÆ§Ë¥≠ÊµÅÁ®ã...', 'info')
        this.addLog(this.deploymentLogs, `ÂΩìÂâçÁΩëÁªú: ${this.networkLabel || 'Êú™Áü•ÁΩëÁªú'}`, 'info')
        this.addLog(this.deploymentLogs, `ÈìæID: ${this.getCurrentChainId()}`, 'info')
        this.addLog(this.deploymentLogs, `È°πÁõÆ‰ª£Âè∑: ${this.projectCode}`, 'info')
        this.addLog(this.deploymentLogs, `ËÆ§Ë¥≠ÈáëÈ¢ù: ${this.formatNumber(this.subscriptionAmount)} LPT`, 'info')
        this.addLog(this.deploymentLogs, `Âπ¥ÂåñÂà©Áéá: 9.5% (Ê†áÂáÜËÆæÂÆö)`, 'info')
        this.addLog(this.deploymentLogs, `Ë¥∑Ê¨æÊúüÈôê: 12 ‰∏™Êúà (Ê†áÂáÜËÆæÂÆö)`, 'info')
        
        // Ë∞ÉÁî®ÂêàÁ∫¶ÊúçÂä°Ëé∑ÂèñÁúüÂÆûÂêàÁ∫¶Âú∞ÂùÄ
        const result = await contractTestService.deployContractsWithSubscription({
          subscriptionAmount: this.subscriptionAmount,
          annualRate: 9.5, // ‰ΩøÁî®Ê†áÂáÜÂà©Áéá
          loanTerm: 365, // ‰ΩøÁî®Ê†áÂáÜÊúüÈôê (12‰∏™Êúà = 365Â§©)
          projectCode: this.projectCode,
          projectName: this.projectCode, // ‰ΩøÁî®È°πÁõÆ‰ª£Á†Å‰Ωú‰∏∫ÂêçÁß∞
          walletAddress: this.address,
          chainId: this.getCurrentChainId()
        })
        
        this.addLog(this.deploymentLogs, 'Ëé∑ÂèñÂêàÁ∫¶Âú∞ÂùÄ...', 'info')
        this.addLog(this.deploymentLogs, `ÁΩëÁªú: ${result.networkInfo.name}`, 'info')
        this.addLog(this.deploymentLogs, `Ë¥∑Ê¨æID: ${result.loanId}`, 'info')
        
        // ÂèëÈÄÅETH‰∫§ÊòìÂà∞ÊåáÂÆöÂú∞ÂùÄ
        await this.sendEthTransaction()
        
        // ‰ΩøÁî®ÊúçÂä°ËøîÂõûÁöÑÂêàÁ∫¶Âú∞ÂùÄ
        this.deployedContracts = [
          { name: 'KYCRegistry', address: result.contracts.kycRegistry },
          { name: 'LPT', address: result.contracts.lpt },
          { name: 'LIT', address: result.contracts.lit },
          { name: 'LoanIssuer', address: result.contracts.loanIssuer }
        ]
        
        this.addLog(this.deploymentLogs, `‰∫§ÊòìÂìàÂ∏å: ${result.transactionHash}`, 'info')
        this.addLog(this.deploymentLogs, `Gas ‰ΩøÁî®: ${result.gasUsed}`, 'info')
        this.addLog(this.deploymentLogs, `Âå∫ÂùóÂè∑: ${result.blockNumber}`, 'info')
        this.addLog(this.deploymentLogs, 'ËÆ§Ë¥≠ÂÆåÊàê! ÂêàÁ∫¶Âú∞ÂùÄÂ∑≤Ëé∑Âèñ', 'success')
        
        // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
        this.showSuccessModal = true
        this.successData = {
          tradeType: 'subscription',
          amount: this.subscriptionAmount,
          transactionHash: result.transactionHash,
          blockNumber: result.blockNumber
        }
        
        // ÂºÄÂßãÂêàÁ∫¶‰∫§‰∫íÊµãËØï
        await this.startContractInteraction()
        
      } catch (err) {
        this.error = `ËÆ§Ë¥≠Â§±Ë¥•: ${err.message}`
        this.addLog(this.deploymentLogs, `ËÆ§Ë¥≠Â§±Ë¥•: ${err.message}`, 'error')
      } finally {
        this.loading = false
      }
    },

    // ÂºÄÂßãÂêàÁ∫¶‰∫§‰∫íÊµãËØï
    async startContractInteraction() {
      try {
        this.interactionStatus = true
        this.interactionLogs = []
        
        this.addLog(this.interactionLogs, 'ÂºÄÂßãÂêàÁ∫¶‰∫§‰∫íÊµãËØï...', 'info')
        
        // Ê®°ÊãüÂêàÁ∫¶‰∫§‰∫í
        await new Promise(resolve => setTimeout(resolve, 1000))
        this.addLog(this.interactionLogs, 'ÊµãËØï LPT ‰ª£Â∏ÅÈì∏ÈÄ†...', 'info')
        
        await new Promise(resolve => setTimeout(resolve, 1000))
        this.addLog(this.interactionLogs, 'ÊµãËØï LIT ‰ª£Â∏ÅÈì∏ÈÄ†...', 'info')
        
        await new Promise(resolve => setTimeout(resolve, 1000))
        this.addLog(this.interactionLogs, 'ÊµãËØïË¥∑Ê¨æÂàõÂª∫...', 'info')
        
        await new Promise(resolve => setTimeout(resolve, 1000))
        this.addLog(this.interactionLogs, 'ÂêàÁ∫¶‰∫§‰∫íÊµãËØïÂÆåÊàê!', 'success')
        
        // Êõ¥Êñ∞‰ΩôÈ¢ù‰ø°ÊÅØ
        this.balanceInfo = {
          lpt: this.formatNumber(this.subscriptionAmount),
          lit: this.calculateInterest(),
          eth: '0.1'
        }
        
      } catch (err) {
        this.addLog(this.interactionLogs, `‰∫§‰∫íÊµãËØïÂ§±Ë¥•: ${err.message}`, 'error')
      }
    },

    // Â§çÂà∂Âú∞ÂùÄ
    async copyAddress(address) {
      try {
        await navigator.clipboard.writeText(address)
        this.addLog(this.interactionLogs, `Âú∞ÂùÄÂ∑≤Â§çÂà∂: ${address}`, 'success')
      } catch (err) {
        console.error('Â§çÂà∂Â§±Ë¥•:', err)
      }
    },

    // Âä†ËΩΩÂêàÁ∫¶Êù°Ê¨æ
    async loadContractTerms() {
      try {
        const result = await contractTestService.getContractTerms()
        if (result.success) {
          this.contractTerms = {
            annualRate: result.terms.annualRate,
            loanTerm: result.terms.loanTerm,
            minSubscription: result.terms.minSubscription,
            maxSubscription: result.terms.maxSubscription
          }
        }
      } catch (error) {
        console.error('Âä†ËΩΩÂêàÁ∫¶Êù°Ê¨æÂ§±Ë¥•:', error)
      }
    },

    // ËøûÊé•Èí±ÂåÖ
    async connectWallet() {
      try {
        const { connect } = useWallet()
        await connect()
        console.log('Èí±ÂåÖËøûÊé•ÊàêÂäü')
      } catch (error) {
        console.error('Èí±ÂåÖËøûÊé•Â§±Ë¥•:', error)
        this.error = 'Èí±ÂåÖËøûÊé•Â§±Ë¥•: ' + error.message
      }
    },

    // Êñ≠ÂºÄÈí±ÂåÖËøûÊé•
    async disconnectWallet() {
      try {
        const { disconnect } = useWallet()
        await disconnect()
        console.log('Èí±ÂåÖÊñ≠ÂºÄËøûÊé•ÊàêÂäü')
        // Ê∏ÖÁ©∫Áõ∏ÂÖ≥Áä∂ÊÄÅ
        this.deploymentStatus = false
        this.deploymentLogs = []
        this.deployedContracts = []
        this.interactionStatus = false
        this.interactionLogs = []
        this.balanceInfo = null
      } catch (error) {
        console.error('Èí±ÂåÖÊñ≠ÂºÄËøûÊé•Â§±Ë¥•:', error)
      }
    },

    // Ë∑≥ËΩ¨Âà∞Èí±ÂåÖÈ°µÈù¢
    goToWallet() {
      console.log('Ë∑≥ËΩ¨Âà∞Èí±ÂåÖÈ°µÈù¢')
      this.$router.push('/wallet')
    },

    // ÂèëÈÄÅETH‰∫§ÊòìÂà∞ÊåáÂÆöÂú∞ÂùÄ
    async sendEthTransaction() {
      try {
        this.addLog(this.deploymentLogs, 'ÂáÜÂ§áÂèëÈÄÅETH‰∫§Êòì...', 'info')
        
        // Ê£ÄÊü•MetaMaskÊòØÂê¶ÂèØÁî®
        if (!window.ethereum) {
          throw new Error('MetaMaskÊú™ÂÆâË£ÖÊàñÊú™ÂêØÁî®')
        }
        
        // ËÆ°ÁÆóÈúÄË¶ÅÂèëÈÄÅÁöÑETHÊï∞ÈáèÔºàËÆ§Ë¥≠ÈáëÈ¢ùËΩ¨Êç¢‰∏∫ETHÔºâ
        const ethAmount = this.subscriptionAmount || 0
        const ethAmountWei = ethers.parseEther(ethAmount.toString())
        
        // Ê£ÄÊü•Áî®Êà∑ETH‰ΩôÈ¢ù
        const provider = new ethers.BrowserProvider(window.ethereum)
        const balance = await provider.getBalance(this.address)
        const balanceEth = parseFloat(ethers.formatEther(balance))
        
        this.addLog(this.deploymentLogs, `Áî®Êà∑ETH‰ΩôÈ¢ù: ${balanceEth.toFixed(4)} ETH`, 'info')
        this.addLog(this.deploymentLogs, `ÂèëÈÄÅÈáëÈ¢ù: ${ethAmount} ETH`, 'info')
        this.addLog(this.deploymentLogs, `ÁõÆÊ†áÂú∞ÂùÄ: 0x13159e6417D98528C220b12Ec4950D5A343E5eAA`, 'info')
        
        // Ê£ÄÊü•‰ΩôÈ¢ùÊòØÂê¶Ë∂≥Â§üÔºàÂåÖÊã¨gasË¥πÁî®Ôºâ
        const feeData = await provider.getFeeData()
        const gasPrice = feeData.gasPrice || BigInt(20000000000) // 20 Gwei ÈªòËÆ§ÂÄº
        const gasLimit = BigInt(21000)
        const totalCost = ethAmountWei + (gasPrice * gasLimit)
        
        if (balance < totalCost) {
          throw new Error(`‰ΩôÈ¢ù‰∏çË∂≥ÔºÅÈúÄË¶Å ${ethers.formatEther(totalCost)} ETHÔºåÂΩìÂâç‰ΩôÈ¢ù: ${balanceEth} ETH`)
        }
        
        // ÂáÜÂ§á‰∫§ÊòìÂèÇÊï∞
        const transactionParams = {
          from: this.address,
          to: '0x13159e6417D98528C220b12Ec4950D5A343E5eAA',
          value: ethAmountWei.toString(),
          gas: gasLimit.toString(), // ‰ΩøÁî®ËÆ°ÁÆóÂá∫ÁöÑgasÈôêÂà∂
        }
        
        // Ê†πÊçÆÁΩëÁªúÁ±ªÂûãËÆæÁΩÆgasË¥πÁî®
        if (feeData.gasPrice) {
          // ‰º†ÁªüÁΩëÁªú‰ΩøÁî®gasPrice
          transactionParams.gasPrice = gasPrice.toString()
        } else {
          // EIP-1559ÁΩëÁªú‰ΩøÁî®maxFeePerGas
          transactionParams.maxFeePerGas = gasPrice.toString()
          transactionParams.maxPriorityFeePerGas = (gasPrice / BigInt(2)).toString()
        }
        
        this.addLog(this.deploymentLogs, 'ËØ∑Ê±ÇÁî®Êà∑Á°ÆËÆ§‰∫§Êòì...', 'info')
        this.addLog(this.deploymentLogs, `Gas‰ª∑Ê†º: ${ethers.formatUnits(gasPrice, 'gwei')} Gwei`, 'info')
        this.addLog(this.deploymentLogs, `È¢Ñ‰º∞GasË¥πÁî®: ${ethers.formatEther(gasPrice * gasLimit)} ETH`, 'info')
        
        // Ë∞ÉÁî®MetaMaskÂèëÈÄÅ‰∫§Êòì
        const txHash = await window.ethereum.request({
          method: 'eth_sendTransaction',
          params: [transactionParams]
        })
        
        if (!txHash) {
          throw new Error('‰∫§ÊòìË¢´Áî®Êà∑ÂèñÊ∂àÊàñÂ§±Ë¥•')
        }
        
        this.addLog(this.deploymentLogs, `‰∫§ÊòìÂ∑≤Êèê‰∫§ÔºåÂìàÂ∏å: ${txHash}`, 'success')
        this.addLog(this.deploymentLogs, 'Á≠âÂæÖ‰∫§ÊòìÁ°ÆËÆ§...', 'info')
        
        // Á≠âÂæÖ‰∫§ÊòìÁ°ÆËÆ§
        const receipt = await this.waitForTransactionConfirmation(txHash)
        
        if (receipt.status === '0x1') {
          this.addLog(this.deploymentLogs, `‰∫§ÊòìÁ°ÆËÆ§ÊàêÂäüÔºÅÂå∫ÂùóÂè∑: ${receipt.blockNumber}`, 'success')
          this.addLog(this.deploymentLogs, `Gas‰ΩøÁî®: ${receipt.gasUsed}`, 'info')
        } else {
          throw new Error('‰∫§ÊòìÂ§±Ë¥•')
        }
        
      } catch (error) {
        console.error('ETH‰∫§ÊòìÂ§±Ë¥•:', error)
        this.addLog(this.deploymentLogs, `ETH‰∫§ÊòìÂ§±Ë¥•: ${error.message}`, 'error')
        throw error
      }
    },

    // Á≠âÂæÖ‰∫§ÊòìÁ°ÆËÆ§
    async waitForTransactionConfirmation(txHash) {
      const provider = new ethers.BrowserProvider(window.ethereum)
      
      // Á≠âÂæÖ‰∫§ÊòìË¢´ÊåñÁüø
      const receipt = await provider.waitForTransaction(txHash, 1) // Á≠âÂæÖ1‰∏™Á°ÆËÆ§
      return receipt
    },

    async loadProjectData() {
      try {
        this.projectLoading = true
        this.projectError = null
        console.log('üîÑ TradeProjectView: ‰ªéÊï∞ÊçÆÂ∫ìÂä†ËΩΩÈ°πÁõÆÊï∞ÊçÆ...', this.projectCode)
        
        const response = await productAPI.getProductByCode(this.projectCode)
        
        if (response.status === 0) {
          // Âü∫‰∫écall-mysql-project-table.jsÁöÑSQLÊü•ËØ¢ÁªìÊûÑËøõË°åÊï∞ÊçÆÊò†Â∞Ñ
          const project = response.data
          
          // ËÆ°ÁÆóËÆ§Ë¥≠ËøõÂ∫¶
          const totalOfferingRaw = parseFloat(project.total_offering_token) || 0
          const subscribedRaw = parseFloat(project.subscribe_token) || 0
          const subscriptionProgress = totalOfferingRaw > 0 ? (subscribedRaw / totalOfferingRaw * 100).toFixed(2) : 0
          
          const mappedProduct = {
            // Âü∫Á°Ä‰ø°ÊÅØ - ÂÆåÂÖ®Âü∫‰∫éÊï∞ÊçÆÂ∫ìÂ≠óÊÆµ
            id: project.id,
            code: project.project_code,
            name: project.project_name,
            status: project.loan_status,
            created_at: project.created_at,
            
            // ËÆ§Ë¥≠‰ø°ÊÅØ - Âü∫‰∫éÊï∞ÊçÆÂ∫ìÂ≠óÊÆµ
            totalOffering: totalOfferingRaw > 0 ? `AUD$${totalOfferingRaw.toLocaleString()}` : 'AUD$0',
            subscribed: subscribedRaw > 0 ? `AUD$${subscribedRaw.toLocaleString()}` : 'AUD$0',
            subscriptionProgress: `${subscriptionProgress}%`,
            
            // ÂéüÂßãÊï∞ÂÄºÁî®‰∫éËÆ°ÁÆó
            totalOfferingRaw: totalOfferingRaw,
            subscribedRaw: subscribedRaw,
            
            // Áâ©‰∏ö‰ø°ÊÅØ - Âü∫‰∫éÊï∞ÊçÆÂ∫ìÂ≠óÊÆµ
            property_location: project.property_location,
            property_state: project.property_state,
            property_type: project.property_type,
            property_value: project.property_value,
            property_summary: project.property_summary,
            
            // Ë¥∑Ê¨æ‰ø°ÊÅØ - Âü∫‰∫éÊï∞ÊçÆÂ∫ìÂ≠óÊÆµ
            loan_type: project.loan_type,
            loan_product: project.loan_product,
            loan_amount: project.loan_amount,
            loan_purpose: project.loan_purpose,
            loan_term_months: project.loan_term_months,
            
            // Ë¥∑Ê¨æÊØîÁéá - Âü∫‰∫éÊï∞ÊçÆÂ∫ìÂ≠óÊÆµ
            lvr: project.lvr,
            interest_rate: project.interest_rate,
            default_rate: project.default_rate,
            
            // Ë¥∑Ê¨æÂë®Êúü - Âü∫‰∫éÊï∞ÊçÆÂ∫ìÂ≠óÊÆµ
            commencement_date: project.commencement_date,
            expiry_date: project.expiry_date,
            expected_recovery_date: project.expected_recovery_date,
            
            // ÂâçÁ´ØÊòæÁ§∫Â≠óÊÆµ - Âü∫‰∫éÊï∞ÊçÆÂ∫ìÂ≠óÊÆµÊ†ºÂºèÂåñ
            subtitle: `${project.loan_product} - ${project.property_type}`,
            loanAmount: project.loan_amount ? `AUD$${parseFloat(project.loan_amount).toLocaleString()}` : 'AUD$0',
            loanTerm: `${project.loan_term_months} months`,
            targetYield: project.interest_rate ? `${project.interest_rate}% p.a.` : 'TBA',
            image: project.image || this.getProductImage(project.project_code),
            
            // ÂÖºÂÆπÂ≠óÊÆµÔºàÁî®‰∫éÊ®°ÊùøÊòæÁ§∫Ôºâ
            propertyType: project.property_type,
            propertyLocation: project.property_location,
            loanProduct: project.loan_product,
            propertyValue: project.property_value ? `AUD$${parseFloat(project.property_value).toLocaleString()}` : 'TBA',
            ltv: project.lvr ? `${project.lvr}%` : 'TBA'
          }
          
          // Ê∑ªÂä†ËÆ°ÁÆóÊåáÊ†á - Âü∫‰∫éÊï∞ÊçÆÂ∫ìÂ≠óÊÆµËÆ°ÁÆó
          mappedProduct.metrics = {
            currentElaraPrice: this.calculateTokenPrice(mappedProduct),
            collateralPropertyValue: project.property_value ? `AUD$${parseFloat(project.property_value).toLocaleString()}` : 'TBA',
            rentalIncome: this.calculateRentalIncome(mappedProduct),
            targetLoanYield: project.interest_rate ? `${project.interest_rate}% p.a.` : 'TBA',
            loanToValue: project.lvr ? `${project.lvr}%` : 'TBA',
            defaultRate: project.default_rate ? `${project.default_rate}%` : 'TBA'
          }
          
          // Ê∑ªÂä†Êó∂Èó¥‰ø°ÊÅØ
          mappedProduct.timeline = {
            created: project.created_at,
            commencement: project.commencement_date,
            expiry: project.expiry_date,
            expectedRecovery: project.expected_recovery_date
          }
          
          this.projectData = mappedProduct
          console.log('‚úÖ TradeProjectView: È°πÁõÆÊï∞ÊçÆÊò†Â∞ÑÊàêÂäü:', this.projectData)
          console.log('üìä ËÆ§Ë¥≠ËøõÂ∫¶:', subscriptionProgress + '%', `(${subscribedRaw}/${totalOfferingRaw})`)
        } else {
          this.projectError = response.message || 'Ëé∑ÂèñÈ°πÁõÆÊï∞ÊçÆÂ§±Ë¥•'
          console.error('‚ùå TradeProjectView: APIËøîÂõûÈîôËØØ:', response)
        }
      } catch (error) {
        this.projectError = 'ÁΩëÁªúÈîôËØØÔºåÊó†Ê≥ïËé∑ÂèñÈ°πÁõÆÊï∞ÊçÆ'
        console.error('‚ùå TradeProjectView: Âä†ËΩΩÈ°πÁõÆÊï∞ÊçÆÂ§±Ë¥•:', error)
      } finally {
        this.projectLoading = false
      }
    },
    
    getProductImage(code) {
      const imageMap = {
        'RWA001': '/pics/TYMU.png',
        'RWA002': '/pics/SQNB.png',
        'RWA003': '/pics/LZYT.png',
        'YYD': '/pics/YYD.png',
        'COMP': '/pics/TYMU.png'
      }
      return imageMap[code] || '/pics/TYMU.png'
    },
    
    calculateTokenPrice(product) {
      // Âü∫‰∫éÊï∞ÊçÆÂ∫ìÂ≠óÊÆµËÆ°ÁÆó‰ª£Â∏Å‰ª∑Ê†º
      const basePrice = 1.00
      const yieldMultiplier = (parseFloat(product.interest_rate) || 6.0) / 6.0
      const adjustedPrice = basePrice * yieldMultiplier
      return `AUD$${adjustedPrice.toFixed(2)}`
    },
    
    calculateRentalIncome(product) {
      // Âü∫‰∫éÊï∞ÊçÆÂ∫ìÂ≠óÊÆµËÆ°ÁÆóÁßüÈáëÊî∂ÂÖ•
      if (!product.property_value || product.property_value === 'TBA') {
        return 'TBA'
      }
      
      const propertyValue = parseFloat(product.property_value) || 0
      const interestRate = parseFloat(product.interest_rate) || 6.0
      const monthlyYield = interestRate / 12 / 100
      const estimatedRental = propertyValue * monthlyYield
      
      return `AUD$${estimatedRental.toLocaleString('en-AU', { maximumFractionDigits: 0 })} / month`
    },
    
    calculateTotal() {
      if (!this.tradeAmount) return '0.00'
      const amount = parseFloat(this.tradeAmount)
      // const price = 1.00 // Âõ∫ÂÆö‰ª∑Ê†ºÔºå‰ªéÈ°πÁõÆÊï∞ÊçÆËé∑Âèñ
      return (amount * price).toFixed(2)
    },
    
    formatTime(timestamp) {
      return new Date(timestamp).toLocaleString()
    },

    // ‰ªéEtherscan APIËé∑Âèñ‰∫§ÊòìËØ¶ÊÉÖ
    async fetchTransactionDetails(txHash) {
      try {
        console.log('üîç Ê≠£Âú®‰ªéEtherscanËé∑Âèñ‰∫§ÊòìËØ¶ÊÉÖ:', txHash)
        
        // Etherscan Sepolia API (‰ΩøÁî®ÂÖçË¥πAPIÔºåÊó†ÈúÄAPI Key)
        const apiUrl = `https://api-sepolia.etherscan.io/api?module=proxy&action=eth_getTransactionByHash&txhash=${txHash}`
        
        const response = await fetch(apiUrl)
        const data = await response.json()
        
        if (data.result) {
          console.log('‚úÖ ÊàêÂäüËé∑Âèñ‰∫§ÊòìËØ¶ÊÉÖ:', data.result)
          
          // Ëé∑Âèñ‰∫§ÊòìÊî∂ÊçÆ
          const receiptUrl = `https://api-sepolia.etherscan.io/api?module=proxy&action=eth_getTransactionReceipt&txhash=${txHash}`
          const receiptResponse = await fetch(receiptUrl)
          const receiptData = await receiptResponse.json()
          
          return {
            success: true,
            transaction: data.result,
            receipt: receiptData.result,
            // ÊèêÂèñÂÖ≥ÈîÆ‰ø°ÊÅØ
            from: data.result.from,
            to: data.result.to,
            value: data.result.value,
            gasUsed: receiptData.result ? receiptData.result.gasUsed : null,
            gasPrice: data.result.gasPrice,
            blockNumber: data.result.blockNumber,
            blockHash: data.result.blockHash,
            status: receiptData.result ? receiptData.result.status : null
          }
        } else {
          console.warn('‚ö†Ô∏è ‰∫§ÊòìËØ¶ÊÉÖËé∑ÂèñÂ§±Ë¥•:', data.message)
          return {
            success: false,
            error: data.message || 'Failed to fetch transaction details'
          }
        }
      } catch (error) {
        console.error('‚ùå Ëé∑Âèñ‰∫§ÊòìËØ¶ÊÉÖÊó∂ÂèëÁîüÈîôËØØ:', error)
        return {
          success: false,
          error: error.message
        }
      }
    },


    cancelTrade() {
      this.$router.back()
    },

    // ÂàùÂßãÂåñ‰∫§ÊòìÁ±ªÂûã
    initializeTradeType() {
      const query = this.$route.query
      console.log('üîç TradeProjectView: Ê£ÄÊü•Ë∑ØÁî±ÂèÇÊï∞:', query)
      
      if (query.type === 'sell' && query.interest === 'true') {
        // Âá∫ÂîÆÂà©ÊÅØ
        this.tradeType = 'sell'
        this.isInterestTrade = true
        console.log('‚úÖ ËÆæÁΩÆ‰∏∫Âá∫ÂîÆÂà©ÊÅØÊ®°Âºè')
      } else if (query.type === 'buy') {
        // Ë¥≠‰π∞
        this.tradeType = 'buy'
        this.isInterestTrade = false
        console.log('‚úÖ ËÆæÁΩÆ‰∏∫Ë¥≠‰π∞Ê®°Âºè')
      } else {
        // ÈªòËÆ§Ë¥≠‰π∞Ê®°Âºè
        this.tradeType = 'buy'
        this.isInterestTrade = false
        console.log('‚úÖ ËÆæÁΩÆ‰∏∫ÈªòËÆ§Ë¥≠‰π∞Ê®°Âºè')
      }
    },

    // ÈÄâÊã©‰∫§ÊòìÁ±ªÂûãÂπ∂ÊâßË°åÂÆåÊï¥ÊµÅÁ®ã
    async selectTradeType(type) {
      // ËÆæÁΩÆ‰∫§ÊòìÁ±ªÂûã
      this.tradeType = type
      
      // Â¶ÇÊûúÊ≤°ÊúâËæìÂÖ•ÈáëÈ¢ùÔºåÊèêÁ§∫Áî®Êà∑ËæìÂÖ•
      if (!this.tradeAmount || this.tradeAmount <= 0) {
        this.errorType = 'input_required'
        this.error = `ËØ∑ÂÖàËæìÂÖ•${type === 'buy' ? 'Ë¥≠‰π∞' : 'Âá∫ÂîÆ'}Êï∞Èáè`
        this.addTestResult('error', 'Input Required', `ËØ∑ÂÖàËæìÂÖ•${type === 'buy' ? 'Ë¥≠‰π∞' : 'Âá∫ÂîÆ'}Êï∞Èáè`)
        return
      }

      console.log(`üöÄ ÂºÄÂßã${type}‰∫§ÊòìÊµÅÁ®ã...`)
      this.addTestResult('info', `üöÄ ÂºÄÂßã${type}‰∫§ÊòìÊµÅÁ®ã...`, `Ê≠£Âú®Â§ÑÁêÜ${type}‰∫§ÊòìÔºåÊï∞Èáè: ${this.tradeAmount} tokens`)
      
      try {
        this.loading = true
        this.error = null

        // 1. ÂêàÁ∫¶ÂàùÂßãÂåñ
        this.loadingStatus = 'Ê≠£Âú®ÂàùÂßãÂåñÊô∫ËÉΩÂêàÁ∫¶...'
        this.showLoadingModal = true
        this.addTestResult('info', 'üöÄ Initializing Contract', 'Ê≠£Âú®ÂàùÂßãÂåñÊô∫ËÉΩÂêàÁ∫¶...')
        
        await this.initializeContract()
        console.log('‚úÖ ÂêàÁ∫¶ÂàùÂßãÂåñÂÆåÊàê')
        this.addTestResult('success', 'Contract Initialized', 'Êô∫ËÉΩÂêàÁ∫¶ÂàùÂßãÂåñÂÆåÊàê')

        // 2. È™åËØÅÁî®Êà∑ÊòØÂê¶Â∑≤ÁôªÂΩï
        if (!isLoggedIn()) {
          this.showLoadingModal = false
          this.loading = false
          this.errorType = 'login_required'
          this.error = 'ËØ∑ÂÖàÁôªÂΩïË¥¶Êà∑'
          this.addTestResult('error', 'Authentication Required', 'ËØ∑ÂÖàÁôªÂΩïË¥¶Êà∑')
          return
        }
        
        // 3. È™åËØÅÈí±ÂåÖÊòØÂê¶Â∑≤ËøûÊé•
        if (!this.isWalletConnected()) {
          this.showLoadingModal = false
          this.loading = false
          this.errorType = 'wallet_connection_required'
          this.error = 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ'
          this.addTestResult('error', 'Wallet Connection Required', 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ')
          return
        }
        
        // 4. Ëé∑ÂèñÈí±ÂåÖÂú∞ÂùÄ
        this.loadingStatus = 'Ê≠£Âú®Ëé∑ÂèñÈí±ÂåÖÂú∞ÂùÄ...'
        this.addTestResult('info', 'üë§ Getting User Address', 'Ê≠£Âú®Ëé∑ÂèñÈí±ÂåÖÂú∞ÂùÄ...')
        const userAddress = await this.getUserAddress()
        if (!userAddress) {
          this.showLoadingModal = false
          this.loading = false
          this.errorType = 'address_retrieval_failed'
          this.error = 'Êó†Ê≥ïËé∑ÂèñÈí±ÂåÖÂú∞ÂùÄÔºåËØ∑Ê£ÄÊü•Èí±ÂåÖËøûÊé•'
          this.addTestResult('error', 'Address Retrieval Failed', 'Êó†Ê≥ïËé∑ÂèñÈí±ÂåÖÂú∞ÂùÄÔºåËØ∑Ê£ÄÊü•Èí±ÂåÖËøûÊé•')
          return
        }
        console.log('‚úÖ Èí±ÂåÖÂú∞ÂùÄËé∑ÂèñÂÆåÊàê:', userAddress)
        this.addTestResult('success', 'User Address Retrieved', `Âú∞ÂùÄ: ${userAddress}`)
        
        // 5. È™åËØÅÂπ∂ËÆæÁΩÆKYCÁä∂ÊÄÅÔºàÁÆÄÂåñÔºöÈÄöËøáKYCÈ™åËØÅÁõ¥Êé•ËÆæÁΩÆ‰∏∫Level 2Ôºâ
        const kycStatus = getKycStatus()
        const kycLevel = getKycLevel()
        
        if (kycStatus !== KYC_STATUS.VERIFIED) {
          this.showLoadingModal = false
          this.loading = false
          this.errorType = 'kyc_verification_required'
          this.error = 'ËØ∑ÂÖàÂÆåÊàêKYCË∫´‰ªΩÈ™åËØÅ'
          this.addTestResult('error', 'KYC Verification Required', 'ËØ∑ÂÖàÂÆåÊàêKYCË∫´‰ªΩÈ™åËØÅ')
          return
        }
        
        // ÁÆÄÂåñÔºöKYCÈ™åËØÅÊàêÂäüÊó∂ÔºåËá™Âä®ËÆæÁΩÆ‰∏∫Level 2
        if (kycLevel < KYC_LEVELS.LEVEL_2) {
          console.log(`üîß KYCÈ™åËØÅÊàêÂäüÔºåËá™Âä®ËÆæÁΩÆÁ∫ßÂà´‰∏∫ ${KYC_LEVELS.LEVEL_2}`)
          setKycLevel(KYC_LEVELS.LEVEL_2)
          this.addTestResult('info', 'KYC Level Set', `KYCÁ∫ßÂà´Â∑≤ËÆæÁΩÆ‰∏∫${KYC_LEVELS.LEVEL_2}`)
        }

        // 6. Ëé∑ÂèñÈí±ÂåÖ‰ª£Â∏Å‰ΩôÈ¢ù
        this.loadingStatus = `Ê≠£Âú®Ëé∑Âèñ${this.projectCode}‰ª£Â∏Å‰ΩôÈ¢ù...`
        this.addTestResult('info', 'üí∞ Getting Token Balance', `Ê≠£Âú®Ëé∑Âèñ${this.projectCode}‰ª£Â∏Å‰ΩôÈ¢ù...`)
        const balance = await contractService.getUserTokenBalance(userAddress, this.projectCode)
        this.userTokenBalance = parseInt(balance) || 0
        console.log(`‚úÖ ${this.projectCode}‰ª£Â∏Å‰ΩôÈ¢ùËé∑ÂèñÂÆåÊàê:`, this.userTokenBalance)
        this.addTestResult('success', 'Token Balance Retrieved', `${this.projectCode}‰ΩôÈ¢ù: ${this.userTokenBalance} tokens`)

        // 7. ÊØîËæÉ‰ΩôÈ¢ù‰∏éËÆ§Ë¥≠ÈáëÈ¢ùÔºà‰ªÖÂØπbuyÊìç‰ΩúÔºâ
        if (type === 'buy') {
          console.log(`üí∞ ${this.projectCode}‰ΩôÈ¢ùÊ£ÄÊü•: ${this.userTokenBalance} vs ${this.tradeAmount}`)
          this.addTestResult('info', 'üí∞ Checking Balance', `Ê£ÄÊü•${this.projectCode}‰ΩôÈ¢ù: ${this.userTokenBalance} vs ${this.tradeAmount}`)
          if (this.userTokenBalance < parseInt(this.tradeAmount)) {
            this.showLoadingModal = false
            this.loading = false
            this.showInsufficientBalanceModal = true
            this.addTestResult('error', 'Insufficient Balance', `${this.projectCode}‰ΩôÈ¢ù‰∏çË∂≥: ÂΩìÂâç${this.userTokenBalance}ÔºåÈúÄË¶Å${this.tradeAmount}`)
            return
          }
          console.log('‚úÖ ‰ΩôÈ¢ùÂÖÖË∂≥ÔºåÂèØ‰ª•ÁªßÁª≠‰∫§Êòì')
          this.addTestResult('success', 'Balance Check Passed', `${this.projectCode}‰ΩôÈ¢ùÂÖÖË∂≥: ${this.userTokenBalance} >= ${this.tradeAmount}`)
        }

        // 9. Á≠æËÆ¢Êô∫ËÉΩÂêàÁ∫¶
        this.loadingStatus = `Ê≠£Âú®‰∏éÊô∫ËÉΩÂêàÁ∫¶Á≠æËÆ¢${type === 'buy' ? 'Ë¥≠‰π∞' : 'Âá∫ÂîÆ'}ÂçèËÆÆ...`
        this.addTestResult('info', `üìù Executing ${type.toUpperCase()} Transaction`, `Ê≠£Âú®‰∏éÊô∫ËÉΩÂêàÁ∫¶Á≠æËÆ¢${type === 'buy' ? 'Ë¥≠‰π∞' : 'Âá∫ÂîÆ'}ÂçèËÆÆ...`)
        
        let result
        if (type === 'buy') {
          result = await contractService.buyTokens(parseInt(this.tradeAmount))
        } else {
          result = await contractService.sellTokens(parseInt(this.tradeAmount))
        }

        if (result.success) {
          console.log(`‚úÖ ${type}‰∫§ÊòìÊàêÂäü:`, result)
          
          // ÂÖ≥Èó≠Âä†ËΩΩÂºπÁ™ó
          this.showLoadingModal = false
          
          // ÂáÜÂ§á‰∫§ÊòìÊï∞ÊçÆ
      const tradeData = {
        projectCode: this.projectCode,
            tradeType: type,
            amount: parseInt(this.tradeAmount),
            price: result.tokenPrice || 1.00,
            total: result.totalCost || parseFloat(this.calculateTotal()),
            userAddress: userAddress,
            transactionHash: result.transactionHash,
            blockNumber: result.blockNumber,
            timestamp: Date.now()
          }
          
          // ÂàõÂª∫Âü∫Á°Ä‰∫§ÊòìËÆ∞ÂΩï
          const baseTradeData = {
            id: Date.now(),
            type: type, // ‰∫§ÊòìÁ±ªÂûã (buy/sell)
            amount: this.tradeAmount, // Áî®Êà∑ËæìÂÖ•ÁöÑtoken amount
            project_code: this.projectCode, // È°πÁõÆ‰ª£Á†Å
            project_name: this.projectData.name, // È°πÁõÆÂêçÁß∞
            timestamp: Date.now(), // ÂΩìÂâçÊó∂Èó¥Êà≥
            transactionHash: result.transactionHash
          }

          // ÈÄöÁü•WalletViewÊõ¥Êñ∞Ê¥ªÂä®ËÆ∞ÂΩï
          this.notifyWalletActivity(baseTradeData)
          
          // ÊòæÁ§∫ÊàêÂäüÂºπÁ™ó
          this.showSuccessModal = true
          this.successData = {
            tradeType: type,
            amount: this.tradeAmount, // ‰ΩøÁî®Áî®Êà∑ËæìÂÖ•ÁöÑtoken amount
            price: tradeData.price,
            total: tradeData.total,
            transactionHash: result.transactionHash,
            blockNumber: result.blockNumber
          }
          
          // Ê∑ªÂä†ÊàêÂäüÊµãËØïÁªìÊûú
          this.addTestResult('success', `${type.toUpperCase()} Transaction Successful`, `‰∫§ÊòìÊàêÂäüÂÆåÊàê`, {
            transactionHash: result.transactionHash,
            blockNumber: result.blockNumber,
            amount: tradeData.amount,
            price: result.tokenPrice,
            totalCost: result.totalCost,
            userAddress: userAddress
    })
    
    // ÈáçÁΩÆË°®Âçï
    this.tradeAmount = ''
        } else {
          // ÂÖ≥Èó≠Âä†ËΩΩÂºπÁ™ó
          this.showLoadingModal = false
          console.error(`‚ùå ${type}‰∫§ÊòìÂ§±Ë¥•:`, result.error)
          this.errorType = 'transaction_failed'
          this.error = result.error || `${type}‰∫§ÊòìÂ§±Ë¥•`
          this.addTestResult('error', `${type.toUpperCase()} Transaction Failed`, result.error || `${type}‰∫§ÊòìÂ§±Ë¥•`)
        }
        
      } catch (error) {
        // ÂÖ≥Èó≠Âä†ËΩΩÂºπÁ™ó
        this.showLoadingModal = false
        console.error('‚ùå ‰∫§ÊòìÊµÅÁ®ãÂ§±Ë¥•:', error)
        this.errorType = 'network_error'
        this.error = error.message
        this.addTestResult('error', 'Transaction Error', error.message)
      } finally {
        this.loading = false
      }
    },
    async submitTrade() {
      if (!this.canSubmit) return
      
      this.loading = true
      this.error = null
      
      try {
        // Ê∑ªÂä†ÊµãËØïÁªìÊûú - ÂºÄÂßã‰∫§Êòì
        this.addTestResult('info', `üöÄ ÂºÄÂßã${this.tradeType}‰∫§Êòì...`, `Ê≠£Âú®Â§ÑÁêÜ${this.tradeType}‰∫§ÊòìÔºåÊï∞Èáè: ${this.tradeAmount} tokens`)
        
        // 1. ÂêàÁ∫¶ÂàùÂßãÂåñ
        this.addTestResult('info', 'üöÄ Initializing Contract', 'Ê≠£Âú®ÂàùÂßãÂåñÊô∫ËÉΩÂêàÁ∫¶...')
        await this.initializeContract()
        this.addTestResult('success', 'Contract Initialized', 'Êô∫ËÉΩÂêàÁ∫¶ÂàùÂßãÂåñÂÆåÊàê')
        
        // 2. È™åËØÅÁî®Êà∑ÊòØÂê¶Â∑≤ÁôªÂΩï
        if (!isLoggedIn()) {
          this.addTestResult('error', 'Authentication Required', 'ËØ∑ÂÖàÁôªÂΩïË¥¶Êà∑')
          this.loading = false
          return
        }
        
        // 3. È™åËØÅÈí±ÂåÖÊòØÂê¶Â∑≤ËøûÊé•
        if (!this.isWalletConnected()) {
          this.addTestResult('error', 'Wallet Connection Required', 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ')
          this.loading = false
          return
        }
        
        // 4. Ëé∑ÂèñÁî®Êà∑Èí±ÂåÖÂú∞ÂùÄ
        const userAddress = await this.getUserAddress()
        if (!userAddress) {
          this.addTestResult('error', 'Address Retrieval Failed', 'Êó†Ê≥ïËé∑ÂèñÈí±ÂåÖÂú∞ÂùÄÔºåËØ∑Ê£ÄÊü•Èí±ÂåÖËøûÊé•')
          this.loading = false
          return
        }
        
        this.addTestResult('success', 'User Address Retrieved', `Âú∞ÂùÄ: ${userAddress}`)
        
        // 5. È™åËØÅÂπ∂ËÆæÁΩÆKYCÁä∂ÊÄÅÔºàÁÆÄÂåñÔºöÈÄöËøáKYCÈ™åËØÅÁõ¥Êé•ËÆæÁΩÆ‰∏∫Level 2Ôºâ
        const kycStatus = getKycStatus()
        const kycLevel = getKycLevel()
        
        if (kycStatus !== KYC_STATUS.VERIFIED) {
          this.addTestResult('error', 'KYC Verification Required', 'ËØ∑ÂÖàÂÆåÊàêKYCË∫´‰ªΩÈ™åËØÅ')
          this.loading = false
          return
        }
        
        // ÁÆÄÂåñÔºöKYCÈ™åËØÅÊàêÂäüÊó∂ÔºåËá™Âä®ËÆæÁΩÆ‰∏∫Level 2
        if (kycLevel < KYC_LEVELS.LEVEL_2) {
          console.log(`üîß KYCÈ™åËØÅÊàêÂäüÔºåËá™Âä®ËÆæÁΩÆÁ∫ßÂà´‰∏∫ ${KYC_LEVELS.LEVEL_2}`)
          setKycLevel(KYC_LEVELS.LEVEL_2)
          this.addTestResult('info', 'KYC Level Set', `KYCÁ∫ßÂà´Â∑≤ËÆæÁΩÆ‰∏∫${KYC_LEVELS.LEVEL_2}`)
        }
        
        // 6. È™åËØÅÊòØÂê¶Âú®ÁôΩÂêçÂçï‰∏≠
        this.loadingStatus = 'Ê≠£Âú®Ê£ÄÊü•ÁôΩÂêçÂçïÁä∂ÊÄÅ...'
        this.addTestResult('info', 'üîç Checking Whitelist Status', 'Ê≠£Âú®Ê£ÄÊü•ÁôΩÂêçÂçïÁä∂ÊÄÅ...')
        const isWhitelisted = await this.checkWhitelistStatus(userAddress)
        if (!isWhitelisted) {
          this.showLoadingModal = false
          this.loading = false
          this.errorType = 'whitelist_required'
          this.error = 'ÊÇ®ÁöÑÈí±ÂåÖÂú∞ÂùÄÂ∞öÊú™Âä†ÂÖ•ÁôΩÂêçÂçïÔºåËØ∑ÂÖàÂÆåÊàêÁôΩÂêçÂçïÁî≥ËØ∑'
          this.addTestResult('error', 'Whitelist Required', 'ÊÇ®ÁöÑÈí±ÂåÖÂú∞ÂùÄÂ∞öÊú™Âä†ÂÖ•ÁôΩÂêçÂçïÔºåËØ∑ÂÖàÂÆåÊàêÁôΩÂêçÂçïÁî≥ËØ∑')
          return
        }
        this.addTestResult('success', 'Whitelist Check Passed', 'ÁôΩÂêçÂçïÈ™åËØÅÈÄöËøá')

        // 8. Â¶ÇÊûúÊòØBuyÊìç‰ΩúÔºåÊ£ÄÊü•‰ª£Â∏Å‰ΩôÈ¢ù
        if (this.tradeType === 'buy') {
          this.loadingStatus = 'Ê≠£Âú®Ëé∑ÂèñÁî®Êà∑‰ª£Â∏Å‰ΩôÈ¢ù...'
          this.showLoadingModal = true
          this.addTestResult('info', 'üí∞ Checking Token Balance', 'Ê≠£Âú®Ëé∑ÂèñÁî®Êà∑‰ª£Â∏Å‰ΩôÈ¢ù...')
          
          // Ëé∑ÂèñÁî®Êà∑‰ª£Â∏Å‰ΩôÈ¢ù
          const balance = await contractService.getUserTokenBalance(userAddress, this.projectCode)
          this.userTokenBalance = parseInt(balance) || 0
          
          console.log(`üí∞ Áî®Êà∑${this.projectCode}‰ª£Â∏Å‰ΩôÈ¢ù: ${this.userTokenBalance}, ËÆ§Ë¥≠Êï∞Èáè: ${this.tradeAmount}`)
          
          // Ê£ÄÊü•‰ΩôÈ¢ùÊòØÂê¶Ë∂≥Â§ü
          if (this.userTokenBalance < parseInt(this.tradeAmount)) {
            this.showLoadingModal = false
            this.loading = false
            this.showInsufficientBalanceModal = true
            this.addTestResult('error', 'Insufficient Balance', `${this.projectCode}‰ΩôÈ¢ù‰∏çË∂≥: ÂΩìÂâç${this.userTokenBalance}ÔºåÈúÄË¶Å${this.tradeAmount}`)
            return
          }
          
          // ‰ΩôÈ¢ùË∂≥Â§üÔºåÁªßÁª≠‰∫§Êòì
          this.loadingStatus = '‰ΩôÈ¢ùÂÖÖË∂≥ÔºåÊ≠£Âú®Â§ÑÁêÜ‰∫§Êòì...'
          this.addTestResult('success', 'Balance Check Passed', `${this.projectCode}‰ΩôÈ¢ùÂÖÖË∂≥: ${this.userTokenBalance} >= ${this.tradeAmount}`)
        }
      
        console.log(`üöÄ ÂºÄÂßã${this.tradeType}‰∫§Êòì...`)
        
        // 8. Â¶ÇÊûúÊòØsell interestÊìç‰ΩúÔºåÊ£ÄÊü•interest receivedÈ¢ùÂ∫¶
        if (this.tradeType === 'sell' && this.isInterestTrade) {
          this.loadingStatus = 'Ê≠£Âú®Ê£ÄÊü•Âà©ÊÅØÈ¢ùÂ∫¶...'
          this.addTestResult('info', 'üí∞ Checking Interest Received', 'Ê≠£Âú®Ê£ÄÊü•Â∑≤Êî∂ÂèñÂà©ÊÅØÈ¢ùÂ∫¶...')
          
          const interestReceived = this.calculateInterestReceived(this.projectCode)
          const sellAmount = parseFloat(this.tradeAmount)
          
          console.log(`üí∞ Âà©ÊÅØÈ¢ùÂ∫¶Ê£ÄÊü•: Â∑≤Êî∂Âèñ=${interestReceived}, Âá∫ÂîÆ=${sellAmount}`)
          
          if (sellAmount > interestReceived) {
            this.showLoadingModal = false
            this.loading = false
            this.errorType = 'insufficient_interest'
            this.error = `Âá∫ÂîÆÈ¢ùÂ∫¶‰∏çËÉΩË∂ÖËøáÂ∑≤Êî∂ÂèñÂà©ÊÅØÈ¢ùÂ∫¶„ÄÇÂ∑≤Êî∂Âèñ: ${interestReceived.toFixed(2)} tokensÔºåÂ∞ùËØïÂá∫ÂîÆ: ${sellAmount} tokens`
            this.addTestResult('error', 'Insufficient Interest', `Âá∫ÂîÆÈ¢ùÂ∫¶Ë∂ÖÂá∫ÈôêÂà∂: ${sellAmount} > ${interestReceived.toFixed(2)}`)
            return
          }
          
          this.addTestResult('success', 'Interest Check Passed', `Âà©ÊÅØÈ¢ùÂ∫¶È™åËØÅÈÄöËøá: ${interestReceived.toFixed(2)} >= ${sellAmount}`)
        }
        
        // 9. ÊâßË°å‰∫§Êòì - Êï¥ÂêàTest Buy/Test SellÁöÑÈÄªËæë
        let result
        if (this.tradeType === 'buy') {
          this.loadingStatus = 'Ê≠£Âú®‰∏éÊô∫ËÉΩÂêàÁ∫¶Á≠æËÆ¢Ë¥≠‰π∞ÂçèËÆÆ...'
          this.addTestResult('info', 'üìà Executing Buy Transaction', `Ê≠£Âú®Ë¥≠‰π∞ ${this.tradeAmount} tokens`)
          result = await contractService.buyTokens(parseInt(this.tradeAmount))
        } else {
          this.loadingStatus = 'Ê≠£Âú®‰∏éÊô∫ËÉΩÂêàÁ∫¶Á≠æËÆ¢Âá∫ÂîÆÂçèËÆÆ...'
          this.addTestResult('info', 'üìâ Executing Sell Transaction', `Ê≠£Âú®Âá∫ÂîÆ ${this.tradeAmount} tokens`)
          result = await contractService.sellTokens(parseInt(this.tradeAmount))
        }
        
        if (result.success) {
          console.log(`‚úÖ ${this.tradeType}‰∫§ÊòìÊàêÂäü:`, result)
          
          // ÂÖ≥Èó≠Âä†ËΩΩÂºπÁ™ó
          this.showLoadingModal = false
          
          // Ê∑ªÂä†ÊàêÂäüÊµãËØïÁªìÊûú - Êù•Ëá™Test Buy/SellÁöÑÈÄªËæë
          this.addTestResult('success', `${this.tradeType.toUpperCase()} Transaction Successful`, `Tx Hash: ${result.transactionHash}`, {
            transactionHash: result.transactionHash,
            blockNumber: result.blockNumber,
            amount: this.tradeAmount,
            price: result.tokenPrice,
            totalCost: result.totalCost
          })
          
          
          // ÂàõÂª∫Âü∫Á°Ä‰∫§ÊòìËÆ∞ÂΩï
          const baseTradeData = {
            id: Date.now(),
            type: this.tradeType, // ‰∫§ÊòìÁ±ªÂûã (buy/sell)
            amount: this.tradeAmount, // Áî®Êà∑ËæìÂÖ•ÁöÑtoken amount
            project_code: this.projectCode, // È°πÁõÆ‰ª£Á†Å
            project_name: this.projectData.name, // È°πÁõÆÂêçÁß∞
            timestamp: Date.now(), // ÂΩìÂâçÊó∂Èó¥Êà≥
            transactionHash: result.transactionHash
          }

          // ÈÄöÁü•WalletViewÊõ¥Êñ∞Ê¥ªÂä®ËÆ∞ÂΩï
          this.notifyWalletActivity(baseTradeData)
          
          // ÊòæÁ§∫ÊàêÂäüÂºπÁ™ó
          this.showSuccessModal = true
          this.successData = {
            tradeType: this.tradeType,
            amount: this.tradeAmount, // ‰ΩøÁî®Áî®Êà∑ËæìÂÖ•ÁöÑtoken amount
            price: result.tokenPrice || 1.00,
            total: result.totalCost || parseFloat(this.calculateTotal()),
            transactionHash: result.transactionHash,
            blockNumber: result.blockNumber
          }
          
          // ÈáçÁΩÆË°®Âçï
          this.tradeAmount = ''
        } else {
          // ÂÖ≥Èó≠Âä†ËΩΩÂºπÁ™ó
          this.showLoadingModal = false
          console.error(`‚ùå ${this.tradeType}‰∫§ÊòìÂ§±Ë¥•:`, result.error)
          this.errorType = 'transaction_failed'
          this.error = result.error || `${this.tradeType}‰∫§ÊòìÂ§±Ë¥•`
          this.addTestResult('error', `${this.tradeType.toUpperCase()} Transaction Failed`, result.error)
        }
        
      } catch (error) {
        // ÂÖ≥Èó≠Âä†ËΩΩÂºπÁ™ó
        this.showLoadingModal = false
        console.error('‚ùå ‰∫§ÊòìÂ§±Ë¥•:', error)
        this.errorType = 'network_error'
        this.error = error.message
        this.addTestResult('error', 'Transaction Error', error.message)
        this.$emit('notify', `Trade failed: ${error.message}`)
      } finally {
        this.loading = false
      }
    },
    
    
    
    // ‰ªélocalStorageÂä†ËΩΩWallet ActivityÊï∞ÊçÆ
    loadWalletActivity() {
      try {
        const savedActivity = localStorage.getItem('walletActivity')
        if (savedActivity) {
          this.walletActivity = JSON.parse(savedActivity)
          console.log('üìä TradeProjectView: Âä†ËΩΩWallet ActivityÊï∞ÊçÆ:', this.walletActivity.length, 'Êù°ËÆ∞ÂΩï')
        } else {
          this.walletActivity = []
          console.log('üìä TradeProjectView: Ê≤°ÊúâÊâæÂà∞Wallet ActivityÊï∞ÊçÆ')
        }
      } catch (error) {
        console.error('‚ùå TradeProjectView: Âä†ËΩΩWallet ActivityÊï∞ÊçÆÂ§±Ë¥•:', error)
        this.walletActivity = []
      }
    },
    
    // ÁõëÂê¨Wallet ActivityÊõ¥Êñ∞‰∫ã‰ª∂
    handleWalletActivityUpdate(event) {
      console.log('üì¢ TradeProjectView: Êî∂Âà∞Wallet ActivityÊõ¥Êñ∞ÈÄöÁü•:', event.detail)
      this.loadWalletActivity()
    },

    // Ëé∑ÂèñÁî®Êà∑Âú∞ÂùÄÔºàÁî®‰∫é‰∫§ÊòìÈ™åËØÅÔºâ
    async getUserAddress() {
      try {
        console.log('üîç TradeProjectView: Ê≠£Âú®Ëé∑ÂèñÁî®Êà∑Èí±ÂåÖÂú∞ÂùÄ...')
        
        // 1. ‰ºòÂÖà‰ªélocalStorageËé∑ÂèñWalletViewÁªëÂÆöÁöÑÈí±ÂåÖÂú∞ÂùÄ
        const savedAccounts = localStorage.getItem('walletBoundAccounts')
        if (savedAccounts) {
          try {
            const boundAddresses = JSON.parse(savedAccounts)
            if (boundAddresses && boundAddresses.length > 0) {
              // ‰ΩøÁî®Á¨¨‰∏Ä‰∏™ÁªëÂÆöÁöÑÈí±ÂåÖÂú∞ÂùÄÔºàÊàñËÄÖÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÈÄâÊã©ÁâπÂÆöÁöÑÂú∞ÂùÄÔºâ
              const selectedAddress = boundAddresses[0]
              console.log('‚úÖ TradeProjectView: ‰ªéWalletViewËé∑ÂèñÁªëÂÆöÂú∞ÂùÄ:', selectedAddress)
              return selectedAddress
            }
          } catch (parseError) {
            console.warn('‚ö†Ô∏è TradeProjectView: Ëß£ÊûêwalletBoundAccountsÂ§±Ë¥•:', parseError)
          }
        }
        
        // 2. Â¶ÇÊûúlocalStorage‰∏≠Ê≤°ÊúâÁªëÂÆöÂú∞ÂùÄÔºåÂ∞ùËØï‰ªéuseWalletËé∑Âèñ
        const { fullAddress, connected } = useWallet()
        if (connected.value && fullAddress.value) {
          console.log('‚ö†Ô∏è TradeProjectView: ‰ΩøÁî®useWalletÂú∞ÂùÄ‰Ωú‰∏∫Â§áÁî®:', fullAddress.value)
          return fullAddress.value
        }
        
        // 3. ÊúÄÂêéÁöÑÂ§áÁî®ÊñπÊ°àÔºöÁõ¥Êé•‰ªéethereumËé∑Âèñ
        if (typeof window.ethereum !== 'undefined') {
          const accounts = await window.ethereum.request({ method: 'eth_accounts' })
          if (accounts && accounts.length > 0) {
            console.log('‚ö†Ô∏è TradeProjectView: ‰ΩøÁî®ethereumÂú∞ÂùÄ‰Ωú‰∏∫ÊúÄÂêéÂ§áÁî®:', accounts[0])
            return accounts[0]
          }
        }
        
        console.error('‚ùå TradeProjectView: Êó†Ê≥ï‰ªé‰ªª‰ΩïÊù•Ê∫êËé∑ÂèñÁî®Êà∑Âú∞ÂùÄ')
        return null
        
      } catch (error) {
        console.error('‚ùå TradeProjectView: Ëé∑ÂèñÁî®Êà∑Âú∞ÂùÄÂ§±Ë¥•:', error)
        return null
      }
    },
    
    // ÂÖ≥Èó≠ÊàêÂäüÂºπÁ™ó
    closeSuccessModal() {
      this.showSuccessModal = false
      this.successData = {
        tradeType: '',
        amount: 0,
        price: 0,
        total: 0,
        transactionHash: '',
        blockNumber: 0
      }
    },

    // ÂÖ≥Èó≠‰ΩôÈ¢ù‰∏çË∂≥ÂºπÁ™ó
    closeInsufficientBalanceModal() {
      this.showInsufficientBalanceModal = false
    },
    
    // Ê∏ÖÈô§ÈîôËØØÊ∂àÊÅØ
    clearError() {
      this.error = null
      this.errorType = null
      this.amountError = null
    },

    // È™åËØÅËÆ§Ë¥≠ÈáëÈ¢ù
    validateAmount() {
      const amount = this.subscriptionAmount
      
      // Â¶ÇÊûúÈáëÈ¢ù‰∏∫Á©∫Êàñ0Ôºå‰∏çÊòæÁ§∫ÈîôËØØ‰ΩÜ‰πü‰∏çÈ™åËØÅÈÄöËøá
      if (amount === null || amount === '' || amount === undefined || amount === 0) {
        this.amountError = null
        this.amountValid = false
        return false
      }
      
      const numAmount = parseFloat(amount)
      
      if (isNaN(numAmount)) {
        this.amountError = 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊï∞Â≠ó'
        this.amountValid = false
        return false
      }
      
      if (numAmount <= 0) {
        this.amountError = 'ËÆ§Ë¥≠ÈáëÈ¢ùÂøÖÈ°ªÂ§ß‰∫é0'
        this.amountValid = false
        return false
      }
      
      // ËÆæÁΩÆÊúÄÂ∞èÂÄºÈ™åËØÅÔºàÂèØÈÄâÔºâ
      if (numAmount < 1) {
        this.amountError = 'ËÆ§Ë¥≠ÈáëÈ¢ù‰∏çËÉΩÂ∞ë‰∫é1 LPT'
        this.amountValid = false
        return false
      }
      
      // ËÆæÁΩÆÊúÄÂ§ßÂÄºÈ™åËØÅÔºàÂèØÈÄâÔºâ
      if (numAmount > 100000) {
        this.amountError = 'ËÆ§Ë¥≠ÈáëÈ¢ù‰∏çËÉΩË∂ÖËøá100,000 LPT'
        this.amountValid = false
        return false
      }
      
      this.amountError = null
      this.amountValid = true
      return true
    },

    // Â§ÑÁêÜÈáëÈ¢ùËæìÂÖ•
    onAmountInput() {
      this.clearError()
      const isValid = this.validateAmount()
      console.log('üîç TradeProjectView: ÈáëÈ¢ùËæìÂÖ•È™åËØÅÁªìÊûú:', {
        subscriptionAmount: this.subscriptionAmount,
        amountValid: this.amountValid,
        isValid: isValid,
        amountError: this.amountError
      })
    },
    
    // Ê†ºÂºèÂåñÂìàÂ∏åÂú∞ÂùÄ
    formatHash(hash) {
      if (!hash) return ''
      return `${hash.slice(0, 6)}...${hash.slice(-4)}`
    },
    
    // Â§çÂà∂ÂìàÂ∏åÂà∞Ââ™Ë¥¥Êùø
    async copyHash() {
      try {
        await navigator.clipboard.writeText(this.successData.transactionHash)
        this.$emit('notify', '‰∫§ÊòìÂìàÂ∏åÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø')
      } catch (error) {
        console.error('Â§çÂà∂Â§±Ë¥•:', error)
        this.$emit('notify', 'Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂')
      }
    },
    
    // Êü•ÁúãPortfolio
    viewPortfolio() {
      // ÂÖ≥Èó≠ÊàêÂäüÂºπÁ™ó
      this.closeSuccessModal()
      
      // Ë∑≥ËΩ¨Âà∞PortfolioÈ°µÈù¢
      this.$router.push('/portfolio')
    },
    
    // Ëé∑ÂèñÂΩìÂâçÈìæID
    getCurrentChainId() {
      // ËøôÈáåÂèØ‰ª•‰ªéÂêàÁ∫¶ÈÖçÁΩÆ‰∏≠Ëé∑Âèñ
      return 11155111 // SepoliaÊµãËØïÁΩë
    },

    // ========== ÂêàÁ∫¶ÊµãËØïÊñπÊ≥ï ==========
    
    // ÂàùÂßãÂåñÂêàÁ∫¶
    async initializeContract() {
      try {
        this.contractLoading = true
        this.addTestResult('info', 'üöÄ Initializing contract service...', 'Starting contract initialization')
        
        await contractService.initialize()
        this.contractInitialized = true
        
        this.contractStatus = {
          type: 'success',
          icon: '‚úÖ',
          message: 'Contract service initialized successfully!'
        }
        
        this.addTestResult('success', 'Contract Initialized', 'Contract service is ready', {
          initialized: true,
          timestamp: Date.now()
        })
        
      } catch (error) {
        this.contractStatus = {
          type: 'error',
          icon: '‚ùå',
          message: `Initialization failed: ${error.message}`
        }
        
        this.addTestResult('error', 'Contract Initialization Failed', error.message)
        console.error('Contract initialization failed:', error)
      } finally {
        this.contractLoading = false
      }
    },

    // Ëé∑ÂèñÁî®Êà∑Âú∞ÂùÄÔºàÊµãËØïÁî®Ôºâ
    async testGetUserAddress() {
      try {
        this.contractLoading = true
        this.addTestResult('info', 'üë§ Fetching user address...', 'Getting connected wallet address')
        
        // 1. ‰ºòÂÖà‰ªélocalStorageËé∑ÂèñWalletViewÁªëÂÆöÁöÑÈí±ÂåÖÂú∞ÂùÄ
        const savedAccounts = localStorage.getItem('walletBoundAccounts')
        if (savedAccounts) {
          try {
            const boundAddresses = JSON.parse(savedAccounts)
            if (boundAddresses && boundAddresses.length > 0) {
              this.userAddress = boundAddresses[0]
              this.addTestResult('success', 'User Address from WalletView', `Address: ${this.userAddress}`, {
                address: this.userAddress,
                shortAddress: this.formatAddress(this.userAddress),
                source: 'WalletView Bound Accounts',
                boundAccountsCount: boundAddresses.length
              })
              return
            }
          } catch (parseError) {
            this.addTestResult('warning', 'Parse walletBoundAccounts failed', parseError.message)
          }
        }
        
        // 2. Â¶ÇÊûúlocalStorage‰∏≠Ê≤°ÊúâÁªëÂÆöÂú∞ÂùÄÔºåÂ∞ùËØï‰ªéuseWalletËé∑Âèñ
        const { fullAddress, connected } = useWallet()
        if (connected.value && fullAddress.value) {
          this.userAddress = fullAddress.value
          this.addTestResult('warning', 'Address from useWallet (No bound accounts)', `Address: ${this.userAddress}`, {
            address: this.userAddress,
            shortAddress: this.formatAddress(this.userAddress),
            source: 'useWallet composable'
          })
          return
        }
        
        // 3. ÊúÄÂêéÁöÑÂ§áÁî®ÊñπÊ°àÔºöÁõ¥Êé•‰ªéethereumËé∑Âèñ
        if (typeof window.ethereum !== 'undefined') {
          const accounts = await window.ethereum.request({ method: 'eth_accounts' })
          if (accounts && accounts.length > 0) {
            this.userAddress = accounts[0]
            this.addTestResult('warning', 'Address from ethereum (Fallback)', `Address: ${this.userAddress}`, {
              address: this.userAddress,
              shortAddress: this.formatAddress(this.userAddress),
              source: 'ethereum.accounts'
            })
            return
          }
        }
        
        this.addTestResult('error', 'No Wallet Address Found', 'Please connect your wallet in WalletView first', {
          localStorageEmpty: !savedAccounts,
          useWalletConnected: connected.value,
          useWalletAddress: fullAddress.value,
          ethereumAvailable: typeof window.ethereum !== 'undefined'
        })
        
      } catch (error) {
        this.addTestResult('error', 'Failed to Get User Address', error.message)
        console.error('Failed to get user address:', error)
      } finally {
        this.contractLoading = false
      }
    },

    // Ëé∑Âèñ‰ª£Â∏Å‰ª∑Ê†º
    async getTokenPrice() {
      try {
        this.contractLoading = true
        this.addTestResult('info', 'üí∞ Fetching token price...', 'Getting current token price')
        
        this.tokenPrice = await contractService.getTokenPrice()
        
        this.addTestResult('success', 'Token Price Retrieved', `Price: ${this.tokenPrice} ETH`, {
          price: this.tokenPrice,
          currency: 'ETH'
        })
        
      } catch (error) {
        this.addTestResult('error', 'Failed to Get Token Price', error.message)
        console.error('Failed to get token price:', error)
      } finally {
        this.contractLoading = false
      }
    },

    // Ëé∑ÂèñÁî®Êà∑‰ª£Â∏Å‰ΩôÈ¢ù
    async getUserTokenBalance() {
      try {
        this.contractLoading = true
        this.addTestResult('info', 'üí≥ Fetching user token balance...', `Getting ${this.projectCode} token balance`)
        
        this.userTokenBalance = await contractService.getUserTokenBalance(null, this.projectCode)
        
        this.addTestResult('success', 'User Token Balance Retrieved', `${this.projectCode} Balance: ${this.userTokenBalance}`, {
          balance: this.userTokenBalance,
          address: this.userAddress,
          tokenSymbol: this.projectCode
        })
        
      } catch (error) {
        this.addTestResult('error', 'Failed to Get User Token Balance', error.message)
        console.error('Failed to get user token balance:', error)
      } finally {
        this.contractLoading = false
      }
    },

    // Ëé∑Âèñ‰∫§ÊòìÂéÜÂè≤
    async getTradeHistory() {
      try {
        this.contractLoading = true
        this.addTestResult('info', ' Fetching trade history...', 'Getting recent trade records')
        
        this.tradeHistory = await contractService.getTradeHistory()
        
        this.addTestResult('success', 'Trade History Retrieved', `Found ${this.tradeHistory.length} trade records`, {
          trades: this.tradeHistory,
          count: this.tradeHistory.length
        })
        
      } catch (error) {
        this.addTestResult('error', 'Failed to Get Trade History', error.message)
        console.error('Failed to get trade history:', error)
      } finally {
        this.contractLoading = false
      }
    },

    // ÊµãËØï‰π∞ÂÖ•‰∫§Êòì
    async testBuyTransaction() {
      try {
        this.contractLoading = true
        this.addTestResult('info', 'üìà Testing buy transaction...', `Testing buy of ${this.testAmount} tokens`)
        
        // È™åËØÅÊùÉÈôê
        if (!isLoggedIn()) {
          this.addTestResult('error', 'Authentication Required', 'ËØ∑ÂÖàÁôªÂΩïË¥¶Êà∑')
          return
        }
        
        if (!this.isWalletConnected()) {
          this.addTestResult('error', 'Wallet Connection Required', 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ')
          return
        }
        
        const userAddress = await this.getUserAddress()
        if (!userAddress) {
          this.addTestResult('error', 'Address Retrieval Failed', 'Êó†Ê≥ïËé∑ÂèñÈí±ÂåÖÂú∞ÂùÄÔºåËØ∑Ê£ÄÊü•Èí±ÂåÖËøûÊé•')
          return
        }
        
        const kycStatus = getKycStatus()
        const kycLevel = getKycLevel()
        
        if (kycStatus !== KYC_STATUS.VERIFIED) {
          this.addTestResult('error', 'KYC Verification Required', 'ËØ∑ÂÖàÂÆåÊàêKYCË∫´‰ªΩÈ™åËØÅ')
          return
        }
        
        // KYCÈ™åËØÅÊàêÂäüÊó∂ÔºåÂ¶ÇÊûúÁ∫ßÂà´‰∏çË∂≥ÔºåËá™Âä®ËÆæÁΩÆ‰∏∫Level 2
        if (kycLevel < KYC_LEVELS.LEVEL_2) {
          console.log(`üîß KYCÈ™åËØÅÊàêÂäüÔºåËá™Âä®ÂçáÁ∫ßÁ∫ßÂà´‰ªé ${kycLevel} Âà∞ ${KYC_LEVELS.LEVEL_2}`)
          setKycLevel(KYC_LEVELS.LEVEL_2)
          this.addTestResult('info', 'KYC Level Updated', `KYCÁ∫ßÂà´Â∑≤Ëá™Âä®‰ªé${kycLevel}ÂçáÁ∫ßÂà∞${KYC_LEVELS.LEVEL_2}`)
        }
        
        // const isWhitelisted = await this.checkWhitelistStatus(userAddress)
        // if (!isWhitelisted) {
        //   this.addTestResult('error', 'Whitelist Required', 'ÊÇ®ÁöÑÈí±ÂåÖÂú∞ÂùÄÂ∞öÊú™Âä†ÂÖ•ÁôΩÂêçÂçï')
        //   return
        // }
        
        const result = await contractService.buyTokens(this.testAmount)
        
        if (result.success) {
          this.addTestResult('success', 'Buy Transaction Successful', `Tx Hash: ${result.transactionHash}`, {
            transactionHash: result.transactionHash,
            blockNumber: result.blockNumber,
            amount: this.testAmount,
            price: result.tokenPrice,
            totalCost: result.totalCost
          })
          
          
          // ÂàõÂª∫Âü∫Á°Ä‰∫§ÊòìËÆ∞ÂΩï
          const baseTradeData = {
            id: Date.now(),
            type: 'buy',
            amount: this.testAmount, // ‰ΩøÁî®testAmount
            project_code: this.projectCode,
            project_name: this.projectData.name,
            timestamp: Date.now(),
            transactionHash: result.transactionHash
          }

          // ÈÄöÁü•WalletViewÊõ¥Êñ∞Ê¥ªÂä®ËÆ∞ÂΩï
          this.notifyWalletActivity(baseTradeData)
        } else {
          this.addTestResult('error', 'Buy Transaction Failed', result.error)
        }
        
      } catch (error) {
        this.addTestResult('error', 'Buy Transaction Error', error.message)
        console.error('Buy transaction failed:', error)
      } finally {
        this.contractLoading = false
      }
    },

    // ÊµãËØïÂçñÂá∫‰∫§Êòì
    async testSellTransaction() {
      try {
        this.contractLoading = true
        this.addTestResult('info', 'üìâ Testing sell transaction...', `Testing sell of ${this.testAmount} tokens`)
        
        // È™åËØÅÊùÉÈôê
        if (!isLoggedIn()) {
          this.addTestResult('error', 'Authentication Required', 'ËØ∑ÂÖàÁôªÂΩïË¥¶Êà∑')
          return
        }
        
        if (!this.isWalletConnected()) {
          this.addTestResult('error', 'Wallet Connection Required', 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ')
          return
        }
        
        const userAddress = await this.getUserAddress()
        if (!userAddress) {
          this.addTestResult('error', 'Address Retrieval Failed', 'Êó†Ê≥ïËé∑ÂèñÈí±ÂåÖÂú∞ÂùÄÔºåËØ∑Ê£ÄÊü•Èí±ÂåÖËøûÊé•')
          return
        }
        
        const kycStatus = getKycStatus()
        const kycLevel = getKycLevel()
        
        if (kycStatus !== KYC_STATUS.VERIFIED) {
          this.addTestResult('error', 'KYC Verification Required', 'ËØ∑ÂÖàÂÆåÊàêKYCË∫´‰ªΩÈ™åËØÅ')
          return
        }
        
        // KYCÈ™åËØÅÊàêÂäüÊó∂ÔºåÂ¶ÇÊûúÁ∫ßÂà´‰∏çË∂≥ÔºåËá™Âä®ËÆæÁΩÆ‰∏∫Level 2
        if (kycLevel < KYC_LEVELS.LEVEL_2) {
          console.log(`üîß KYCÈ™åËØÅÊàêÂäüÔºåËá™Âä®ÂçáÁ∫ßÁ∫ßÂà´‰ªé ${kycLevel} Âà∞ ${KYC_LEVELS.LEVEL_2}`)
          setKycLevel(KYC_LEVELS.LEVEL_2)
          this.addTestResult('info', 'KYC Level Updated', `KYCÁ∫ßÂà´Â∑≤Ëá™Âä®‰ªé${kycLevel}ÂçáÁ∫ßÂà∞${KYC_LEVELS.LEVEL_2}`)
        }
        
        const isWhitelisted = await this.checkWhitelistStatus(userAddress)
        if (!isWhitelisted) {
          this.addTestResult('error', 'Whitelist Required', 'ÊÇ®ÁöÑÈí±ÂåÖÂú∞ÂùÄÂ∞öÊú™Âä†ÂÖ•ÁôΩÂêçÂçï')
          return
        }
        
        const result = await contractService.sellTokens(this.testAmount)
        
        if (result.success) {
          this.addTestResult('success', 'Sell Transaction Successful', `Tx Hash: ${result.transactionHash}`, {
            transactionHash: result.transactionHash,
            blockNumber: result.blockNumber,
            amount: this.testAmount,
            price: result.tokenPrice,
            totalCost: result.totalCost
          })
          
          
          // ÂàõÂª∫Âü∫Á°Ä‰∫§ÊòìËÆ∞ÂΩï
          const baseTradeData = {
            id: Date.now(),
            type: 'sell',
            amount: this.testAmount, // ‰ΩøÁî®testAmount
            project_code: this.projectCode,
            project_name: this.projectData.name,
            timestamp: Date.now(),
            transactionHash: result.transactionHash
          }

          // ÈÄöÁü•WalletViewÊõ¥Êñ∞Ê¥ªÂä®ËÆ∞ÂΩï
          this.notifyWalletActivity(baseTradeData)
        } else {
          this.addTestResult('error', 'Sell Transaction Failed', result.error)
        }
        
      } catch (error) {
        this.addTestResult('error', 'Sell Transaction Error', error.message)
        console.error('Sell transaction failed:', error)
      } finally {
        this.contractLoading = false
      }
    },


    // Ê∑ªÂä†ÊµãËØïÁªìÊûú
    addTestResult(type, title, message, data = null) {
      const result = {
        type,
        title,
        message,
        data,
        timestamp: Date.now(),
        icon: this.getResultIcon(type)
      }
      
      this.testResults.unshift(result)
      
      // ÈôêÂà∂ÁªìÊûúÊï∞Èáè
      if (this.testResults.length > 20) {
        this.testResults = this.testResults.slice(0, 20)
      }
    },

    // Ëé∑ÂèñÁªìÊûúÂõæÊ†á
    getResultIcon(type) {
      const icons = {
        success: '‚úÖ',
        error: '‚ùå',
        info: '‚ÑπÔ∏è',
        warning: '‚ö†Ô∏è'
      }
      return icons[type] || 'üìù'
    },

    // Ê∏ÖÈô§ÊµãËØïÁªìÊûú
    clearResults() {
      this.testResults = []
    },

    // ËøêË°åÊâÄÊúâÊµãËØï
    async runAllTests() {
      if (!this.contractInitialized) {
        await this.initializeContract()
      }
      
      if (this.contractInitialized) {
        await this.testGetUserAddress()
        await this.getTokenPrice()
        await this.getUserTokenBalance()
        await this.getTradeHistory()
        await this.testBuyTransaction(
          this.tradeAmount=3
        )
        await this.testSellTransaction(
          this.tradeAmount=3
        )
      }
    },

    // Ê†ºÂºèÂåñÂú∞ÂùÄ
    formatAddress(address) {
      if (!address) return ''
      return `${address.slice(0, 6)}...${address.slice(-4)}`
    },

    // Ê†ºÂºèÂåñETHÂÄº
    formatEtherValue(hexValue) {
      if (!hexValue) return '0'
      try {
        const wei = BigInt(hexValue)
        const eth = Number(wei) / Math.pow(10, 18)
        return eth.toFixed(6)
      } catch (error) {
        console.error('Error formatting ETH value:', error)
        return '0'
      }
    },

    // Ê†ºÂºèÂåñÂìàÂ∏åÂÄº
    formatHash(hash) {
      if (!hash) return 'N/A'
      return `${hash.slice(0, 10)}...${hash.slice(-8)}`
    },

    // Ê†ºÂºèÂåñEtherscanÊó∂Èó¥Êà≥
    formatEtherscanTime(timestamp) {
      if (!timestamp) return 'N/A'
      return new Date(timestamp).toLocaleString()
    },

    // Â§çÂà∂ÂìàÂ∏åÂÄº
    copyHash(hash) {
      if (!hash) return
      navigator.clipboard.writeText(hash).then(() => {
        console.log('‚úÖ ÂìàÂ∏åÂÄºÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø')
      }).catch(err => {
        console.error('‚ùå Â§çÂà∂Â§±Ë¥•:', err)
      })
    },

    // Ëé∑Âèñ‰∫§ÊòìÁ±ªÂûãÊòæÁ§∫ÊñáÊú¨
    getTradeTypeDisplay(type) {
      const typeMap = {
        'successful_trade': 'SUCCESS',
        'failed_trade': 'FAILED',
        'buy': 'BUY',
        'sell': 'SELL'
      }
      return typeMap[type] || type.toUpperCase()
    },

    // ÈÄöÁü•WalletViewÊõ¥Êñ∞Ê¥ªÂä®ËÆ∞ÂΩï
    notifyWalletActivity(activityData) {
      try {
        console.log('üì¢ ÈÄöÁü•WalletViewÊõ¥Êñ∞Ê¥ªÂä®ËÆ∞ÂΩï:', activityData)
        
        // ÈÄöËøálocalStorageÂ≠òÂÇ®Ê¥ªÂä®ËÆ∞ÂΩïÔºåWalletView‰ºöÁõëÂê¨Ëøô‰∏™ÂèòÂåñ
        const currentActivity = JSON.parse(localStorage.getItem('walletActivity') || '[]')
        currentActivity.unshift(activityData)
        
        // ÈôêÂà∂ÊúÄÂ§ö‰øùÂ≠ò50Êù°ËÆ∞ÂΩï
        if (currentActivity.length > 50) {
          currentActivity.splice(50)
        }
        
        localStorage.setItem('walletActivity', JSON.stringify(currentActivity))
        
        // Ëß¶ÂèëËá™ÂÆö‰πâ‰∫ã‰ª∂ÔºåÈÄöÁü•WalletViewÂà∑Êñ∞
        window.dispatchEvent(new CustomEvent('walletActivityUpdated', {
          detail: activityData
        }))
        
        console.log('‚úÖ WalletViewÊ¥ªÂä®ËÆ∞ÂΩïÊõ¥Êñ∞ÈÄöÁü•Â∑≤ÂèëÈÄÅ')
        
      } catch (error) {
        console.error('‚ùå ÈÄöÁü•WalletViewÊõ¥Êñ∞Ê¥ªÂä®ËÆ∞ÂΩïÂ§±Ë¥•:', error)
      }
    },
    
    // Ê£ÄÊü•ÁôΩÂêçÂçïÁä∂ÊÄÅÔºàÁÆÄÂåñÈÄªËæëÔºâ
    async checkWhitelistStatus(address) {
      try {
        console.log('üîç Ê£ÄÊü•ÁôΩÂêçÂçïÁä∂ÊÄÅ:', address)
        
        // ÁÆÄÂåñÔºö‰ºòÂÖàÊ£ÄÊü•KYCÁä∂ÊÄÅ
        const kycLevel = getKycLevel()
        const kycStatus = getKycStatus()
        
        if (kycStatus === KYC_STATUS.VERIFIED && kycLevel >= KYC_LEVELS.LEVEL_2) {
          console.log('‚úÖ KYC Level 2Áî®Êà∑ÔºåËá™Âä®ÈÄöËøáÁôΩÂêçÂçïÊ£ÄÊü•')
          return true
        }
        
        // ‰ΩøÁî®contractServiceÊ£ÄÊü•ÁôΩÂêçÂçïÁä∂ÊÄÅ
        const statusData = await contractService.getWhitelistStatus(address)
        console.log('‚úÖ ÁôΩÂêçÂçïÁä∂ÊÄÅÊ£ÄÊü•ÁªìÊûú:', statusData)
        
        // Âè™ÊúâapprovedÁä∂ÊÄÅÊâçÂÖÅËÆ∏‰∫§Êòì
        return statusData.status === 'approved'
      } catch (error) {
        console.error('‚ùå Ê£ÄÊü•ÁôΩÂêçÂçïÁä∂ÊÄÅÂ§±Ë¥•:', error)
        return false
      }
    },

    // Ê£ÄÊü•Èí±ÂåÖËøûÊé•Áä∂ÊÄÅ
    isWalletConnected() {
      try {
        const { connected, fullAddress } = useWallet()
        const isConnected = connected.value && fullAddress.value
        console.log('TradeProjectView: Èí±ÂåÖËøûÊé•Áä∂ÊÄÅÊ£ÄÊü•:', {
          connected: connected.value,
          hasAddress: !!fullAddress.value,
          address: fullAddress.value,
          isConnected
        })
        return isConnected
      } catch (error) {
        console.error('Ê£ÄÊü•Èí±ÂåÖËøûÊé•Áä∂ÊÄÅÂ§±Ë¥•:', error)
        return false
      }
    },
    
  },
  watch: {
    // ÁõëÂê¨Ë∑ØÁî±ÂèòÂåñÔºåÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
    '$route'(to, from) {
      if (to.params.code !== from.params.code) {
        console.log('üîÑ TradeProjectView: Ë∑ØÁî±ÂèÇÊï∞ÂèòÂåñÔºåÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ')
        this.loadProjectData()
      }
    },
    
    // ÁõëÂê¨propsÂèòÂåñ
    code: {
      handler(newCode) {
        if (newCode) {
          console.log('üîÑ TradeProjectView: Props‰ª£Á†ÅÂèòÂåñÔºåÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ:', newCode)
          this.loadProjectData()
        }
      },
      immediate: true
    }
  },
  async mounted() {
    // Ê£ÄÊü•Ë∑ØÁî±ÂèÇÊï∞ÔºåËÆæÁΩÆ‰∫§ÊòìÁ±ªÂûã
    this.initializeTradeType()
    
    // Âä†ËΩΩÈ°πÁõÆÊï∞ÊçÆ
    await this.loadProjectData()
    
    // Âä†ËΩΩÂêàÁ∫¶Êù°Ê¨æ
    await this.loadContractTerms()
    
    // ÂàùÂßãÂåñuseWallet
    try {
      const { connected, fullAddress } = useWallet()
      console.log('TradeProjectView: Wallet connection status:', connected.value)
      console.log('TradeProjectView: Wallet address:', fullAddress.value)
    } catch (error) {
      console.error('TradeProjectView: Failed to initialize wallet:', error)
    }

    // ÂèØ‰ª•‰ªésessionStorageËé∑ÂèñÈ°πÁõÆ‰ø°ÊÅØ
    try {
      const storedProject = sessionStorage.getItem('lastProduct')
      if (storedProject) {
        const project = JSON.parse(storedProject)
        console.log('Loaded project from session:', project)
      }
    } catch (e) {
      console.log('No project data in session storage')
    }
    
    // Âä†ËΩΩWallet ActivityÊï∞ÊçÆ
    this.loadWalletActivity()
    
    // ÁõëÂê¨Wallet ActivityÊõ¥Êñ∞‰∫ã‰ª∂
    window.addEventListener('walletActivityUpdated', this.handleWalletActivityUpdate)
  },
  
  beforeUnmount() {
    // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨Âô®
    window.removeEventListener('walletActivityUpdated', this.handleWalletActivityUpdate)
  },
  
  // ËÆ°ÁÆóÈ°πÁõÆÁöÑinterest received amountÔºàÂ∑≤Êî∂ÂèñÂà©ÊÅØÂ∏ÅÔºâ
  calculateInterestReceived(projectCode) {
    // Ëé∑ÂèñÁî®Êà∑Âú®ËØ•È°πÁõÆ‰∏≠ÁöÑÊåÅÊúâ‰ø°ÊÅØ
    const userAddress = this.getUserAddress()
    if (!userAddress) return 0
    
    // ‰ªéWalletViewËé∑Âèñwallet activityÊï∞ÊçÆ
    const walletActivity = this.getWalletActivityData()
    const transactionActivities = walletActivity.filter(activity => 
      activity.type === 'buy' || activity.type === 'sell'
    )
    
    // ËÆ°ÁÆóËØ•È°πÁõÆÁöÑÊåÅÊúâÈáè
    let holdingAmount = 0
    transactionActivities.forEach(tx => {
      if (tx.project_code === projectCode || tx.projectCode === projectCode) {
        if (tx.type === 'buy') {
          holdingAmount += parseFloat(tx.amount) || 0
        } else if (tx.type === 'sell') {
          holdingAmount -= parseFloat(tx.amount) || 0
        }
      }
    })
    
    if (holdingAmount <= 0) return 0
    
    // Ëé∑ÂèñÈ°πÁõÆ‰ø°ÊÅØ
    const project = this.projectData
    if (!project) return 0
    
    // Âü∫‰∫éÊåÅÊúâÈáëÈ¢ùÂíåÈ°πÁõÆÊî∂ÁõäÁéáËÆ°ÁÆóÂ∑≤Êî∂Âà∞ÁöÑÂà©ÊÅØ
    const annualYield = project.targetYield || 0
    const monthlyYield = annualYield / 12 / 100
    
    // ÂÅáËÆæÊåÅÊúâÊó∂Èó¥‰∏∫6‰∏™ÊúàÔºàÂèØ‰ª•Ê†πÊçÆÂÆûÈôÖÊåÅÊúâÊó∂Èó¥Ë∞ÉÊï¥Ôºâ
    const holdingMonths = 6
    const currentPrice = 1.0 // ‰ΩøÁî®ÈªòËÆ§‰ª∑Ê†ºÔºåÂÆûÈôÖÂ∫îËØ•‰ªéÈ°πÁõÆÊï∞ÊçÆËé∑Âèñ
    const interestReceived = holdingAmount * currentPrice * monthlyYield * holdingMonths
    
    return interestReceived
  }
}
</script>

<style scoped>
/* ‚Äî‚Äî ÈááÁî®PortfolioViewÁöÑÊ∑±Ëâ≤‰∏ªÈ¢ò ‚Äî‚Äî */
:root { 
  --bg:#f6f7fb; 
  --panel:#fff; 
  --text:#0b1020; 
  --muted:#6b7280; 
  --muted-2:#9aa3b2; 
  --border:#e6e8ef; 
  --shadow:0 6px 20px rgba(15,23,42,.06); 
  --primary:#3b82f6; 
  --primary-ink:#1e40af; 
  --danger:#ef4444; 
  --dark-bg:#141426;
  --dark-panel:#1f2937;
  --dark-border:#374151;
  --dark-text:#ffffff;
  --dark-muted:#9ca3af;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.trade-page {
  background: var(--dark-bg);
  min-height: 100vh;
  color: var(--dark-text);
}

/* È°∂ÈÉ®ÂØºËà™ */
.topbar {
  background: var(--dark-bg);
  border-bottom: 1px solid var(--dark-border);
  padding: 20px;
}

.breadcrumb {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--dark-muted);
}

.crumb-back {
  border: none;
  background: transparent;
  cursor: pointer;
  color: var(--dark-muted);
  padding: 8px;
  border-radius: 8px;
  transition: all 0.2s ease;
}

.crumb-back:hover {
  background: var(--dark-panel);
  color: var(--dark-text);
}

.crumb {
  color: var(--dark-muted);
}

.crumb-current {
  color: var(--dark-text);
  font-weight: 600;
}

.sep {
  color: var(--dark-border);
}

.i {
  width: 16px;
  height: 16px;
  fill: currentColor;
}

/* ‰∏ªË¶ÅÂÜÖÂÆπ */
.main-content {
  padding: 30px 0;
  display: grid;
  gap: 0px;
  grid-template-columns: 1fr 1fr;
  grid-template-areas: 
    "project-info project-info"
    "trade-form trade-history";
}

/* È°πÁõÆ‰ø°ÊÅØÂç°Áâá */
.project-info-card {
  grid-area: project-info;
  background: #1d1d36;
  border: 1px solid #2a2a4a;
  border-radius: 16px;
  padding: 30px;
  box-shadow: var(--shadow);
}

.project-header {
  display: flex;
  gap: 20px;
  margin-bottom: 30px;
}

.project-image {
  width: 80px;
  height: 80px;
  border-radius: 8px;
  object-fit: cover;
}

.project-details {
  flex: 1;
}

.project-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--dark-text);
  margin: 0 0 8px 0;
}

.project-subtitle {
  color: var(--dark-muted);
  margin: 0 0 12px 0;
}

.project-meta {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

.meta-item {
  background: var(--dark-bg);
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  color: var(--dark-muted);
  text-transform: capitalize;
  border: 1px solid var(--dark-border);
}

.project-metrics {
  display: grid;
  justify-content: center;
  grid-template-columns: repeat(6, 1fr);
  gap: 12px;
}

.metric-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
  background: #141426;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #2a2a4a;
  min-width: 0; /* ÂÖÅËÆ∏flex itemÊî∂Áº© */
}

.metric-label {
  font-size: 10px;
  color: #94a3b8;
  text-transform: uppercase;
  font-weight: 500;
  letter-spacing: 0.3px;
  line-height: 1.2;
}

.metric-value {
  font-size: 14px;
  font-weight: 600;
  color: #ffffff;
  line-height: 1.2;
  word-break: break-word; /* Â§ÑÁêÜÈïøÊñáÊú¨Êç¢Ë°å */
}

/* ‰∫§ÊòìË°®Âçï */
.trade-form-card {
  grid-area: trade-form;
  background: var(--dark-panel);
  border: 1px solid var(--dark-border);
  border-radius: 16px;
  padding: 0px;
  box-shadow: var(--shadow);
  width: 700px;
}

.form-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--dark-text);
  margin: 0 0 30px 0;
  width:50px;
}

.form-section {
  margin-bottom: 30px;
  background: #1d1d36;
  padding: 20px;
  border-radius: 12px;
  border: 1px solid #2a2a4a;
}

/* ÂêàÁ∫¶ËØ¶ÊÉÖÊåâÈíÆÂå∫Âüü */
.contract-details-section {
  margin-top: 20px;
  margin-bottom: 30px;
  display: flex;
  justify-content: flex-start;
}

.contract-details-btn {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 24px;
  background: #1f252f;
  /* border: 2px solid #ffffff; */
  border-radius: 12px;
  color: #ffffff;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.contract-details-btn:hover {
  background: #ffffff;
  color: #000000;
  transform: translateY(-2px);
  font-size: 13px;
}

.contract-details-btn:active {
  transform: translateY(0);
}

.btn-icon {
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-text {
  font-weight: 600;
  letter-spacing: 0.5px;
}

.btn-arrow {
  font-size: 14px;
  transition: transform 0.3s ease;
}


.section-title {
  font-size: 16px;
  font-weight: 600;
  color: #ffffff;
  margin: 0 0 16px 0;
}

.trade-type-buttons {
  display: flex;
  gap: 12px;
}

.trade-type-btn {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 16px 24px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  cursor: pointer;
  transition: all 0.3s ease;
  color: #ffffff;
  font-size: 16px;
  font-weight: 600;
  position: relative;
  overflow: hidden;
}

.trade-type-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.trade-type-btn:hover::before {
  left: 100%;
}

.trade-type-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
  background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
}

.trade-type-btn:active {
  transform: translateY(0);
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.trade-type-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}

.trade-type-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.trade-type-btn:disabled:hover {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  transform: none;
  box-shadow: none;
}

.btn-icon {
  font-size: 24px;
}

.btn-text {
  font-weight: 600;
  color: inherit;
}

.amount-input-group {
  display: flex;
  align-items: center;
  gap: 12px;
}

.amount-input {
  flex: 1;
  padding: 12px 16px;
  border: 1px solid var(--dark-border);
  border-radius: 8px;
  font-size: 16px;
  background: #374151;
  color: var(--dark-text);
}

.amount-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.amount-unit {
  color: #94a3b8;
  font-weight: 500;
}

.amount-info {
  margin-top: 8px;
}

.info-text {
  font-size: 14px;
  color: #94a3b8;
}

.price-options {
  display: flex;
  gap: 20px;
  margin-bottom: 16px;
}

.price-option {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  color: #ffffff;
}

.price-option input[type="radio"] {
  margin: 0;
  accent-color: var(--primary);
}

.limit-price-input {
  display: flex;
  align-items: center;
  gap: 12px;
}

.price-input {
  flex: 1;
  padding: 12px 16px;
  border: 1px solid var(--dark-border);
  border-radius: 8px;
  font-size: 16px;
  background: var(--dark-bg);
  color: var(--dark-text);
}

.price-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.price-unit {
  color: #94a3b8;
  font-weight: 500;
}

.trade-summary {
  background: #1d1d36;
  border: 1px solid #2a2a4a;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 30px;
}

.summary-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
}

.summary-item:last-child {
  margin-bottom: 0;
  font-weight: 600;
  border-top: 1px solid var(--dark-border);
  padding-top: 8px;
}

.summary-label {
  color: #94a3b8;
}

.summary-value {
  color: #ffffff;
}

.form-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
}

.btn.secondary {
  background: #1d1d36;
  color: #ffffff;
  border: 1px solid #2a2a4a;
}

.btn.secondary:hover {
  background: #2a2a4a;
}

.btn.primary {
  background: #f59e0b;
  color: white;
  border: 1px solid #f59e0b;
}

.btn.primary:hover {
  background: #d97706;
  border-color: #d97706;
}

.btn.primary:disabled {
  background: #6b7280;
  border-color: #6b7280;
  cursor: not-allowed;
  opacity: 0.5;
}

/* ‰∫§ÊòìÂéÜÂè≤ */
.trade-history-card {
  grid-area: trade-history;
  background: #1d1d36;
  border: 1px solid #2a2a4a;
  border-radius: 16px;
  padding: 30px;
  box-shadow: var(--shadow);
  margin-left: 120px;
  margin-right: 120px;
}

.card-title {
  font-size: 20px;
  font-weight: 700;
  color: #ffffff;
  margin: 0 0 20px 0;
}

.card-header {
  margin-bottom: 20px;
}

.hash-value {
  font-family: 'Courier New', monospace;
  font-size: 12px;
  cursor: pointer;
  color: #3b82f6;
  text-decoration: underline;
}

.hash-value:hover {
  color: #2563eb;
}

.status-success {
  color: #10b981;
  font-weight: 600;
}

.status-failed {
  color: #ef4444;
  font-weight: 600;
}

.trade-type.successful_trade {
  background: #10b981;
  color: white;
}

.trade-type.failed_trade {
  background: #ef4444;
  color: white;
}

.trade-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.trade-item {
  padding: 16px;
  border: 1px solid #2a2a4a;
  border-radius: 8px;
  margin-bottom: 12px;
  background: #141426;
  transition: all 0.2s ease;
}

.trade-item:hover {
  background: #1d1d36;
  border-color: var(--primary);
}

.trade-item:last-child {
  margin-bottom: 0;
}

.trade-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.trade-info {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 12px;
}

.trade-type {
  font-weight: 600;
  font-size: 14px;
  padding: 6px 12px;
  border-radius: 6px;
  text-transform: uppercase;
}

.trade-type.buy {
  background: #10b981;
  color: white;
}

.trade-type.sell {
  background: #ef4444;
  color: white;
}

.trade-time {
  font-size: 12px;
  color: #9ca3af;
}

.trade-amount-section,
.trade-price-section,
.trade-total-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.label {
  font-size: 13px;
  color: #9ca3af;
  font-weight: 500;
}

.value {
  font-size: 14px;
  color: #e5e7eb;
  font-weight: 600;
}

.trade-total-section .value {
  color: #10b981;
  font-size: 16px;
}

.trade-footer {
  display: flex;
  justify-content: flex-end;
}

.tx-link {
  font-size: 12px;
  color: #3b82f6;
  text-decoration: none;
  padding: 4px 8px;
  border-radius: 4px;
  background: rgba(59, 130, 246, 0.1);
  transition: all 0.2s ease;
}

.tx-link:hover {
  background: rgba(59, 130, 246, 0.2);
  text-decoration: none;
}

.trade-details {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 2px;
}

.trade-price {
  font-weight: 600;
  color: #ffffff;
}

.trade-time {
  font-size: 12px;
  color: #94a3b8;
}

/* ÈîôËØØ‰ø°ÊÅØÊ†∑Âºè */
.error-message {
  margin-top: 16px;
  padding: 12px 16px;
  background: #fee2e2;
  color: #dc2626;
  border: 1px solid #fecaca;
  border-radius: 8px;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.error-icon {
  font-size: 16px;
  flex-shrink: 0;
}

.error-text {
  flex: 1;
}

/* Âä†ËΩΩÂíåÁ©∫Áä∂ÊÄÅÊ†∑Âºè */
.loading-message, .no-trades {
  text-align: center;
  padding: 40px 20px;
  color: #94a3b8;
  font-style: italic;
}

/* ‰∫§ÊòìÈìæÊé•Ê†∑Âºè */
.tx-link {
  color: #3b82f6;
  text-decoration: none;
  font-size: 12px;
  margin-top: 4px;
  display: block;
}

.tx-link:hover {
  text-decoration: underline;
}

/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 768px) {
  .main-content {
    grid-template-columns: 1fr;
    grid-template-areas: 
      "project-info"
      "trade-form"
      "trade-history";
  }
  
  .project-header {
    flex-direction: column;
    text-align: center;
  }
  
  .project-metrics {
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
  }
  
  .metric-item {
    padding: 8px;
  }
  
  .metric-label {
    font-size: 9px;
  }
  
  .metric-value {
    font-size: 12px;
  }
  
  .trade-type-buttons {
    flex-direction: column;
  }
}

/* Â∞èÂ±èÂπïËÆæÂ§á */
@media (max-width: 480px) {
  .project-metrics {
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
  }
  
  .metric-item {
    padding: 6px;
  }
  
  .metric-label {
    font-size: 8px;
  }
  
  .metric-value {
    font-size: 11px;
  }
}

/* ========== ÂêàÁ∫¶ÊµãËØïÈù¢ÊùøÊ†∑Âºè ========== */
.contract-test-panel {
  background: #1d1d36;
  border: 1px solid #2a2a4a;
  border-radius: 16px;
  width: 50%;
  padding: 30px;
  margin-left: auto;
  margin-right: auto;
  box-shadow: 0 2px 8px rgba(94, 103, 124, 0.04);
  max-height: 800px;
  overflow-y: auto;
}

.test-status {
  margin-bottom: 20px;
}

.status-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 16px;
  border-radius: 8px;
  font-weight: 600;
}

.status-indicator.success {
  background: #064e3b;
  color: #10b981;
  border: 1px solid #10b981;
}

.status-indicator.error {
  background: #7f1d1d;
  color: #ef4444;
  border: 1px solid #ef4444;
}

.status-indicator.info {
  background: #1e3a8a;
  color: #3b82f6;
  border: 1px solid #3b82f6;
}

.status-icon {
  font-size: 16px;
}

.status-text {
  font-size: 14px;
}

/* ÊµãËØïÂå∫ÂüüÂ∏ÉÂ±Ä */
.test-area {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
}

.test-buttons {
  display: flex;
  flex-direction: column;
  gap: 8px;
  min-width: 200px;
  flex-shrink: 0;
}

.test-btn {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  border: 1px solid #2a2a4a;
  border-radius: 8px;
  background: #141426;
  color: #ffffff;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 14px;
  font-weight: 500;
}

.test-btn:hover:not(:disabled) {
  border-color: #4f46e5;
  background: #1e1e3a;
  transform: translateX(4px);
}

.test-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.test-btn.active {
  border-color: #10b981;
  background: #064e3b;
  color: #10b981;
}

.btn-icon {
  font-size: 18px;
  width: 20px;
  text-align: center;
}

.btn-text {
  flex: 1;
}

.test-results {
  flex: 1;
  max-height: 400px;
  overflow-y: auto;
  background: #141426;
  border: 1px solid #2a2a4a;
  border-radius: 8px;
  padding: 16px;
}

.loading-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px;
  color: #94a3b8;
  font-size: 14px;
}

.spinner {
  width: 8px;
  height: 8px;
  border: 2px solid #2a2a4a;
  border-top: 2px solid #4f46e5;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.results-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.result-item {
  padding: 12px;
  border-radius: 8px;
  border: 1px solid;
  font-size: 13px;
}

.result-item.success {
  background: #064e3b;
  border-color: #10b981;
  color: #d1fae5;
}

.result-item.error {
  background: #7f1d1d;
  border-color: #ef4444;
  color: #fecaca;
}

.result-item.info {
  background: #1e3a8a;
  border-color: #3b82f6;
  color: #dbeafe;
}

.result-item.warning {
  background: #78350f;
  border-color: #f59e0b;
  color: #fef3c7;
}

.result-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.result-icon {
  font-size: 14px;
}

.result-title {
  font-weight: 600;
  flex: 1;
}

.result-time {
  font-size: 11px;
  opacity: 0.7;
}

.result-data {
  margin: 8px 0;
}

.result-data pre {
  background: rgba(0, 0, 0, 0.2);
  padding: 8px;
  border-radius: 4px;
  font-size: 11px;
  overflow-x: auto;
  white-space: pre-wrap;
  word-break: break-all;
}

.result-message {
  margin-top: 4px;
  opacity: 0.9;
}

.no-results {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 40px 20px;
  color: #94a3b8;
  text-align: center;
}

.no-results-icon {
  font-size: 32px;
  opacity: 0.5;
}

.no-results-text {
  font-size: 14px;
  font-style: italic;
}

.quick-actions {
  display: flex;
  gap: 8px;
  justify-content: center;
}

.action-btn {
  padding: 8px 16px;
  border: 1px solid #2a2a4a;
  border-radius: 6px;
  background: #141426;
  color: #ffffff;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 12px;
  font-weight: 500;
}

.action-btn:hover {
  border-color: #4f46e5;
  background: #1e1e3a;
}

.action-btn.secondary {
  border-color: #6b7280;
  color: #9ca3af;
}

.action-btn.secondary:hover {
  border-color: #9ca3af;
  background: #374151;
}

/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 1200px) {
  .contract-test-panel {
    margin-top: 20px;
  }
  
  .test-area {
    flex-direction: column;
    gap: 16px;
  }
  
  .test-buttons {
    min-width: auto;
  }
}

@media (max-width: 768px) {
  .test-area {
    flex-direction: column;
    gap: 12px;
  }
  
  .test-buttons {
    gap: 6px;
  }
  
  .test-btn {
    padding: 10px 12px;
    font-size: 13px;
  }
  
  .btn-icon {
    font-size: 16px;
  }
  
  .test-results {
    max-height: 300px;
    padding: 12px;
  }
  
  .result-item {
    padding: 10px;
    font-size: 12px;
  }
  
  .quick-actions {
    flex-direction: column;
  }
  
  .action-btn {
    padding: 10px;
    font-size: 13px;
  }
}

/* ÂºπÁ™óÂü∫Á°ÄÊ†∑Âºè - Á¨¶ÂêàhomepageÊ∑±Ëâ≤‰∏ªÈ¢òÈ£éÊ†º */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(10, 10, 26, 0.8);
  backdrop-filter: blur(8px);
  display: grid;
  place-items: center;
  z-index: 1000;
}

.modal-content {
  width: min(500px, 90vw);
  background: rgba(20, 20, 40, 0.98);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(138, 43, 226, 0.2);
  border-radius: 18px;
  padding: 40px 32px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  max-height: 700px;
  max-width: 500px;
  overflow-y: auto;
  position: relative;
}

.modal-content::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 20%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(75, 0, 130, 0.1) 0%, transparent 50%);
  border-radius: 18px;
  pointer-events: none;
  z-index: -1;
}

.modal-header {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 0 0 28px 0;
  border-bottom: 1px solid rgba(138, 43, 226, 0.2);
  margin-bottom: 28px;
}

.modal-title {
  font-size: 24px;
  font-weight: 700;
  color: #ffffff;
  margin: 10px;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.modal-body {
  padding: 0;
}

.modal-footer {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  margin-top: 28px;
  padding-top: 28px;
  border-top: 1px solid rgba(138, 43, 226, 0.2);
}

/* ‰∫§ÊòìÊàêÂäüÂºπÁ™óÊ†∑Âºè - ÈáçÊñ∞ËÆæËÆ° */
.success-modal {
  padding: 0;
}

.success-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 40px 32px;
}

.success-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 80px;
  height: 80px;
  margin-bottom: 32px;
  background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(22, 163, 74, 0.1));
  border-radius: 50%;
  border: 2px solid rgba(34, 197, 94, 0.3);
  position: relative;
  overflow: hidden;
}

.success-icon::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: conic-gradient(from 0deg, transparent, rgba(34, 197, 94, 0.5), transparent);
  border-radius: 50%;
  animation: successGlow 2s ease-in-out infinite;
  z-index: -1;
}

.checkmark {
  position: relative;
  width: 32px;
  height: 32px;
}

.checkmark-stem {
  position: absolute;
  width: 3px;
  height: 16px;
  background: #22c55e;
  left: 14px;
  top: 6px;
  transform: rotate(45deg);
  border-radius: 2px;
}

.checkmark-kick {
  position: absolute;
  width: 12px;
  height: 3px;
  background: #22c55e;
  left: 8px;
  top: 20px;
  transform: rotate(45deg);
  border-radius: 2px;
}

.success-content {
  max-width: 500px;
  width: 100%;
}

.success-title {
  font-size: 28px;
  font-weight: 700;
  color: #ffffff;
  margin: 0 0 16px 0;
  background: linear-gradient(135deg, #ffffff, rgba(34, 197, 94, 0.8));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.success-description {
  font-size: 16px;
  color: rgba(255, 255, 255, 0.8);
  margin: 0 0 32px 0;
  line-height: 1.5;
}

@keyframes successGlow {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 0.8; }
}

.success-details {
  display: flex;
  flex-direction: column;
  gap: 20px;
  margin-bottom: 32px;
}

.detail-card {
  background: rgba(138, 43, 226, 0.05);
  border: 1px solid rgba(138, 43, 226, 0.2);
  border-radius: 16px;
  padding: 20px;
  text-align: left;
}

.detail-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid rgba(138, 43, 226, 0.1);
}

.detail-icon {
  font-size: 18px;
}

.detail-label {
  font-weight: 600;
  color: #ffffff;
  font-size: 16px;
}

.detail-grid {
  display: grid;
  gap: 12px;
}

.success-actions {
  display: flex;
  gap: 16px;
  justify-content: center;
  width: 100%;
}

.detail-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
}

.detail-key {
  font-weight: 500;
  color: rgba(255, 255, 255, 0.7);
  font-size: 14px;
}

.detail-value {
  color: #ffffff;
  font-weight: 600;
  font-size: 14px;
}

.hash-value {
  font-family: 'Courier New', monospace;
  font-size: 12px;
  cursor: pointer;
  color: #8a2be2;
  text-decoration: underline;
  background: rgba(138, 43, 226, 0.1);
  padding: 4px 8px;
  border-radius: 6px;
  border: 1px solid rgba(138, 43, 226, 0.2);
}

.hash-value:hover {
  color: #a855f7;
  background: rgba(138, 43, 226, 0.2);
}

/* ‰ΩôÈ¢ù‰∏çË∂≥ÂºπÁ™óÊ†∑Âºè */
.error-modal {
  border-left: 4px solid #ef4444;
}

.error-icon {
  font-size: 24px;
  color: #ef4444;
}

.error-message {
  text-align: center;
}

.error-message p {
  margin: 8px 0;
  color: #64748b;
}

.error-message strong {
  color: #1e293b;
  font-weight: 600;
}

/* Âä†ËΩΩ‰∏≠ÂºπÁ™óÊ†∑Âºè - ÈáçÊñ∞ËÆæËÆ° */
.loading-modal {
  padding: 0;
}

.loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 40px 32px;
}

.loading-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 80px;
  height: 80px;
  margin-bottom: 32px;
  background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.1));
  border-radius: 50%;
  border: 2px solid rgba(138, 43, 226, 0.3);
  position: relative;
  overflow: hidden;
}

.loading-icon::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: conic-gradient(from 0deg, transparent, rgba(138, 43, 226, 0.5), transparent);
  border-radius: 50%;
  animation: rotate 2s linear infinite;
  z-index: -1;
}

.loading-content {
  max-width: 400px;
}

.loading-title {
  font-size: 28px;
  font-weight: 700;
  color: #ffffff;
  margin: 0 0 16px 0;
  background: linear-gradient(135deg, #ffffff, rgba(138, 43, 226, 0.8));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.loading-description {
  font-size: 16px;
  color: rgba(255, 255, 255, 0.8);
  margin: 0 0 24px 0;
  line-height: 1.5;
}

.loading-status {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 16px 24px;
  background: rgba(138, 43, 226, 0.1);
  border: 1px solid rgba(138, 43, 226, 0.2);
  border-radius: 12px;
  font-size: 14px;
  color: rgba(255, 255, 255, 0.9);
  font-weight: 500;
}

.status-indicator {
  width: 8px;
  height: 8px;
  background: rgba(138, 43, 226, 0.8);
  border-radius: 50%;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes pulse {
  0%, 100% { opacity: 0.4; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.2); }
}

.loading-icon .spinner {
  width: 32px;
  height: 32px;
  border: 3px solid rgba(138, 43, 226, 0.2);
  border-top: 3px solid #8a2be2;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.loading-message {
  text-align: center;
}

.loading-message p {
  margin: 12px 0;
  color: #e0e0e0;
  font-size: 16px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.loading-status {
  font-weight: 600;
  color: #8a2be2;
  font-style: italic;
  font-size: 16px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ÂºπÁ™óÊåâÈíÆÊ†∑Âºè - Á¨¶ÂêàhomepageÈ£éÊ†º */
.modal-footer .btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 20px;
  border-radius: 12px;
  border: 1px solid var(--border);
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-decoration: none;
}

.modal-footer .btn.primary {
  background: var(--brand);
  color: #fff;
  border-color: transparent;
}

.modal-footer .btn.primary:hover {
  background: var(--brand-700);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.modal-footer .btn.secondary {
  background: rgba(20, 20, 40, 0.8);
  color: #e0e0e0;
  border-color: rgba(138, 43, 226, 0.3);
}

.modal-footer .btn.secondary:hover {
  border-color: rgba(138, 43, 226, 0.6);
  background: rgba(138, 43, 226, 0.1);
  transform: translateY(-1px);
}

/* Ë°®ÂçïÂ§¥ÈÉ® */
.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #374151;
}

.form-title {
  margin: 0;
  color: #f97316;
  font-size: 1.5rem;
  font-weight: 700;
}

/* ÂÜÖËÅîÈí±ÂåÖÁä∂ÊÄÅ */
.wallet-status-inline {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
}

.wallet-status-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.wallet-status-item .status-label {
  color: #94a3b8;
  font-size: 0.85rem;
  font-weight: 500;
}

.wallet-status-item .status-value {
  color: #e2e8f0;
  font-weight: 600;
  font-size: 0.85rem;
}

.wallet-status-item .status-value.connected {
  color: #10b981;
}

.wallet-status-item .status-value.disconnected {
  color: #ef4444;
}

/* Ë∂ÖÂ∞èÊåâÈíÆÊ†∑Âºè - È´òÂ∫¶10px */
.btn.tiny {
  height: 15px;
  padding: 0 8px;
  font-size: 0.7rem;
  border-radius: 4px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}

.btn.primary.tiny {
  background: #f97316;
  color: white;
  border: 1px solid #f97316;
}

.btn.primary.tiny:hover:not(:disabled) {
  background: #ea580c;
  border-color: #ea580c;
}

.btn.secondary.tiny {
  background: #374151;
  color: #e2e8f0;
  border: 1px solid #4b5563;
}

.btn.secondary.tiny:hover:not(:disabled) {
  background: #4b5563;
  border-color: #6b7280;
}

.btn.tiny:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 768px) {
  .form-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
  }
  
  .wallet-status-inline {
    width: 100%;
    justify-content: space-between;
  }
  
  .wallet-status-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 2px;
  }
}

/* ÂêàÁ∫¶Êù°Ê¨æÊòæÁ§∫ */
.contract-terms-display {
  background: #1e293b;
  border: 2px solid #374151;
  border-radius: 8px;
  padding: 15px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.term-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #374151;
}

.term-item:last-child {
  border-bottom: none;
}

.term-label {
  color: #94a3b8;
  font-size: 0.9rem;
}

.term-value {
  color: #f97316;
  font-weight: 600;
  font-size: 0.9rem;
}

/* ËÆ§Ë¥≠ÊëòË¶Å */
.subscription-summary {
  background: #1e293b;
  border: 2px solid #374151;
  border-radius: 8px;
  padding: 20px;
  margin-top: 15px;
}

.subscription-summary h3 {
  color: #f97316;
  margin-bottom: 15px;
  font-size: 1.1rem;
}

.summary-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #374151;
}

.summary-item:last-child {
  border-bottom: none;
}

.summary-label {
  color: #94a3b8;
  font-size: 0.9rem;
}

.summary-value {
  color: #e2e8f0;
  font-weight: 600;
  font-size: 0.9rem;
}

/* ÊåâÈíÆÊèêÁ§∫ */
.button-hint {
  color: #ef4444;
  font-size: 0.8rem;
  margin-top: 8px;
  text-align: center;
}

/* ÈÉ®ÁΩ≤Áä∂ÊÄÅÂç°Áâá */
.deployment-status-card,
.deployed-contracts-card,
.interaction-status-card,
.balance-info-card {
  background: var(--dark-panel);
  border: 1px solid var(--dark-border);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  width:400px
}

.deployment-status-card h3,
.deployed-contracts-card h3,
.interaction-status-card h3,
.balance-info-card h3 {
  color: #f97316;
  margin-bottom: 15px;
  font-size: 1.2rem;
}

/* Áä∂ÊÄÅÊó•Âøó */
.status-log {
  max-height: 300px;
  overflow-y: auto;
  background: #1e293b;
  border-radius: 8px;
  padding: 15px;
}

.log-item {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid #374151;
}

.log-item:last-child {
  border-bottom: none;
}

.log-time {
  color: #94a3b8;
  font-size: 0.8rem;
  min-width: 80px;
  flex-shrink: 0;
}

.log-message {
  color: #e2e8f0;
  font-size: 0.9rem;
  flex: 1;
}

.log-item.info .log-message {
  color: #3b82f6;
}

.log-item.success .log-message {
  color: #10b981;
}

.log-item.error .log-message {
  color: #ef4444;
}

/* ÂêàÁ∫¶ÂàóË°® */
.contract-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.contract-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 12px;
  background: #1e293b;
  border-radius: 8px;
  border: 1px solid #374151;
}

.contract-name {
  color: #f97316;
  font-weight: 600;
  min-width: 120px;
}

.contract-address {
  color: #94a3b8;
  font-family: monospace;
  font-size: 0.8rem;
  flex: 1;
  word-break: break-all;
}

/* ‰ΩôÈ¢ù‰ø°ÊÅØ */
.balance-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.balance-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 15px;
  background: #1e293b;
  border-radius: 8px;
  border: 1px solid #374151;
}

.balance-label {
  color: #94a3b8;
  font-size: 0.9rem;
}

.balance-value {
  color: #f97316;
  font-weight: 600;
  font-size: 0.9rem;
}

/* Â∞èÊåâÈíÆÊ†∑Âºè */
.btn.small {
  padding: 6px 12px;
  font-size: 0.8rem;
  background: #374151;
  color: #e2e8f0;
  border: 1px solid #4b5563;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn.small:hover {
  background: #4b5563;
  border-color: #6b7280;
}

/* ËæìÂÖ•Ê°ÜÈîôËØØÊ†∑Âºè */
.amount-input.error {
  border-color: #ef4444;
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

/* ËæìÂÖ•ÊèêÁ§∫Ê†∑Âºè */
.input-hint {
  color: #94a3b8;
  font-size: 0.8rem;
  margin-top: 5px;
}

.input-error {
  color: #ef4444;
  font-size: 0.8rem;
  margin-top: 5px;
  font-weight: 500;
}

/* Âä†ËΩΩÁä∂ÊÄÅÊ†∑Âºè */
.loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  text-align: center;
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  margin: 20px 0;
}

.loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid rgba(255, 255, 255, 0.1);
  border-top: 4px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}

.loading-container h2 {
  color: #ffffff;
  font-size: 24px;
  font-weight: 600;
  margin: 0 0 8px 0;
}

.loading-container p {
  color: #9ca3af;
  font-size: 16px;
  margin: 0;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ÈîôËØØÁä∂ÊÄÅÊ†∑Âºè */
.error-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  text-align: center;
  background: rgba(239, 68, 68, 0.05);
  border: 1px solid rgba(239, 68, 68, 0.2);
  border-radius: 12px;
  margin: 20px 0;
}

.error-icon {
  font-size: 48px;
  margin-bottom: 20px;
}

.error-container h2 {
  color: #ef4444;
  font-size: 24px;
  font-weight: 600;
  margin: 0 0 8px 0;
}

.error-container p {
  color: #fca5a5;
  font-size: 16px;
  margin: 0 0 20px 0;
}

.error-container .btn {
  background: #ef4444;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s;
}

.error-container .btn:hover {
  background: #dc2626;
}
</style>
